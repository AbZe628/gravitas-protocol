const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/core-Ckl7Ewkx.js","assets/vendor-wagmi-cTE54Kv4.js","assets/vendor-motion-DIEF-jm7.js","assets/vendor-query-B27Zn0Yi.js"])))=>i.map(i=>d[i]);
import{r as Wg,s as Gg,t as Yg,v as Zg,x as Jg,y as Xg,_ as Qg}from"./vendor-wagmi-cTE54Kv4.js";import{g as df,d as pf,c as Nt}from"./vendor-motion-DIEF-jm7.js";function gf(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function yf(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(r=>typeof r=="string"):e.every(r=>Number.isSafeInteger(r)):!1}function Gn(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function nn(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function Yn(t){if(!Array.isArray(t))throw new Error("array expected")}function Zn(t,e){if(!yf(!0,e))throw new Error(`${t}: array of strings expected`)}function wf(t,e){if(!yf(!1,e))throw new Error(`${t}: array of numbers expected`)}function mf(...t){const e=s=>s,r=(s,o)=>a=>s(o(a)),i=t.map(s=>s.encode).reduceRight(r,e),n=t.map(s=>s.decode).reduce(r,e);return{encode:i,decode:n}}function bf(t){const e=typeof t=="string"?t.split(""):t,r=e.length;Zn("alphabet",e);const i=new Map(e.map((n,s)=>[n,s]));return{encode:n=>(Yn(n),n.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${t}`);return e[s]})),decode:n=>(Yn(n),n.map(s=>{Gn("alphabet.decode",s);const o=i.get(s);if(o===void 0)throw new Error(`Unknown letter: "${s}". Allowed: ${t}`);return o}))}}function vf(t=""){return Gn("join",t),{encode:e=>(Zn("join.decode",e),e.join(t)),decode:e=>(Gn("join.decode",e),e.split(t))}}function ey(t,e="="){return nn(t),Gn("padding",e),{encode(r){for(Zn("padding.encode",r);r.length*t%8;)r.push(e);return r},decode(r){Zn("padding.decode",r);let i=r.length;if(i*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;i>0&&r[i-1]===e;i--)if((i-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return r.slice(0,i)}}}function Fc(t,e,r){if(e<2)throw new Error(`convertRadix: invalid from=${e}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: invalid to=${r}, base cannot be less than 2`);if(Yn(t),!t.length)return[];let i=0;const n=[],s=Array.from(t,a=>{if(nn(a),a<0||a>=e)throw new Error(`invalid integer: ${a}`);return a}),o=s.length;for(;;){let a=0,c=!0;for(let l=i;l<o;l++){const u=s[l],h=e*a,f=h+u;if(!Number.isSafeInteger(f)||h/e!==a||f-u!==h)throw new Error("convertRadix: carry overflow");const p=f/r;a=f%r;const d=Math.floor(p);if(s[l]=d,!Number.isSafeInteger(d)||d*r+a!==f)throw new Error("convertRadix: carry overflow");if(c)d?c=!1:i=l;else continue}if(n.push(a),c)break}for(let a=0;a<t.length-1&&t[a]===0;a++)n.push(0);return n.reverse()}const Ef=(t,e)=>e===0?t:Ef(e,t%e),Jn=(t,e)=>t+(e-Ef(t,e)),Ls=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function Mc(t,e,r,i){if(Yn(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(Jn(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${Jn(e,r)}`);let n=0,s=0;const o=Ls[e],a=Ls[r]-1,c=[];for(const l of t){if(nn(l),l>=o)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(n=n<<e|l,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=r;s-=r)c.push((n>>s-r&a)>>>0);const u=Ls[s];if(u===void 0)throw new Error("invalid carry");n&=u-1}if(n=n<<r-s&a,!i&&s>=e)throw new Error("Excess padding");if(!i&&n>0)throw new Error(`Non-zero padding: ${n}`);return i&&s>0&&c.push(n>>>0),c}function ty(t){nn(t);const e=2**8;return{encode:r=>{if(!gf(r))throw new Error("radix.encode input should be Uint8Array");return Fc(Array.from(r),e,t)},decode:r=>(wf("radix.decode",r),Uint8Array.from(Fc(r,t,e)))}}function ry(t,e=!1){if(nn(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Jn(8,t)>32||Jn(t,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!gf(r))throw new Error("radix2.encode input should be Uint8Array");return Mc(Array.from(r),8,t,!e)},decode:r=>(wf("radix2.decode",r),Uint8Array.from(Mc(r,t,8,e)))}}const iy=mf(ry(5),bf("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),ey(5),vf("")),ny=t=>mf(ty(58),bf(t),vf("")),sn=ny("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");function Zr(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function xf(t,e){const r=indexedDB.open(t);r.onupgradeneeded=()=>r.result.createObjectStore(e);const i=Zr(r);return(n,s)=>i.then(o=>s(o.transaction(e,n).objectStore(e)))}let Fs;function on(){return Fs||(Fs=xf("keyval-store","keyval")),Fs}function qc(t,e=on()){return e("readonly",r=>Zr(r.get(t)))}function sy(t,e,r=on()){return r("readwrite",i=>(i.put(e,t),Zr(i.transaction)))}function oy(t,e=on()){return e("readwrite",r=>(r.delete(t),Zr(r.transaction)))}function ay(t=on()){return t("readwrite",e=>(e.clear(),Zr(e.transaction)))}function cy(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Zr(t.transaction)}function ly(t=on()){return t("readonly",e=>{if(e.getAllKeys)return Zr(e.getAllKeys());const r=[];return cy(e,i=>r.push(i.key)).then(()=>r)})}var mn={exports:{}},zc;function uy(){if(zc)return mn.exports;zc=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(E,_,C){return Function.prototype.apply.call(E,_,C)},r;t&&typeof t.ownKeys=="function"?r=t.ownKeys:Object.getOwnPropertySymbols?r=function(E){return Object.getOwnPropertyNames(E).concat(Object.getOwnPropertySymbols(E))}:r=function(E){return Object.getOwnPropertyNames(E)};function i(b){console&&console.warn&&console.warn(b)}var n=Number.isNaN||function(E){return E!==E};function s(){s.init.call(this)}mn.exports=s,mn.exports.once=x,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(b){if(typeof b!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof b)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(b){if(typeof b!="number"||b<0||n(b))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+b+".");o=b}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(E){if(typeof E!="number"||E<0||n(E))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+E+".");return this._maxListeners=E,this};function c(b){return b._maxListeners===void 0?s.defaultMaxListeners:b._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(E){for(var _=[],C=1;C<arguments.length;C++)_.push(arguments[C]);var B=E==="error",A=this._events;if(A!==void 0)B=B&&A.error===void 0;else if(!B)return!1;if(B){var N;if(_.length>0&&(N=_[0]),N instanceof Error)throw N;var j=new Error("Unhandled error."+(N?" ("+N.message+")":""));throw j.context=N,j}var R=A[E];if(R===void 0)return!1;if(typeof R=="function")e(R,this,_);else for(var D=R.length,T=d(R,D),C=0;C<D;++C)e(T[C],this,_);return!0};function l(b,E,_,C){var B,A,N;if(a(_),A=b._events,A===void 0?(A=b._events=Object.create(null),b._eventsCount=0):(A.newListener!==void 0&&(b.emit("newListener",E,_.listener?_.listener:_),A=b._events),N=A[E]),N===void 0)N=A[E]=_,++b._eventsCount;else if(typeof N=="function"?N=A[E]=C?[_,N]:[N,_]:C?N.unshift(_):N.push(_),B=c(b),B>0&&N.length>B&&!N.warned){N.warned=!0;var j=new Error("Possible EventEmitter memory leak detected. "+N.length+" "+String(E)+" listeners added. Use emitter.setMaxListeners() to increase limit");j.name="MaxListenersExceededWarning",j.emitter=b,j.type=E,j.count=N.length,i(j)}return b}s.prototype.addListener=function(E,_){return l(this,E,_,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(E,_){return l(this,E,_,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(b,E,_){var C={fired:!1,wrapFn:void 0,target:b,type:E,listener:_},B=u.bind(C);return B.listener=_,C.wrapFn=B,B}s.prototype.once=function(E,_){return a(_),this.on(E,h(this,E,_)),this},s.prototype.prependOnceListener=function(E,_){return a(_),this.prependListener(E,h(this,E,_)),this},s.prototype.removeListener=function(E,_){var C,B,A,N,j;if(a(_),B=this._events,B===void 0)return this;if(C=B[E],C===void 0)return this;if(C===_||C.listener===_)--this._eventsCount===0?this._events=Object.create(null):(delete B[E],B.removeListener&&this.emit("removeListener",E,C.listener||_));else if(typeof C!="function"){for(A=-1,N=C.length-1;N>=0;N--)if(C[N]===_||C[N].listener===_){j=C[N].listener,A=N;break}if(A<0)return this;A===0?C.shift():y(C,A),C.length===1&&(B[E]=C[0]),B.removeListener!==void 0&&this.emit("removeListener",E,j||_)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(E){var _,C,B;if(C=this._events,C===void 0)return this;if(C.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):C[E]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete C[E]),this;if(arguments.length===0){var A=Object.keys(C),N;for(B=0;B<A.length;++B)N=A[B],N!=="removeListener"&&this.removeAllListeners(N);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(_=C[E],typeof _=="function")this.removeListener(E,_);else if(_!==void 0)for(B=_.length-1;B>=0;B--)this.removeListener(E,_[B]);return this};function f(b,E,_){var C=b._events;if(C===void 0)return[];var B=C[E];return B===void 0?[]:typeof B=="function"?_?[B.listener||B]:[B]:_?m(B):d(B,B.length)}s.prototype.listeners=function(E){return f(this,E,!0)},s.prototype.rawListeners=function(E){return f(this,E,!1)},s.listenerCount=function(b,E){return typeof b.listenerCount=="function"?b.listenerCount(E):p.call(b,E)},s.prototype.listenerCount=p;function p(b){var E=this._events;if(E!==void 0){var _=E[b];if(typeof _=="function")return 1;if(_!==void 0)return _.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]};function d(b,E){for(var _=new Array(E),C=0;C<E;++C)_[C]=b[C];return _}function y(b,E){for(;E+1<b.length;E++)b[E]=b[E+1];b.pop()}function m(b){for(var E=new Array(b.length),_=0;_<E.length;++_)E[_]=b[_].listener||b[_];return E}function x(b,E){return new Promise(function(_,C){function B(N){b.removeListener(E,A),C(N)}function A(){typeof b.removeListener=="function"&&b.removeListener("error",B),_([].slice.call(arguments))}v(b,E,A,{once:!0}),E!=="error"&&O(b,B,{once:!0})})}function O(b,E,_){typeof b.on=="function"&&v(b,"error",E,_)}function v(b,E,_,C){if(typeof b.on=="function")C.once?b.once(E,_):b.on(E,_);else if(typeof b.addEventListener=="function")b.addEventListener(E,function B(A){C.once&&b.removeEventListener(E,B),_(A)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof b)}return mn.exports}var ot=uy();const Wa=df(ot);var Vc=function(t,e,r){if(r||arguments.length===2)for(var i=0,n=e.length,s;i<n;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))},hy=(function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t})(),fy=(function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t})(),dy=(function(){function t(e,r,i,n){this.name=e,this.version=r,this.os=i,this.bot=n,this.type="bot-device"}return t})(),py=(function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t})(),gy=(function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t})(),yy=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,wy=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Kc=3,my=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",yy]],Hc=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function by(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new gy:typeof navigator<"u"?Ey(navigator.userAgent):_y()}function vy(t){return t!==""&&my.reduce(function(e,r){var i=r[0],n=r[1];if(e)return e;var s=n.exec(t);return!!s&&[i,s]},!1)}function Ey(t){var e=vy(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new py;var n=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);n?n.length<Kc&&(n=Vc(Vc([],n,!0),Iy(Kc-n.length),!0)):n=[];var s=n.join("."),o=xy(t),a=wy.exec(t);return a&&a[1]?new dy(r,s,o,a[1]):new hy(r,s,o)}function xy(t){for(var e=0,r=Hc.length;e<r;e++){var i=Hc[e],n=i[0],s=i[1],o=s.exec(t);if(o)return n}return null}function _y(){var t=typeof process<"u"&&process.version;return t?new fy(process.version.slice(1)):null}function Iy(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var Ms={};var Wo=function(t,e){return Wo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},Wo(t,e)};function Sy(t,e){Wo(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Go=function(){return Go=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Go.apply(this,arguments)};function Oy(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function $y(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,r,s):o(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function Dy(t,e){return function(r,i){e(r,i,t)}}function Ay(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Py(t,e,r,i){function n(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(h){o(h)}}function c(u){try{l(i.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):n(u.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function Cy(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=l[0]&2?n.return:l[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,l[1])).done)return s;switch(n=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(u){l=[6,u],n=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function By(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function Ty(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Yo(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function _f(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}function Ry(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(_f(arguments[e]));return t}function Ny(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,n++)i[n]=s[o];return i}function Gi(t){return this instanceof Gi?(this.v=t,this):new Gi(t)}function Uy(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(f){i[f]&&(n[f]=function(p){return new Promise(function(d,y){s.push([f,p,d,y])>1||a(f,p)})})}function a(f,p){try{c(i[f](p))}catch(d){h(s[0][3],d)}}function c(f){f.value instanceof Gi?Promise.resolve(f.value.v).then(l,u):h(s[0][2],f)}function l(f){a("next",f)}function u(f){a("throw",f)}function h(f,p){f(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}function jy(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(o){return(r=!r)?{value:Gi(t[n](o)),done:n==="return"}:s?s(o):o}:s}}function ky(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Yo=="function"?Yo(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),n(a,c,o.done,o.value)})}}function n(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function Ly(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Fy(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function My(t){return t&&t.__esModule?t:{default:t}}function qy(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function zy(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const Vy=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Go},__asyncDelegator:jy,__asyncGenerator:Uy,__asyncValues:ky,__await:Gi,__awaiter:Py,__classPrivateFieldGet:qy,__classPrivateFieldSet:zy,__createBinding:By,__decorate:$y,__exportStar:Ty,__extends:Sy,__generator:Cy,__importDefault:My,__importStar:Fy,__makeTemplateObject:Ly,__metadata:Ay,__param:Dy,__read:_f,__rest:Oy,__spread:Ry,__spreadArrays:Ny,__values:Yo},Symbol.toStringTag,{value:"Module"})),ps=pf(Vy);var qs={},Ii={},Wc;function Ky(){if(Wc)return Ii;Wc=1,Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return Ii.delay=t,Ii}var Pr={},zs={},Cr={},Gc;function Hy(){return Gc||(Gc=1,Object.defineProperty(Cr,"__esModule",{value:!0}),Cr.ONE_THOUSAND=Cr.ONE_HUNDRED=void 0,Cr.ONE_HUNDRED=100,Cr.ONE_THOUSAND=1e3),Cr}var Vs={},Yc;function Wy(){return Yc||(Yc=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365})(Vs)),Vs}var Zc;function If(){return Zc||(Zc=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=ps;e.__exportStar(Hy(),t),e.__exportStar(Wy(),t)})(zs)),zs}var Jc;function Gy(){if(Jc)return Pr;Jc=1,Object.defineProperty(Pr,"__esModule",{value:!0}),Pr.fromMiliseconds=Pr.toMiliseconds=void 0;const t=If();function e(i){return i*t.ONE_THOUSAND}Pr.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return Pr.fromMiliseconds=r,Pr}var Xc;function Yy(){return Xc||(Xc=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=ps;e.__exportStar(Ky(),t),e.__exportStar(Gy(),t)})(qs)),qs}var ti={},Qc;function Zy(){if(Qc)return ti;Qc=1,Object.defineProperty(ti,"__esModule",{value:!0}),ti.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const n=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:n})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return ti.Watch=t,ti.default=t,ti}var Ks={},Si={},el;function Jy(){if(el)return Si;el=1,Object.defineProperty(Si,"__esModule",{value:!0}),Si.IWatch=void 0;class t{}return Si.IWatch=t,Si}var tl;function Xy(){return tl||(tl=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),ps.__exportStar(Jy(),t)})(Ks)),Ks}var rl;function Qy(){return rl||(rl=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=ps;e.__exportStar(Yy(),t),e.__exportStar(Zy(),t),e.__exportStar(Xy(),t),e.__exportStar(If(),t)})(Ms)),Ms}var M=Qy(),ne={},il;function Sf(){if(il)return ne;il=1,Object.defineProperty(ne,"__esModule",{value:!0}),ne.getLocalStorage=ne.getLocalStorageOrThrow=ne.getCrypto=ne.getCryptoOrThrow=ne.getLocation=ne.getLocationOrThrow=ne.getNavigator=ne.getNavigatorOrThrow=ne.getDocument=ne.getDocumentOrThrow=ne.getFromWindowOrThrow=ne.getFromWindow=void 0;function t(f){let p;return typeof window<"u"&&typeof window[f]<"u"&&(p=window[f]),p}ne.getFromWindow=t;function e(f){const p=t(f);if(!p)throw new Error(`${f} is not defined in Window`);return p}ne.getFromWindowOrThrow=e;function r(){return e("document")}ne.getDocumentOrThrow=r;function i(){return t("document")}ne.getDocument=i;function n(){return e("navigator")}ne.getNavigatorOrThrow=n;function s(){return t("navigator")}ne.getNavigator=s;function o(){return e("location")}ne.getLocationOrThrow=o;function a(){return t("location")}ne.getLocation=a;function c(){return e("crypto")}ne.getCryptoOrThrow=c;function l(){return t("crypto")}ne.getCrypto=l;function u(){return e("localStorage")}ne.getLocalStorageOrThrow=u;function h(){return t("localStorage")}return ne.getLocalStorage=h,ne}var sr=Sf(),Oi={},nl;function ew(){if(nl)return Oi;nl=1,Object.defineProperty(Oi,"__esModule",{value:!0}),Oi.getWindowMetadata=void 0;const t=Sf();function e(){let r,i;try{r=t.getDocumentOrThrow(),i=t.getLocationOrThrow()}catch{return null}function n(){const p=r.getElementsByTagName("link"),d=[];for(let y=0;y<p.length;y++){const m=p[y],x=m.getAttribute("rel");if(x&&x.toLowerCase().indexOf("icon")>-1){const O=m.getAttribute("href");if(O)if(O.toLowerCase().indexOf("https:")===-1&&O.toLowerCase().indexOf("http:")===-1&&O.indexOf("//")!==0){let v=i.protocol+"//"+i.host;if(O.indexOf("/")===0)v+=O;else{const b=i.pathname.split("/");b.pop();const E=b.join("/");v+=E+"/"+O}d.push(v)}else if(O.indexOf("//")===0){const v=i.protocol+O;d.push(v)}else d.push(O)}}return d}function s(...p){const d=r.getElementsByTagName("meta");for(let y=0;y<d.length;y++){const m=d[y],x=["itemprop","property","name"].map(O=>m.getAttribute(O)).filter(O=>O?p.includes(O):!1);if(x.length&&x){const O=m.getAttribute("content");if(O)return O}}return""}function o(){let p=s("name","og:site_name","og:title","twitter:title");return p||(p=r.title),p}function a(){return s("description","og:description","twitter:description","keywords")}const c=o(),l=a(),u=i.origin,h=n();return{description:l,url:u,icons:h,name:c}}return Oi.getWindowMetadata=e,Oi}var tw=ew();const rw="0.1.1";function iw(){return rw}class le extends Error{constructor(e,r={}){const i=(()=>{if(r.cause instanceof le){if(r.cause.details)return r.cause.details;if(r.cause.shortMessage)return r.cause.shortMessage}return r.cause&&"details"in r.cause&&typeof r.cause.details=="string"?r.cause.details:r.cause?.message?r.cause.message:r.details})(),n=r.cause instanceof le&&r.cause.docsPath||r.docsPath,o=`https://oxlib.sh${n??""}`,a=[e||"An error occurred.",...r.metaMessages?["",...r.metaMessages]:[],...i||n?["",i?`Details: ${i}`:void 0,n?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${iw()}`}),this.cause=r.cause,this.details=i,this.docs=o,this.docsPath=n,this.shortMessage=e}walk(e){return Of(this,e)}}function Of(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?Of(t.cause,e):e?null:t}const Ga=BigInt(0),Zo=BigInt(1);function an(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ya(t){if(!an(t))throw new Error("Uint8Array expected")}function Yi(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function bn(t){const e=t.toString(16);return e.length&1?"0"+e:e}function $f(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Ga:BigInt("0x"+t)}const Df=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",nw=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Zi(t){if(Ya(t),Df)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=nw[t[r]];return e}const qt={_0:48,_9:57,A:65,F:70,a:97,f:102};function sl(t){if(t>=qt._0&&t<=qt._9)return t-qt._0;if(t>=qt.A&&t<=qt.F)return t-(qt.A-10);if(t>=qt.a&&t<=qt.f)return t-(qt.a-10)}function Xn(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Df)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let n=0,s=0;n<r;n++,s+=2){const o=sl(t.charCodeAt(s)),a=sl(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[n]=o*16+a}return i}function Kr(t){return $f(Zi(t))}function Af(t){return Ya(t),$f(Zi(Uint8Array.from(t).reverse()))}function cn(t,e){return Xn(t.toString(16).padStart(e*2,"0"))}function Pf(t,e){return cn(t,e).reverse()}function ft(t,e,r){let i;if(typeof e=="string")try{i=Xn(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(an(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const n=i.length;if(typeof r=="number"&&n!==r)throw new Error(t+" of length "+r+" expected, got "+n);return i}function Qn(...t){let e=0;for(let i=0;i<t.length;i++){const n=t[i];Ya(n),e+=n.length}const r=new Uint8Array(e);for(let i=0,n=0;i<t.length;i++){const s=t[i];r.set(s,n),n+=s.length}return r}const Hs=t=>typeof t=="bigint"&&Ga<=t;function Za(t,e,r){return Hs(t)&&Hs(e)&&Hs(r)&&e<=t&&t<r}function di(t,e,r,i){if(!Za(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function sw(t){let e;for(e=0;t>Ga;t>>=Zo,e+=1);return e}const gs=t=>(Zo<<BigInt(t))-Zo,Ws=t=>new Uint8Array(t),ol=t=>Uint8Array.from(t);function ow(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let i=Ws(t),n=Ws(t),s=0;const o=()=>{i.fill(1),n.fill(0),s=0},a=(...h)=>r(n,i,...h),c=(h=Ws(0))=>{n=a(ol([0]),h),i=a(),h.length!==0&&(n=a(ol([1]),h),i=a())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const f=[];for(;h<e;){i=a();const p=i.slice();f.push(p),h+=i.length}return Qn(...f)};return(h,f)=>{o(),c(h);let p;for(;!(p=f(l()));)c();return o(),p}}const aw={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||an(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function ys(t,e,r={}){const i=(n,s,o)=>{const a=aw[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[n];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(n)+" is invalid. Expected "+s+", got "+c)};for(const[n,s]of Object.entries(e))i(n,s,!1);for(const[n,s]of Object.entries(r))i(n,s,!0);return t}function al(t){const e=new WeakMap;return(r,...i)=>{const n=e.get(r);if(n!==void 0)return n;const s=t(r,...i);return e.set(r,s),s}}function cw(t,e){if(hl(t)>e)throw new Aw({givenSize:hl(t),maxSize:e})}const zt={zero:48,nine:57,A:65,F:70,a:97,f:102};function cl(t){if(t>=zt.zero&&t<=zt.nine)return t-zt.zero;if(t>=zt.A&&t<=zt.F)return t-(zt.A-10);if(t>=zt.a&&t<=zt.f)return t-(zt.a-10)}function lw(t,e={}){const{dir:r,size:i=32}=e;if(i===0)return t;if(t.length>i)throw new Pw({size:t.length,targetSize:i,type:"Bytes"});const n=new Uint8Array(i);for(let s=0;s<i;s++){const o=r==="right";n[o?s:i-s-1]=t[o?s:t.length-s-1]}return n}function Cf(t,e){if(Or(t)>e)throw new bw({givenSize:Or(t),maxSize:e})}function uw(t,e){if(typeof e=="number"&&e>0&&e>Or(t)-1)throw new Rf({offset:e,position:"start",size:Or(t)})}function hw(t,e,r){if(typeof e=="number"&&typeof r=="number"&&Or(t)!==r-e)throw new Rf({offset:r,position:"end",size:Or(t)})}function Bf(t,e={}){const{dir:r,size:i=32}=e;if(i===0)return t;const n=t.replace("0x","");if(n.length>i*2)throw new vw({size:Math.ceil(n.length/2),targetSize:i,type:"Hex"});return`0x${n[r==="right"?"padEnd":"padStart"](i*2,"0")}`}const fw="#__bigint";function Ja(t,e,r){return JSON.stringify(t,(i,n)=>typeof n=="bigint"?n.toString()+fw:n,r)}const dw=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function pw(t,e={}){const{strict:r=!1}=e;if(!t)throw new ll(t);if(typeof t!="string")throw new ll(t);if(r&&!/^0x[0-9a-fA-F]*$/.test(t))throw new ul(t);if(!t.startsWith("0x"))throw new ul(t)}function gw(...t){return`0x${t.reduce((e,r)=>e+r.replace("0x",""),"")}`}function Xa(t){return t instanceof Uint8Array?es(t):Array.isArray(t)?es(new Uint8Array(t)):t}function es(t,e={}){let r="";for(let n=0;n<t.length;n++)r+=dw[t[n]];const i=`0x${r}`;return typeof e.size=="number"?(Cf(i,e.size),Tf(i,e.size)):i}function Gs(t,e={}){const{signed:r,size:i}=e,n=BigInt(t);let s;i?r?s=(1n<<BigInt(i)*8n-1n)-1n:s=2n**(BigInt(i)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&r?-s-1n:0;if(s&&n>s||n<o){const l=typeof t=="bigint"?"n":"";throw new mw({max:s?`${s}${l}`:void 0,min:`${o}${l}`,signed:r,size:i,value:`${t}${l}`})}const c=`0x${(r&&n<0?(1n<<BigInt(i*8))+BigInt(n):n).toString(16)}`;return i?yw(c,i):c}function yw(t,e){return Bf(t,{dir:"left",size:e})}function Tf(t,e){return Bf(t,{dir:"right",size:e})}function Jt(t,e,r,i={}){const{strict:n}=i;uw(t,e);const s=`0x${t.replace("0x","").slice((e??0)*2,(r??t.length)*2)}`;return n&&hw(s,e,r),s}function Or(t){return Math.ceil((t.length-2)/2)}function ww(t,e={}){const{strict:r=!1}=e;try{return pw(t,{strict:r}),!0}catch{return!1}}class mw extends le{constructor({max:e,min:r,signed:i,size:n,value:s}){super(`Number \`${s}\` is not in safe${n?` ${n*8}-bit`:""}${i?" signed":" unsigned"} integer range ${e?`(\`${r}\` to \`${e}\`)`:`(above \`${r}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class ll extends le{constructor(e){super(`Value \`${typeof e=="object"?Ja(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class ul extends le{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}let bw=class extends le{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}};class Rf extends le{constructor({offset:e,position:r,size:i}){super(`Slice ${r==="start"?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${i}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}let vw=class extends le{constructor({size:e,targetSize:r,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}};const Ew=new TextEncoder;function xw(t){if(!(t instanceof Uint8Array)){if(!t)throw new vn(t);if(typeof t!="object")throw new vn(t);if(!("BYTES_PER_ELEMENT"in t))throw new vn(t);if(t.BYTES_PER_ELEMENT!==1||t.constructor.name!=="Uint8Array")throw new vn(t)}}function _w(t){return t instanceof Uint8Array?t:typeof t=="string"?Sw(t):Iw(t)}function Iw(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function Sw(t,e={}){const{size:r}=e;let i=t;r&&(Cf(t,r),i=Tf(t,r));let n=i.slice(2);n.length%2&&(n=`0${n}`);const s=n.length/2,o=new Uint8Array(s);for(let a=0,c=0;a<s;a++){const l=cl(n.charCodeAt(c++)),u=cl(n.charCodeAt(c++));if(l===void 0||u===void 0)throw new le(`Invalid byte sequence ("${n[c-2]}${n[c-1]}" in "${n}").`);o[a]=l*16+u}return o}function Ow(t,e={}){const{size:r}=e,i=Ew.encode(t);return typeof r=="number"?(cw(i,r),$w(i,r)):i}function $w(t,e){return lw(t,{dir:"right",size:e})}function hl(t){return t.length}function Dw(t){try{return xw(t),!0}catch{return!1}}class vn extends le{constructor(e){super(`Value \`${typeof e=="object"?Ja(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class Aw extends le{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class Pw extends le{constructor({size:e,targetSize:r,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}function Nf(t,e={}){const{as:r=typeof t=="string"?"Hex":"Bytes"}=e,i=Wg(_w(t));return r==="Bytes"?i:es(i)}class Cw extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}}const Bw={checksum:new Cw(8192)},Ys=Bw.checksum;function Uf(t,e={}){const{compressed:r}=e,{prefix:i,x:n,y:s}=t;if(r===!1||typeof n=="bigint"&&typeof s=="bigint"){if(i!==4)throw new fl({prefix:i,cause:new kw});return}if(r===!0||typeof n=="bigint"&&typeof s>"u"){if(i!==3&&i!==2)throw new fl({prefix:i,cause:new jw});return}throw new Uw({publicKey:t})}function Tw(t){const e=(()=>{if(ww(t))return jf(t);if(Dw(t))return Rw(t);const{prefix:r,x:i,y:n}=t;return typeof i=="bigint"&&typeof n=="bigint"?{prefix:r??4,x:i,y:n}:{prefix:r,x:i}})();return Uf(e),e}function Rw(t){return jf(es(t))}function jf(t){if(t.length!==132&&t.length!==130&&t.length!==68)throw new Lw({publicKey:t});if(t.length===130){const i=BigInt(Jt(t,0,32)),n=BigInt(Jt(t,32,64));return{prefix:4,x:i,y:n}}if(t.length===132){const i=Number(Jt(t,0,1)),n=BigInt(Jt(t,1,33)),s=BigInt(Jt(t,33,65));return{prefix:i,x:n,y:s}}const e=Number(Jt(t,0,1)),r=BigInt(Jt(t,1,33));return{prefix:e,x:r}}function Nw(t,e={}){Uf(t);const{prefix:r,x:i,y:n}=t,{includePrefix:s=!0}=e;return gw(s?Gs(r,{size:1}):"0x",Gs(i,{size:32}),typeof n=="bigint"?Gs(n,{size:32}):"0x")}class Uw extends le{constructor({publicKey:e}){super(`Value \`${Ja(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class fl extends le{constructor({prefix:e,cause:r}){super(`Prefix "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class jw extends le{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class kw extends le{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}let Lw=class extends le{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${Or(Xa(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}};const Fw=/^0x[a-fA-F0-9]{40}$/;function kf(t,e={}){const{strict:r=!0}=e;if(!Fw.test(t))throw new dl({address:t,cause:new zw});if(r){if(t.toLowerCase()===t)return;if(Lf(t)!==t)throw new dl({address:t,cause:new Vw})}}function Lf(t){if(Ys.has(t))return Ys.get(t);kf(t,{strict:!1});const e=t.substring(2).toLowerCase(),r=Nf(Ow(e),{as:"Bytes"}),i=e.split("");for(let s=0;s<40;s+=2)r[s>>1]>>4>=8&&i[s]&&(i[s]=i[s].toUpperCase()),(r[s>>1]&15)>=8&&i[s+1]&&(i[s+1]=i[s+1].toUpperCase());const n=`0x${i.join("")}`;return Ys.set(t,n),n}function Mw(t,e={}){const{checksum:r=!1}=e;return kf(t),r?Lf(t):t}function qw(t,e={}){const r=Nf(`0x${Nw(t).slice(4)}`).substring(26);return Mw(`0x${r}`,e)}class dl extends le{constructor({address:e,cause:r}){super(`Address "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class zw extends le{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class Vw extends le{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}const Ye=BigInt(0),Le=BigInt(1),Fr=BigInt(2),Kw=BigInt(3),Ff=BigInt(4),Mf=BigInt(5),qf=BigInt(8);function He(t,e){const r=t%e;return r>=Ye?r:e+r}function ct(t,e,r){let i=t;for(;e-- >Ye;)i*=i,i%=r;return i}function Jo(t,e){if(t===Ye)throw new Error("invert: expected non-zero number");if(e<=Ye)throw new Error("invert: expected positive modulus, got "+e);let r=He(t,e),i=e,n=Ye,s=Le;for(;r!==Ye;){const a=i/r,c=i%r,l=n-s*a;i=r,r=c,n=s,s=l}if(i!==Le)throw new Error("invert: does not exist");return He(n,e)}function zf(t,e){const r=(t.ORDER+Le)/Ff,i=t.pow(e,r);if(!t.eql(t.sqr(i),e))throw new Error("Cannot find square root");return i}function Hw(t,e){const r=(t.ORDER-Mf)/qf,i=t.mul(e,Fr),n=t.pow(i,r),s=t.mul(e,n),o=t.mul(t.mul(s,Fr),n),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function Ww(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-Le,r=0;for(;e%Fr===Ye;)e/=Fr,r++;let i=Fr;const n=Qa(t);for(;pl(n,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return zf;let s=n.pow(i,e);const o=(e+Le)/Fr;return function(c,l){if(c.is0(l))return l;if(pl(c,l)!==1)throw new Error("Cannot find square root");let u=r,h=c.mul(c.ONE,s),f=c.pow(l,e),p=c.pow(l,o);for(;!c.eql(f,c.ONE);){if(c.is0(f))return c.ZERO;let d=1,y=c.sqr(f);for(;!c.eql(y,c.ONE);)if(d++,y=c.sqr(y),d===u)throw new Error("Cannot find square root");const m=Le<<BigInt(u-d-1),x=c.pow(h,m);u=d,h=c.sqr(x),f=c.mul(f,h),p=c.mul(p,x)}return p}}function Gw(t){return t%Ff===Kw?zf:t%qf===Mf?Hw:Ww(t)}const Yw=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Zw(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=Yw.reduce((i,n)=>(i[n]="function",i),e);return ys(t,r)}function Jw(t,e,r){if(r<Ye)throw new Error("invalid exponent, negatives unsupported");if(r===Ye)return t.ONE;if(r===Le)return e;let i=t.ONE,n=e;for(;r>Ye;)r&Le&&(i=t.mul(i,n)),n=t.sqr(n),r>>=Le;return i}function Vf(t,e,r=!1){const i=new Array(e.length).fill(r?t.ZERO:void 0),n=e.reduce((o,a,c)=>t.is0(a)?o:(i[c]=o,t.mul(o,a)),t.ONE),s=t.inv(n);return e.reduceRight((o,a,c)=>t.is0(a)?o:(i[c]=t.mul(o,i[c]),t.mul(o,a)),s),i}function pl(t,e){const r=(t.ORDER-Le)/Fr,i=t.pow(e,r),n=t.eql(i,t.ONE),s=t.eql(i,t.ZERO),o=t.eql(i,t.neg(t.ONE));if(!n&&!s&&!o)throw new Error("invalid Legendre symbol result");return n?1:s?0:-1}function Kf(t,e){e!==void 0&&Gg(e);const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function Qa(t,e,r=!1,i={}){if(t<=Ye)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:n,nByteLength:s}=Kf(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:n,BYTES:s,MASK:gs(n),ZERO:Ye,ONE:Le,create:c=>He(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ye<=c&&c<t},is0:c=>c===Ye,isOdd:c=>(c&Le)===Le,neg:c=>He(-c,t),eql:(c,l)=>c===l,sqr:c=>He(c*c,t),add:(c,l)=>He(c+l,t),sub:(c,l)=>He(c-l,t),mul:(c,l)=>He(c*l,t),pow:(c,l)=>Jw(a,c,l),div:(c,l)=>He(c*Jo(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Jo(c,t),sqrt:i.sqrt||(c=>(o||(o=Gw(t)),o(a,c))),toBytes:c=>r?Pf(c,s):cn(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?Af(c):Kr(c)},invertBatch:c=>Vf(a,c),cmov:(c,l,u)=>u?l:c});return Object.freeze(a)}function Hf(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Wf(t){const e=Hf(t);return e+Math.ceil(e/2)}function Xw(t,e,r=!1){const i=t.length,n=Hf(e),s=Wf(e);if(i<16||i<s||i>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+i);const o=r?Af(t):Kr(t),a=He(o,e-Le)+Le;return r?Pf(a,n):cn(a,n)}const gl=BigInt(0),Xo=BigInt(1);function Zs(t,e){const r=e.negate();return t?r:e}function Gf(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Js(t,e){Gf(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1),n=2**t,s=gs(t),o=BigInt(t);return{windows:r,windowSize:i,mask:s,maxNumber:n,shiftBy:o}}function yl(t,e,r){const{windowSize:i,mask:n,maxNumber:s,shiftBy:o}=r;let a=Number(t&n),c=t>>o;a>i&&(a-=s,c+=Xo);const l=e*i,u=l+Math.abs(a)-1,h=a===0,f=a<0,p=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:f,isNegF:p,offsetF:l}}function Qw(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function em(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const Xs=new WeakMap,Yf=new WeakMap;function Qs(t){return Yf.get(t)||1}function tm(t,e){return{constTimeNegate:Zs,hasPrecomputes(r){return Qs(r)!==1},unsafeLadder(r,i,n=t.ZERO){let s=r;for(;i>gl;)i&Xo&&(n=n.add(s)),s=s.double(),i>>=Xo;return n},precomputeWindow(r,i){const{windows:n,windowSize:s}=Js(i,e),o=[];let a=r,c=a;for(let l=0;l<n;l++){c=a,o.push(c);for(let u=1;u<s;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,i,n){let s=t.ZERO,o=t.BASE;const a=Js(r,e);for(let c=0;c<a.windows;c++){const{nextN:l,offset:u,isZero:h,isNeg:f,isNegF:p,offsetF:d}=yl(n,c,a);n=l,h?o=o.add(Zs(p,i[d])):s=s.add(Zs(f,i[u]))}return{p:s,f:o}},wNAFUnsafe(r,i,n,s=t.ZERO){const o=Js(r,e);for(let a=0;a<o.windows&&n!==gl;a++){const{nextN:c,offset:l,isZero:u,isNeg:h}=yl(n,a,o);if(n=c,!u){const f=i[l];s=s.add(h?f.negate():f)}}return s},getPrecomputes(r,i,n){let s=Xs.get(i);return s||(s=this.precomputeWindow(i,r),r!==1&&Xs.set(i,n(s))),s},wNAFCached(r,i,n){const s=Qs(r);return this.wNAF(s,this.getPrecomputes(s,r,n),i)},wNAFCachedUnsafe(r,i,n,s){const o=Qs(r);return o===1?this.unsafeLadder(r,i,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,n),i,s)},setWindowSize(r,i){Gf(i,e),Yf.set(r,i),Xs.delete(r)}}}function rm(t,e,r,i){Qw(r,t),em(i,e);const n=r.length,s=i.length;if(n!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=sw(BigInt(n));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=gs(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let p=h;p>=0;p-=c){u.fill(o);for(let y=0;y<s;y++){const m=i[y],x=Number(m>>BigInt(p)&l);u[x]=u[x].add(r[y])}let d=o;for(let y=u.length-1,m=o;y>0;y--)m=m.add(u[y]),d=d.add(m);if(f=f.add(d),p!==0)for(let y=0;y<c;y++)f=f.double()}return f}function Zf(t){return Zw(t.Fp),ys(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Kf(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function wl(t){t.lowS!==void 0&&Yi("lowS",t.lowS),t.prehash!==void 0&&Yi("prehash",t.prehash)}function im(t){const e=Zf(t);ys(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:r,Fp:i,a:n}=e;if(r){if(!i.eql(n,i.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class nm extends Error{constructor(e=""){super(e)}}const Xt={Err:nm,_tlv:{encode:(t,e)=>{const{Err:r}=Xt;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const i=e.length/2,n=bn(i);if(n.length/2&128)throw new r("tlv.encode: long form length too big");const s=i>127?bn(n.length/2|128):"";return bn(t)+s+n+e},decode(t,e){const{Err:r}=Xt;let i=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new r("tlv.decode: wrong tlv");const n=e[i++],s=!!(n&128);let o=0;if(!s)o=n;else{const c=n&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const l=e.subarray(i,i+c);if(l.length!==c)throw new r("tlv.decode: length bytes not complete");if(l[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(i+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(t){const{Err:e}=Xt;if(t<er)throw new e("integer: negative integers are not allowed");let r=bn(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Xt;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Kr(t)}},toSig(t){const{Err:e,_int:r,_tlv:i}=Xt,n=ft("signature",t),{v:s,l:o}=i.decode(48,n);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,s),{v:l,l:u}=i.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(t){const{_tlv:e,_int:r}=Xt,i=e.encode(2,r.encode(t.r)),n=e.encode(2,r.encode(t.s)),s=i+n;return e.encode(48,s)}};function eo(t,e){return Zi(cn(t,e))}const er=BigInt(0),_e=BigInt(1);BigInt(2);const to=BigInt(3),sm=BigInt(4);function om(t){const e=im(t),{Fp:r}=e,i=Qa(e.n,e.nBitLength),n=e.toBytes||((v,b,E)=>{const _=b.toAffine();return Qn(Uint8Array.from([4]),r.toBytes(_.x),r.toBytes(_.y))}),s=e.fromBytes||(v=>{const b=v.subarray(1),E=r.fromBytes(b.subarray(0,r.BYTES)),_=r.fromBytes(b.subarray(r.BYTES,2*r.BYTES));return{x:E,y:_}});function o(v){const{a:b,b:E}=e,_=r.sqr(v),C=r.mul(_,v);return r.add(r.add(C,r.mul(v,b)),E)}function a(v,b){const E=r.sqr(b),_=o(v);return r.eql(E,_)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=r.mul(r.pow(e.a,to),sm),l=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(c,l)))throw new Error("bad curve params: a or b");function u(v){return Za(v,_e,e.n)}function h(v){const{allowedPrivateKeyLengths:b,nByteLength:E,wrapPrivateKey:_,n:C}=e;if(b&&typeof v!="bigint"){if(an(v)&&(v=Zi(v)),typeof v!="string"||!b.includes(v.length))throw new Error("invalid private key");v=v.padStart(E*2,"0")}let B;try{B=typeof v=="bigint"?v:Kr(ft("private key",v,E))}catch{throw new Error("invalid private key, expected hex or "+E+" bytes, got "+typeof v)}return _&&(B=He(B,C)),di("private key",B,_e,C),B}function f(v){if(!(v instanceof y))throw new Error("ProjectivePoint expected")}const p=al((v,b)=>{const{px:E,py:_,pz:C}=v;if(r.eql(C,r.ONE))return{x:E,y:_};const B=v.is0();b==null&&(b=B?r.ONE:r.inv(C));const A=r.mul(E,b),N=r.mul(_,b),j=r.mul(C,b);if(B)return{x:r.ZERO,y:r.ZERO};if(!r.eql(j,r.ONE))throw new Error("invZ was invalid");return{x:A,y:N}}),d=al(v=>{if(v.is0()){if(e.allowInfinityPoint&&!r.is0(v.py))return;throw new Error("bad point: ZERO")}const{x:b,y:E}=v.toAffine();if(!r.isValid(b)||!r.isValid(E))throw new Error("bad point: x or y not FE");if(!a(b,E))throw new Error("bad point: equation left != right");if(!v.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class y{constructor(b,E,_){if(b==null||!r.isValid(b))throw new Error("x required");if(E==null||!r.isValid(E)||r.is0(E))throw new Error("y required");if(_==null||!r.isValid(_))throw new Error("z required");this.px=b,this.py=E,this.pz=_,Object.freeze(this)}static fromAffine(b){const{x:E,y:_}=b||{};if(!b||!r.isValid(E)||!r.isValid(_))throw new Error("invalid affine point");if(b instanceof y)throw new Error("projective point not allowed");const C=B=>r.eql(B,r.ZERO);return C(E)&&C(_)?y.ZERO:new y(E,_,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(b){const E=Vf(r,b.map(_=>_.pz));return b.map((_,C)=>_.toAffine(E[C])).map(y.fromAffine)}static fromHex(b){const E=y.fromAffine(s(ft("pointHex",b)));return E.assertValidity(),E}static fromPrivateKey(b){return y.BASE.multiply(h(b))}static msm(b,E){return rm(y,i,b,E)}_setWindowSize(b){O.setWindowSize(this,b)}assertValidity(){d(this)}hasEvenY(){const{y:b}=this.toAffine();if(r.isOdd)return!r.isOdd(b);throw new Error("Field doesn't support isOdd")}equals(b){f(b);const{px:E,py:_,pz:C}=this,{px:B,py:A,pz:N}=b,j=r.eql(r.mul(E,N),r.mul(B,C)),R=r.eql(r.mul(_,N),r.mul(A,C));return j&&R}negate(){return new y(this.px,r.neg(this.py),this.pz)}double(){const{a:b,b:E}=e,_=r.mul(E,to),{px:C,py:B,pz:A}=this;let N=r.ZERO,j=r.ZERO,R=r.ZERO,D=r.mul(C,C),T=r.mul(B,B),g=r.mul(A,A),w=r.mul(C,B);return w=r.add(w,w),R=r.mul(C,A),R=r.add(R,R),N=r.mul(b,R),j=r.mul(_,g),j=r.add(N,j),N=r.sub(T,j),j=r.add(T,j),j=r.mul(N,j),N=r.mul(w,N),R=r.mul(_,R),g=r.mul(b,g),w=r.sub(D,g),w=r.mul(b,w),w=r.add(w,R),R=r.add(D,D),D=r.add(R,D),D=r.add(D,g),D=r.mul(D,w),j=r.add(j,D),g=r.mul(B,A),g=r.add(g,g),D=r.mul(g,w),N=r.sub(N,D),R=r.mul(g,T),R=r.add(R,R),R=r.add(R,R),new y(N,j,R)}add(b){f(b);const{px:E,py:_,pz:C}=this,{px:B,py:A,pz:N}=b;let j=r.ZERO,R=r.ZERO,D=r.ZERO;const T=e.a,g=r.mul(e.b,to);let w=r.mul(E,B),I=r.mul(_,A),P=r.mul(C,N),S=r.add(E,_),$=r.add(B,A);S=r.mul(S,$),$=r.add(w,I),S=r.sub(S,$),$=r.add(E,C);let U=r.add(B,N);return $=r.mul($,U),U=r.add(w,P),$=r.sub($,U),U=r.add(_,C),j=r.add(A,N),U=r.mul(U,j),j=r.add(I,P),U=r.sub(U,j),D=r.mul(T,$),j=r.mul(g,P),D=r.add(j,D),j=r.sub(I,D),D=r.add(I,D),R=r.mul(j,D),I=r.add(w,w),I=r.add(I,w),P=r.mul(T,P),$=r.mul(g,$),I=r.add(I,P),P=r.sub(w,P),P=r.mul(T,P),$=r.add($,P),w=r.mul(I,$),R=r.add(R,w),w=r.mul(U,$),j=r.mul(S,j),j=r.sub(j,w),w=r.mul(S,I),D=r.mul(U,D),D=r.add(D,w),new y(j,R,D)}subtract(b){return this.add(b.negate())}is0(){return this.equals(y.ZERO)}wNAF(b){return O.wNAFCached(this,b,y.normalizeZ)}multiplyUnsafe(b){const{endo:E,n:_}=e;di("scalar",b,er,_);const C=y.ZERO;if(b===er)return C;if(this.is0()||b===_e)return this;if(!E||O.hasPrecomputes(this))return O.wNAFCachedUnsafe(this,b,y.normalizeZ);let{k1neg:B,k1:A,k2neg:N,k2:j}=E.splitScalar(b),R=C,D=C,T=this;for(;A>er||j>er;)A&_e&&(R=R.add(T)),j&_e&&(D=D.add(T)),T=T.double(),A>>=_e,j>>=_e;return B&&(R=R.negate()),N&&(D=D.negate()),D=new y(r.mul(D.px,E.beta),D.py,D.pz),R.add(D)}multiply(b){const{endo:E,n:_}=e;di("scalar",b,_e,_);let C,B;if(E){const{k1neg:A,k1:N,k2neg:j,k2:R}=E.splitScalar(b);let{p:D,f:T}=this.wNAF(N),{p:g,f:w}=this.wNAF(R);D=O.constTimeNegate(A,D),g=O.constTimeNegate(j,g),g=new y(r.mul(g.px,E.beta),g.py,g.pz),C=D.add(g),B=T.add(w)}else{const{p:A,f:N}=this.wNAF(b);C=A,B=N}return y.normalizeZ([C,B])[0]}multiplyAndAddUnsafe(b,E,_){const C=y.BASE,B=(N,j)=>j===er||j===_e||!N.equals(C)?N.multiplyUnsafe(j):N.multiply(j),A=B(this,E).add(B(b,_));return A.is0()?void 0:A}toAffine(b){return p(this,b)}isTorsionFree(){const{h:b,isTorsionFree:E}=e;if(b===_e)return!0;if(E)return E(y,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:b,clearCofactor:E}=e;return b===_e?this:E?E(y,this):this.multiplyUnsafe(e.h)}toRawBytes(b=!0){return Yi("isCompressed",b),this.assertValidity(),n(y,this,b)}toHex(b=!0){return Yi("isCompressed",b),Zi(this.toRawBytes(b))}}y.BASE=new y(e.Gx,e.Gy,r.ONE),y.ZERO=new y(r.ZERO,r.ONE,r.ZERO);const{endo:m,nBitLength:x}=e,O=tm(y,m?Math.ceil(x/2):x);return{CURVE:e,ProjectivePoint:y,normPrivateKeyToScalar:h,weierstrassEquation:o,isWithinCurveOrder:u}}function am(t){const e=Zf(t);return ys(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function cm(t){const e=am(t),{Fp:r,n:i,nByteLength:n,nBitLength:s}=e,o=r.BYTES+1,a=2*r.BYTES+1;function c(g){return He(g,i)}function l(g){return Jo(g,i)}const{ProjectivePoint:u,normPrivateKeyToScalar:h,weierstrassEquation:f,isWithinCurveOrder:p}=om({...e,toBytes(g,w,I){const P=w.toAffine(),S=r.toBytes(P.x),$=Qn;return Yi("isCompressed",I),I?$(Uint8Array.from([w.hasEvenY()?2:3]),S):$(Uint8Array.from([4]),S,r.toBytes(P.y))},fromBytes(g){const w=g.length,I=g[0],P=g.subarray(1);if(w===o&&(I===2||I===3)){const S=Kr(P);if(!Za(S,_e,r.ORDER))throw new Error("Point is not on curve");const $=f(S);let U;try{U=r.sqrt($)}catch(F){const q=F instanceof Error?": "+F.message:"";throw new Error("Point is not on curve"+q)}const k=(U&_e)===_e;return(I&1)===1!==k&&(U=r.neg(U)),{x:S,y:U}}else if(w===a&&I===4){const S=r.fromBytes(P.subarray(0,r.BYTES)),$=r.fromBytes(P.subarray(r.BYTES,2*r.BYTES));return{x:S,y:$}}else{const S=o,$=a;throw new Error("invalid Point, expected length of "+S+", or uncompressed "+$+", got "+w)}}});function d(g){const w=i>>_e;return g>w}function y(g){return d(g)?c(-g):g}const m=(g,w,I)=>Kr(g.slice(w,I));class x{constructor(w,I,P){di("r",w,_e,i),di("s",I,_e,i),this.r=w,this.s=I,P!=null&&(this.recovery=P),Object.freeze(this)}static fromCompact(w){const I=n;return w=ft("compactSignature",w,I*2),new x(m(w,0,I),m(w,I,2*I))}static fromDER(w){const{r:I,s:P}=Xt.toSig(ft("DER",w));return new x(I,P)}assertValidity(){}addRecoveryBit(w){return new x(this.r,this.s,w)}recoverPublicKey(w){const{r:I,s:P,recovery:S}=this,$=C(ft("msgHash",w));if(S==null||![0,1,2,3].includes(S))throw new Error("recovery id invalid");const U=S===2||S===3?I+e.n:I;if(U>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const k=(S&1)===0?"02":"03",V=u.fromHex(k+eo(U,r.BYTES)),F=l(U),q=c(-$*F),H=c(P*F),G=u.BASE.multiplyAndAddUnsafe(V,q,H);if(!G)throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return d(this.s)}normalizeS(){return this.hasHighS()?new x(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Xn(this.toDERHex())}toDERHex(){return Xt.hexFromSig(this)}toCompactRawBytes(){return Xn(this.toCompactHex())}toCompactHex(){const w=n;return eo(this.r,w)+eo(this.s,w)}}const O={isValidPrivateKey(g){try{return h(g),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const g=Wf(e.n);return Xw(e.randomBytes(g),e.n)},precompute(g=8,w=u.BASE){return w._setWindowSize(g),w.multiply(BigInt(3)),w}};function v(g,w=!0){return u.fromPrivateKey(g).toRawBytes(w)}function b(g){if(typeof g=="bigint")return!1;if(g instanceof u)return!0;const I=ft("key",g).length,P=r.BYTES,S=P+1,$=2*P+1;if(!(e.allowedPrivateKeyLengths||n===S))return I===S||I===$}function E(g,w,I=!0){if(b(g)===!0)throw new Error("first arg must be private key");if(b(w)===!1)throw new Error("second arg must be public key");return u.fromHex(w).multiply(h(g)).toRawBytes(I)}const _=e.bits2int||function(g){if(g.length>8192)throw new Error("input is too large");const w=Kr(g),I=g.length*8-s;return I>0?w>>BigInt(I):w},C=e.bits2int_modN||function(g){return c(_(g))},B=gs(s);function A(g){return di("num < 2^"+s,g,er,B),cn(g,n)}function N(g,w,I=j){if(["recovered","canonical"].some(W=>W in I))throw new Error("sign() legacy options not supported");const{hash:P,randomBytes:S}=e;let{lowS:$,prehash:U,extraEntropy:k}=I;$==null&&($=!0),g=ft("msgHash",g),wl(I),U&&(g=ft("prehashed msgHash",P(g)));const V=C(g),F=h(w),q=[A(F),A(V)];if(k!=null&&k!==!1){const W=k===!0?S(r.BYTES):k;q.push(ft("extraEntropy",W))}const H=Qn(...q),G=V;function Z(W){const J=_(W);if(!p(J))return;const ue=l(J),ye=u.BASE.multiply(J).toAffine(),be=c(ye.x);if(be===er)return;const ke=c(ue*c(G+be*F));if(ke===er)return;let $t=(ye.x===be?0:2)|Number(ye.y&_e),wn=ke;return $&&d(ke)&&(wn=y(ke),$t^=1),new x(be,wn,$t)}return{seed:H,k2sig:Z}}const j={lowS:e.lowS,prehash:!1},R={lowS:e.lowS,prehash:!1};function D(g,w,I=j){const{seed:P,k2sig:S}=N(g,w,I),$=e;return ow($.hash.outputLen,$.nByteLength,$.hmac)(P,S)}u.BASE._setWindowSize(8);function T(g,w,I,P=R){const S=g;w=ft("msgHash",w),I=ft("publicKey",I);const{lowS:$,prehash:U,format:k}=P;if(wl(P),"strict"in P)throw new Error("options.strict was renamed to lowS");if(k!==void 0&&k!=="compact"&&k!=="der")throw new Error("format must be compact or der");const V=typeof S=="string"||an(S),F=!V&&!k&&typeof S=="object"&&S!==null&&typeof S.r=="bigint"&&typeof S.s=="bigint";if(!V&&!F)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let q,H;try{if(F&&(q=new x(S.r,S.s)),V){try{k!=="compact"&&(q=x.fromDER(S))}catch($t){if(!($t instanceof Xt.Err))throw $t}!q&&k!=="der"&&(q=x.fromCompact(S))}H=u.fromHex(I)}catch{return!1}if(!q||$&&q.hasHighS())return!1;U&&(w=e.hash(w));const{r:G,s:Z}=q,W=C(w),J=l(Z),ue=c(W*J),ye=c(G*J),be=u.BASE.multiplyAndAddUnsafe(H,ue,ye)?.toAffine();return be?c(be.x)===G:!1}return{CURVE:e,getPublicKey:v,getSharedSecret:E,sign:D,verify:T,ProjectivePoint:u,Signature:x,utils:O}}function lm(t){return{hash:t,hmac:(e,...r)=>Zg(t,e,Jg(...r)),randomBytes:Yg}}function um(t,e){const r=i=>cm({...t,...lm(i)});return{...r(e),create:r}}const Jf=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),ml=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),hm=BigInt(0),fm=BigInt(1),Qo=BigInt(2),bl=(t,e)=>(t+e/Qo)/e;function dm(t){const e=Jf,r=BigInt(3),i=BigInt(6),n=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=t*t*t%e,u=l*l*t%e,h=ct(u,r,e)*u%e,f=ct(h,r,e)*u%e,p=ct(f,Qo,e)*l%e,d=ct(p,n,e)*p%e,y=ct(d,s,e)*d%e,m=ct(y,a,e)*y%e,x=ct(m,c,e)*m%e,O=ct(x,a,e)*y%e,v=ct(O,r,e)*u%e,b=ct(v,o,e)*d%e,E=ct(b,i,e)*l%e,_=ct(E,Qo,e);if(!ea.eql(ea.sqr(_),t))throw new Error("Cannot find square root");return _}const ea=Qa(Jf,void 0,void 0,{sqrt:dm}),pm=um({a:hm,b:BigInt(7),Fp:ea,n:ml,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=ml,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-fm*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),n=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,o=BigInt("0x100000000000000000000000000000000"),a=bl(s*t,e),c=bl(-i*t,e);let l=He(t-a*r-c*n,e),u=He(-a*i-c*s,e);const h=l>o,f=u>o;if(h&&(l=e-l),f&&(u=e-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:l,k2neg:f,k2:u}}}},Xg);function gm(t){if(t.length!==130&&t.length!==132)throw new wm({signature:t});const e=BigInt(Jt(t,0,32)),r=BigInt(Jt(t,32,64)),i=(()=>{const n=+`0x${t.slice(130)}`;if(!Number.isNaN(n))try{return ym(n)}catch{throw new mm({value:n})}})();return typeof i>"u"?{r:e,s:r}:{r:e,s:r,yParity:i}}function ym(t){if(t===0||t===27)return 0;if(t===1||t===28)return 1;if(t>=35)return t%2===0?1:0;throw new bm({value:t})}class wm extends le{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${Or(Xa(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class mm extends le{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class bm extends le{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}function vm(t){return qw(Em(t))}function Em(t){const{payload:e,signature:r}=t,{r:i,s:n,yParity:s}=r,a=new pm.Signature(BigInt(i),BigInt(n)).addRecoveryBit(s).recoverPublicKey(Xa(e).substring(2));return Tw(a)}function xm(t){const e=t.length;let r=0,i=0;for(;i<e;){let n=t.charCodeAt(i++);if((n&4294967168)===0){r++;continue}else if((n&4294965248)===0)r+=2;else{if(n>=55296&&n<=56319&&i<e){const s=t.charCodeAt(i);(s&64512)===56320&&(++i,n=((n&1023)<<10)+(s&1023)+65536)}(n&4294901760)===0?r+=3:r+=4}}return r}function _m(t,e,r){const i=t.length;let n=r,s=0;for(;s<i;){let o=t.charCodeAt(s++);if((o&4294967168)===0){e[n++]=o;continue}else if((o&4294965248)===0)e[n++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&s<i){const a=t.charCodeAt(s);(a&64512)===56320&&(++s,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[n++]=o>>12&15|224,e[n++]=o>>6&63|128):(e[n++]=o>>18&7|240,e[n++]=o>>12&63|128,e[n++]=o>>6&63|128)}e[n++]=o&63|128}}const Im=new TextEncoder,Sm=50;function Om(t,e,r){Im.encodeInto(t,e.subarray(r))}function $m(t,e,r){t.length>Sm?Om(t,e,r):_m(t,e,r)}const Dm=4096;function Xf(t,e,r){let i=e;const n=i+r,s=[];let o="";for(;i<n;){const a=t[i++];if((a&128)===0)s.push(a);else if((a&224)===192){const c=t[i++]&63;s.push((a&31)<<6|c)}else if((a&240)===224){const c=t[i++]&63,l=t[i++]&63;s.push((a&31)<<12|c<<6|l)}else if((a&248)===240){const c=t[i++]&63,l=t[i++]&63,u=t[i++]&63;let h=(a&7)<<18|c<<12|l<<6|u;h>65535&&(h-=65536,s.push(h>>>10&1023|55296),h=56320|h&1023),s.push(h)}else s.push(a);s.length>=Dm&&(o+=String.fromCharCode(...s),s.length=0)}return s.length>0&&(o+=String.fromCharCode(...s)),o}const Am=new TextDecoder,Pm=200;function Cm(t,e,r){const i=t.subarray(e,e+r);return Am.decode(i)}function Bm(t,e,r){return r>Pm?Cm(t,e,r):Xf(t,e,r)}class En{type;data;constructor(e,r){this.type=e,this.data=r}}class it extends Error{constructor(e){super(e);const r=Object.create(it.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:it.name})}}const $i=4294967295;function Tm(t,e,r){const i=r/4294967296,n=r;t.setUint32(e,i),t.setUint32(e+4,n)}function Qf(t,e,r){const i=Math.floor(r/4294967296),n=r;t.setUint32(e,i),t.setUint32(e+4,n)}function ed(t,e){const r=t.getInt32(e),i=t.getUint32(e+4);return r*4294967296+i}function Rm(t,e){const r=t.getUint32(e),i=t.getUint32(e+4);return r*4294967296+i}const Nm=-1,Um=4294967296-1,jm=17179869184-1;function km({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=jm)if(e===0&&t<=Um){const r=new Uint8Array(4);return new DataView(r.buffer).setUint32(0,t),r}else{const r=t/4294967296,i=t&4294967295,n=new Uint8Array(8),s=new DataView(n.buffer);return s.setUint32(0,e<<2|r&3),s.setUint32(4,i),n}else{const r=new Uint8Array(12),i=new DataView(r.buffer);return i.setUint32(0,e),Qf(i,4,t),r}}function Lm(t){const e=t.getTime(),r=Math.floor(e/1e3),i=(e-r*1e3)*1e6,n=Math.floor(i/1e9);return{sec:r+n,nsec:i-n*1e9}}function Fm(t){if(t instanceof Date){const e=Lm(t);return km(e)}else return null}function Mm(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const r=e.getUint32(0),i=e.getUint32(4),n=(r&3)*4294967296+i,s=r>>>2;return{sec:n,nsec:s}}case 12:{const r=ed(e,4),i=e.getUint32(0);return{sec:r,nsec:i}}default:throw new it(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function qm(t){const e=Mm(t);return new Date(e.sec*1e3+e.nsec/1e6)}const zm={type:Nm,encode:Fm,decode:qm};class ws{static defaultCodec=new ws;__brand;builtInEncoders=[];builtInDecoders=[];encoders=[];decoders=[];constructor(){this.register(zm)}register({type:e,encode:r,decode:i}){if(e>=0)this.encoders[e]=r,this.decoders[e]=i;else{const n=-1-e;this.builtInEncoders[n]=r,this.builtInDecoders[n]=i}}tryToEncode(e,r){for(let i=0;i<this.builtInEncoders.length;i++){const n=this.builtInEncoders[i];if(n!=null){const s=n(e,r);if(s!=null){const o=-1-i;return new En(o,s)}}}for(let i=0;i<this.encoders.length;i++){const n=this.encoders[i];if(n!=null){const s=n(e,r);if(s!=null){const o=i;return new En(o,s)}}}return e instanceof En?e:null}decode(e,r,i){const n=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return n?n(e,r,i):new En(r,e)}}function Vm(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function ta(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Vm(t)?new Uint8Array(t):Uint8Array.from(t)}const Km=100,Hm=2048;let Wm=class td{extensionCodec;context;useBigInt64;maxDepth;initialBufferSize;sortKeys;forceFloat32;ignoreUndefined;forceIntegerToFloat;pos;view;bytes;entered=!1;constructor(e){this.extensionCodec=e?.extensionCodec??ws.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??Km,this.initialBufferSize=e?.initialBufferSize??Hm,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new td({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,r){if(r>this.maxDepth)throw new Error(`Too deep objects in depth ${r}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,r)}ensureBufferSizeToWrite(e){const r=this.pos+e;this.view.byteLength<r&&this.resizeBuffer(r*2)}resizeBuffer(e){const r=new ArrayBuffer(e),i=new Uint8Array(r),n=new DataView(r);i.set(this.bytes),this.view=n,this.bytes=i}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const i=xm(e);this.ensureBufferSizeToWrite(5+i),this.writeStringHeader(i),$m(e,this.bytes,this.pos),this.pos+=i}encodeObject(e,r){const i=this.extensionCodec.tryToEncode(e,this.context);if(i!=null)this.encodeExtension(i);else if(Array.isArray(e))this.encodeArray(e,r);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,r);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const r=e.byteLength;if(r<256)this.writeU8(196),this.writeU8(r);else if(r<65536)this.writeU8(197),this.writeU16(r);else if(r<4294967296)this.writeU8(198),this.writeU32(r);else throw new Error(`Too large binary: ${r}`);const i=ta(e);this.writeU8a(i)}encodeArray(e,r){const i=e.length;if(i<16)this.writeU8(144+i);else if(i<65536)this.writeU8(220),this.writeU16(i);else if(i<4294967296)this.writeU8(221),this.writeU32(i);else throw new Error(`Too large array: ${i}`);for(const n of e)this.doEncode(n,r+1)}countWithoutUndefined(e,r){let i=0;for(const n of r)e[n]!==void 0&&i++;return i}encodeMap(e,r){const i=Object.keys(e);this.sortKeys&&i.sort();const n=this.ignoreUndefined?this.countWithoutUndefined(e,i):i.length;if(n<16)this.writeU8(128+n);else if(n<65536)this.writeU8(222),this.writeU16(n);else if(n<4294967296)this.writeU8(223),this.writeU32(n);else throw new Error(`Too large map object: ${n}`);for(const s of i){const o=e[s];this.ignoreUndefined&&o===void 0||(this.encodeString(s),this.doEncode(o,r+1))}}encodeExtension(e){if(typeof e.data=="function"){const i=e.data(this.pos+6),n=i.length;if(n>=4294967296)throw new Error(`Too large extension object: ${n}`);this.writeU8(201),this.writeU32(n),this.writeI8(e.type),this.writeU8a(i);return}const r=e.data.length;if(r===1)this.writeU8(212);else if(r===2)this.writeU8(213);else if(r===4)this.writeU8(214);else if(r===8)this.writeU8(215);else if(r===16)this.writeU8(216);else if(r<256)this.writeU8(199),this.writeU8(r);else if(r<65536)this.writeU8(200),this.writeU16(r);else if(r<4294967296)this.writeU8(201),this.writeU32(r);else throw new Error(`Too large extension object: ${r}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const r=e.length;this.ensureBufferSizeToWrite(r),this.bytes.set(e,this.pos),this.pos+=r}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),Tm(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),Qf(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function Gm(t,e){return new Wm(e).encodeSharedRef(t)}function ro(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const Ym=16,Zm=16;class Jm{hit=0;miss=0;caches;maxKeyLength;maxLengthPerKey;constructor(e=Ym,r=Zm){this.maxKeyLength=e,this.maxLengthPerKey=r,this.caches=[];for(let i=0;i<this.maxKeyLength;i++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,r,i){const n=this.caches[i-1];e:for(const s of n){const o=s.bytes;for(let a=0;a<i;a++)if(o[a]!==e[r+a])continue e;return s.str}return null}store(e,r){const i=this.caches[e.length-1],n={bytes:e,str:r};i.length>=this.maxLengthPerKey?i[Math.random()*i.length|0]=n:i.push(n)}decode(e,r,i){const n=this.find(e,r,i);if(n!=null)return this.hit++,n;this.miss++;const s=Xf(e,r,i),o=Uint8Array.prototype.slice.call(e,r,r+i);return this.store(o,s),s}}const ra="array",qi="map_key",rd="map_value",Xm=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new it("The type of key must be string or number but "+typeof t)};class Qm{stack=[];stackHeadPosition=-1;get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const r=this.getUninitializedStateFromPool();r.type=ra,r.position=0,r.size=e,r.array=new Array(e)}pushMapState(e){const r=this.getUninitializedStateFromPool();r.type=qi,r.readCount=0,r.size=e,r.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===ra){const i=e;i.size=0,i.array=void 0,i.position=0,i.type=void 0}if(e.type===qi||e.type===rd){const i=e;i.size=0,i.map=void 0,i.readCount=0,i.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const Di=-1,ec=new DataView(new ArrayBuffer(0)),e0=new Uint8Array(ec.buffer);try{ec.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const vl=new RangeError("Insufficient data"),t0=new Jm;let r0=class id{extensionCodec;context;useBigInt64;rawStrings;maxStrLength;maxBinLength;maxArrayLength;maxMapLength;maxExtLength;keyDecoder;mapKeyConverter;totalPos=0;pos=0;view=ec;bytes=e0;headByte=Di;stack=new Qm;entered=!1;constructor(e){this.extensionCodec=e?.extensionCodec??ws.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.rawStrings=e?.rawStrings??!1,this.maxStrLength=e?.maxStrLength??$i,this.maxBinLength=e?.maxBinLength??$i,this.maxArrayLength=e?.maxArrayLength??$i,this.maxMapLength=e?.maxMapLength??$i,this.maxExtLength=e?.maxExtLength??$i,this.keyDecoder=e?.keyDecoder!==void 0?e.keyDecoder:t0,this.mapKeyConverter=e?.mapKeyConverter??Xm}clone(){return new id({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=Di,this.stack.reset()}setBuffer(e){const r=ta(e);this.bytes=r,this.view=new DataView(r.buffer,r.byteOffset,r.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===Di&&!this.hasRemaining(1))this.setBuffer(e);else{const r=this.bytes.subarray(this.pos),i=ta(e),n=new Uint8Array(r.length+i.length);n.set(r),n.set(i,r.length),this.setBuffer(n)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:r,pos:i}=this;return new RangeError(`Extra ${r.byteLength-i} of ${r.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const r=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return r}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let r=!1,i;for await(const a of e){if(r)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{i=this.doDecodeSync(),r=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(r){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return i}const{headByte:n,pos:s,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${ro(n)} at ${o} (${s} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,r){if(this.entered){yield*this.clone().decodeMultiAsync(e,r);return}try{this.entered=!0;let i=r,n=-1;for await(const s of e){if(r&&n===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s),i&&(n=this.readArraySize(),i=!1,this.complete());try{for(;yield this.doDecodeSync(),--n!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let r;if(e>=224)r=e-256;else if(e<192)if(e<128)r=e;else if(e<144){const n=e-128;if(n!==0){this.pushMapState(n),this.complete();continue e}else r={}}else if(e<160){const n=e-144;if(n!==0){this.pushArrayState(n),this.complete();continue e}else r=[]}else{const n=e-160;r=this.decodeString(n,0)}else if(e===192)r=null;else if(e===194)r=!1;else if(e===195)r=!0;else if(e===202)r=this.readF32();else if(e===203)r=this.readF64();else if(e===204)r=this.readU8();else if(e===205)r=this.readU16();else if(e===206)r=this.readU32();else if(e===207)this.useBigInt64?r=this.readU64AsBigInt():r=this.readU64();else if(e===208)r=this.readI8();else if(e===209)r=this.readI16();else if(e===210)r=this.readI32();else if(e===211)this.useBigInt64?r=this.readI64AsBigInt():r=this.readI64();else if(e===217){const n=this.lookU8();r=this.decodeString(n,1)}else if(e===218){const n=this.lookU16();r=this.decodeString(n,2)}else if(e===219){const n=this.lookU32();r=this.decodeString(n,4)}else if(e===220){const n=this.readU16();if(n!==0){this.pushArrayState(n),this.complete();continue e}else r=[]}else if(e===221){const n=this.readU32();if(n!==0){this.pushArrayState(n),this.complete();continue e}else r=[]}else if(e===222){const n=this.readU16();if(n!==0){this.pushMapState(n),this.complete();continue e}else r={}}else if(e===223){const n=this.readU32();if(n!==0){this.pushMapState(n),this.complete();continue e}else r={}}else if(e===196){const n=this.lookU8();r=this.decodeBinary(n,1)}else if(e===197){const n=this.lookU16();r=this.decodeBinary(n,2)}else if(e===198){const n=this.lookU32();r=this.decodeBinary(n,4)}else if(e===212)r=this.decodeExtension(1,0);else if(e===213)r=this.decodeExtension(2,0);else if(e===214)r=this.decodeExtension(4,0);else if(e===215)r=this.decodeExtension(8,0);else if(e===216)r=this.decodeExtension(16,0);else if(e===199){const n=this.lookU8();r=this.decodeExtension(n,1)}else if(e===200){const n=this.lookU16();r=this.decodeExtension(n,2)}else if(e===201){const n=this.lookU32();r=this.decodeExtension(n,4)}else throw new it(`Unrecognized type byte: ${ro(e)}`);this.complete();const i=this.stack;for(;i.length>0;){const n=i.top();if(n.type===ra)if(n.array[n.position]=r,n.position++,n.position===n.size)r=n.array,i.release(n);else continue e;else if(n.type===qi){if(r==="__proto__")throw new it("The key __proto__ is not allowed");n.key=this.mapKeyConverter(r),n.type=rd;continue e}else if(n.map[n.key]=r,n.readCount++,n.readCount===n.size)r=n.map,i.release(n);else{n.key=null,n.type=qi;continue e}}return r}}readHeadByte(){return this.headByte===Di&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=Di}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new it(`Unrecognized array type byte: ${ro(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new it(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new it(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,r){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,r):this.decodeBinary(e,r)}decodeUtf8String(e,r){if(e>this.maxStrLength)throw new it(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+r+e)throw vl;const i=this.pos+r;let n;return this.stateIsMapKey()&&this.keyDecoder?.canBeCached(e)?n=this.keyDecoder.decode(this.bytes,i,e):n=Bm(this.bytes,i,e),this.pos+=r+e,n}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===qi:!1}decodeBinary(e,r){if(e>this.maxBinLength)throw new it(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+r))throw vl;const i=this.pos+r,n=this.bytes.subarray(i,i+e);return this.pos+=r+e,n}decodeExtension(e,r){if(e>this.maxExtLength)throw new it(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const i=this.view.getInt8(this.pos+r),n=this.decodeBinary(e,r+1);return this.extensionCodec.decode(n,i,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=Rm(this.view,this.pos);return this.pos+=8,e}readI64(){const e=ed(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function i0(t,e){return new r0(e).decode(t)}const n0=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),s0=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,n)=>typeof n=="string"&&n.match(/^\d+n$/)?BigInt(n.substring(0,n.length-1)):n)};function Hr(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return s0(t)}catch{return t}}function Wr(t){return typeof t=="string"?t:n0(t)||""}function o0(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function nd(t,...e){if(!o0(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function El(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function a0(t,e){nd(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const ri=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const io=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function c0(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function sd(t){return typeof t=="string"&&(t=c0(t)),nd(t),t}let l0=class{clone(){return this._cloneInto()}};function u0(t){const e=i=>t().update(sd(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function od(t=32){if(ri&&typeof ri.getRandomValues=="function")return ri.getRandomValues(new Uint8Array(t));if(ri&&typeof ri.randomBytes=="function")return ri.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function h0(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const n=BigInt(32),s=BigInt(4294967295),o=Number(r>>n&s),a=Number(r&s),c=i?4:0,l=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+l,a,i)}let f0=class extends l0{constructor(e,r,i,n){super(),this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=io(this.buffer)}update(e){El(this);const{view:r,buffer:i,blockLen:n}=this;e=sd(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(n-this.pos,s-o);if(a===n){const c=io(e);for(;n<=s-o;o+=n)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===n&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){El(this),a0(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:n,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>n-o&&(this.process(i,0),o=0);for(let h=o;h<n;h++)r[h]=0;h0(i,n-8,BigInt(this.length*8),s),this.process(i,0);const a=io(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:n,finished:s,destroyed:o,pos:a}=this;return e.length=n,e.pos=a,e.finished=s,e.destroyed=o,n%r&&e.buffer.set(i),e}};const xn=BigInt(2**32-1),ia=BigInt(32);function ad(t,e=!1){return e?{h:Number(t&xn),l:Number(t>>ia&xn)}:{h:Number(t>>ia&xn)|0,l:Number(t&xn)|0}}function d0(t,e=!1){let r=new Uint32Array(t.length),i=new Uint32Array(t.length);for(let n=0;n<t.length;n++){const{h:s,l:o}=ad(t[n],e);[r[n],i[n]]=[s,o]}return[r,i]}const p0=(t,e)=>BigInt(t>>>0)<<ia|BigInt(e>>>0),g0=(t,e,r)=>t>>>r,y0=(t,e,r)=>t<<32-r|e>>>r,w0=(t,e,r)=>t>>>r|e<<32-r,m0=(t,e,r)=>t<<32-r|e>>>r,b0=(t,e,r)=>t<<64-r|e>>>r-32,v0=(t,e,r)=>t>>>r-32|e<<64-r,E0=(t,e)=>e,x0=(t,e)=>t,_0=(t,e,r)=>t<<r|e>>>32-r,I0=(t,e,r)=>e<<r|t>>>32-r,S0=(t,e,r)=>e<<r-32|t>>>64-r,O0=(t,e,r)=>t<<r-32|e>>>64-r;function $0(t,e,r,i){const n=(e>>>0)+(i>>>0);return{h:t+r+(n/2**32|0)|0,l:n|0}}const D0=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),A0=(t,e,r,i)=>e+r+i+(t/2**32|0)|0,P0=(t,e,r,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0),C0=(t,e,r,i,n)=>e+r+i+n+(t/2**32|0)|0,B0=(t,e,r,i,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0)+(n>>>0),T0=(t,e,r,i,n,s)=>e+r+i+n+s+(t/2**32|0)|0,Y={fromBig:ad,split:d0,toBig:p0,shrSH:g0,shrSL:y0,rotrSH:w0,rotrSL:m0,rotrBH:b0,rotrBL:v0,rotr32H:E0,rotr32L:x0,rotlSH:_0,rotlSL:I0,rotlBH:S0,rotlBL:O0,add:$0,add3L:D0,add3H:A0,add4L:P0,add4H:C0,add5H:T0,add5L:B0},[R0,N0]=Y.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),ar=new Uint32Array(80),cr=new Uint32Array(80);let U0=class extends f0{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:i,Bl:n,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:f,Gh:p,Gl:d,Hh:y,Hl:m}=this;return[e,r,i,n,s,o,a,c,l,u,h,f,p,d,y,m]}set(e,r,i,n,s,o,a,c,l,u,h,f,p,d,y,m){this.Ah=e|0,this.Al=r|0,this.Bh=i|0,this.Bl=n|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=f|0,this.Gh=p|0,this.Gl=d|0,this.Hh=y|0,this.Hl=m|0}process(e,r){for(let v=0;v<16;v++,r+=4)ar[v]=e.getUint32(r),cr[v]=e.getUint32(r+=4);for(let v=16;v<80;v++){const b=ar[v-15]|0,E=cr[v-15]|0,_=Y.rotrSH(b,E,1)^Y.rotrSH(b,E,8)^Y.shrSH(b,E,7),C=Y.rotrSL(b,E,1)^Y.rotrSL(b,E,8)^Y.shrSL(b,E,7),B=ar[v-2]|0,A=cr[v-2]|0,N=Y.rotrSH(B,A,19)^Y.rotrBH(B,A,61)^Y.shrSH(B,A,6),j=Y.rotrSL(B,A,19)^Y.rotrBL(B,A,61)^Y.shrSL(B,A,6),R=Y.add4L(C,j,cr[v-7],cr[v-16]),D=Y.add4H(R,_,N,ar[v-7],ar[v-16]);ar[v]=D|0,cr[v]=R|0}let{Ah:i,Al:n,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:f,Fh:p,Fl:d,Gh:y,Gl:m,Hh:x,Hl:O}=this;for(let v=0;v<80;v++){const b=Y.rotrSH(h,f,14)^Y.rotrSH(h,f,18)^Y.rotrBH(h,f,41),E=Y.rotrSL(h,f,14)^Y.rotrSL(h,f,18)^Y.rotrBL(h,f,41),_=h&p^~h&y,C=f&d^~f&m,B=Y.add5L(O,E,C,N0[v],cr[v]),A=Y.add5H(B,x,b,_,R0[v],ar[v]),N=B|0,j=Y.rotrSH(i,n,28)^Y.rotrBH(i,n,34)^Y.rotrBH(i,n,39),R=Y.rotrSL(i,n,28)^Y.rotrBL(i,n,34)^Y.rotrBL(i,n,39),D=i&s^i&a^s&a,T=n&o^n&c^o&c;x=y|0,O=m|0,y=p|0,m=d|0,p=h|0,d=f|0,{h,l:f}=Y.add(l|0,u|0,A|0,N|0),l=a|0,u=c|0,a=s|0,c=o|0,s=i|0,o=n|0;const g=Y.add3L(N,R,T);i=Y.add3H(g,A,j,D),n=g|0}({h:i,l:n}=Y.add(this.Ah|0,this.Al|0,i|0,n|0)),{h:s,l:o}=Y.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Y.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=Y.add(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:f}=Y.add(this.Eh|0,this.El|0,h|0,f|0),{h:p,l:d}=Y.add(this.Fh|0,this.Fl|0,p|0,d|0),{h:y,l:m}=Y.add(this.Gh|0,this.Gl|0,y|0,m|0),{h:x,l:O}=Y.add(this.Hh|0,this.Hl|0,x|0,O|0),this.set(i,n,s,o,a,c,l,u,h,f,p,d,y,m,x,O)}roundClean(){ar.fill(0),cr.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const j0=u0(()=>new U0);const tc=BigInt(0),cd=BigInt(1),k0=BigInt(2);function rc(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ic(t){if(!rc(t))throw new Error("Uint8Array expected")}function no(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const L0=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function nc(t){ic(t);let e="";for(let r=0;r<t.length;r++)e+=L0[t[r]];return e}function ld(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?tc:BigInt("0x"+t)}const Vt={_0:48,_9:57,A:65,F:70,a:97,f:102};function xl(t){if(t>=Vt._0&&t<=Vt._9)return t-Vt._0;if(t>=Vt.A&&t<=Vt.F)return t-(Vt.A-10);if(t>=Vt.a&&t<=Vt.f)return t-(Vt.a-10)}function ud(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let n=0,s=0;n<r;n++,s+=2){const o=xl(t.charCodeAt(s)),a=xl(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[n]=o*16+a}return i}function F0(t){return ld(nc(t))}function Mn(t){return ic(t),ld(nc(Uint8Array.from(t).reverse()))}function hd(t,e){return ud(t.toString(16).padStart(e*2,"0"))}function na(t,e){return hd(t,e).reverse()}function Kt(t,e,r){let i;if(typeof e=="string")try{i=ud(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(rc(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const n=i.length;if(typeof r=="number"&&n!==r)throw new Error(t+" of length "+r+" expected, got "+n);return i}function _l(...t){let e=0;for(let i=0;i<t.length;i++){const n=t[i];ic(n),e+=n.length}const r=new Uint8Array(e);for(let i=0,n=0;i<t.length;i++){const s=t[i];r.set(s,n),n+=s.length}return r}const so=t=>typeof t=="bigint"&&tc<=t;function M0(t,e,r){return so(t)&&so(e)&&so(r)&&e<=t&&t<r}function Ai(t,e,r,i){if(!M0(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function q0(t){let e;for(e=0;t>tc;t>>=cd,e+=1);return e}const z0=t=>(k0<<BigInt(t-1))-cd,V0={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||rc(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function sc(t,e,r={}){const i=(n,s,o)=>{const a=V0[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[n];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(n)+" is invalid. Expected "+s+", got "+c)};for(const[n,s]of Object.entries(e))i(n,s,!1);for(const[n,s]of Object.entries(r))i(n,s,!0);return t}function Il(t){const e=new WeakMap;return(r,...i)=>{const n=e.get(r);if(n!==void 0)return n;const s=t(r,...i);return e.set(r,s),s}}const Se=BigInt(0),fe=BigInt(1),kr=BigInt(2),K0=BigInt(3),sa=BigInt(4),Sl=BigInt(5),Ol=BigInt(8);function me(t,e){const r=t%e;return r>=Se?r:e+r}function H0(t,e,r){if(e<Se)throw new Error("invalid exponent, negatives unsupported");if(r<=Se)throw new Error("invalid modulus");if(r===fe)return Se;let i=fe;for(;e>Se;)e&fe&&(i=i*t%r),t=t*t%r,e>>=fe;return i}function Dt(t,e,r){let i=t;for(;e-- >Se;)i*=i,i%=r;return i}function $l(t,e){if(t===Se)throw new Error("invert: expected non-zero number");if(e<=Se)throw new Error("invert: expected positive modulus, got "+e);let r=me(t,e),i=e,n=Se,s=fe;for(;r!==Se;){const o=i/r,a=i%r,c=n-s*o;i=r,r=a,n=s,s=c}if(i!==fe)throw new Error("invert: does not exist");return me(n,e)}function W0(t){const e=(t-fe)/kr;let r,i,n;for(r=t-fe,i=0;r%kr===Se;r/=kr,i++);for(n=kr;n<t&&H0(n,e,t)!==t-fe;n++)if(n>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const o=(t+fe)/sa;return function(a,c){const l=a.pow(c,o);if(!a.eql(a.sqr(l),c))throw new Error("Cannot find square root");return l}}const s=(r+fe)/kr;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=i,l=o.pow(o.mul(o.ONE,n),r),u=o.pow(a,s),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let f=1;for(let d=o.sqr(h);f<c&&!o.eql(d,o.ONE);f++)d=o.sqr(d);const p=o.pow(l,fe<<BigInt(c-f-1));l=o.sqr(p),u=o.mul(u,p),h=o.mul(h,l),c=f}return u}}function G0(t){if(t%sa===K0){const e=(t+fe)/sa;return function(r,i){const n=r.pow(i,e);if(!r.eql(r.sqr(n),i))throw new Error("Cannot find square root");return n}}if(t%Ol===Sl){const e=(t-Sl)/Ol;return function(r,i){const n=r.mul(i,kr),s=r.pow(n,e),o=r.mul(i,s),a=r.mul(r.mul(o,kr),s),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return W0(t)}const Y0=(t,e)=>(me(t,e)&fe)===fe,Z0=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function J0(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=Z0.reduce((i,n)=>(i[n]="function",i),e);return sc(t,r)}function X0(t,e,r){if(r<Se)throw new Error("invalid exponent, negatives unsupported");if(r===Se)return t.ONE;if(r===fe)return e;let i=t.ONE,n=e;for(;r>Se;)r&fe&&(i=t.mul(i,n)),n=t.sqr(n),r>>=fe;return i}function Q0(t,e){const r=new Array(e.length),i=e.reduce((s,o,a)=>t.is0(o)?s:(r[a]=s,t.mul(s,o)),t.ONE),n=t.inv(i);return e.reduceRight((s,o,a)=>t.is0(o)?s:(r[a]=t.mul(s,r[a]),t.mul(s,o)),n),r}function fd(t,e){const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function dd(t,e,r=!1,i={}){if(t<=Se)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:n,nByteLength:s}=fd(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:n,BYTES:s,MASK:z0(n),ZERO:Se,ONE:fe,create:c=>me(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Se<=c&&c<t},is0:c=>c===Se,isOdd:c=>(c&fe)===fe,neg:c=>me(-c,t),eql:(c,l)=>c===l,sqr:c=>me(c*c,t),add:(c,l)=>me(c+l,t),sub:(c,l)=>me(c-l,t),mul:(c,l)=>me(c*l,t),pow:(c,l)=>X0(a,c,l),div:(c,l)=>me(c*$l(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>$l(c,t),sqrt:i.sqrt||(c=>(o||(o=G0(t)),o(a,c))),invertBatch:c=>Q0(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>r?na(c,s):hd(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?Mn(c):F0(c)}});return Object.freeze(a)}const Dl=BigInt(0),_n=BigInt(1);function oo(t,e){const r=e.negate();return t?r:e}function pd(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function ao(t,e){pd(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1);return{windows:r,windowSize:i}}function eb(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function tb(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const co=new WeakMap,gd=new WeakMap;function lo(t){return gd.get(t)||1}function rb(t,e){return{constTimeNegate:oo,hasPrecomputes(r){return lo(r)!==1},unsafeLadder(r,i,n=t.ZERO){let s=r;for(;i>Dl;)i&_n&&(n=n.add(s)),s=s.double(),i>>=_n;return n},precomputeWindow(r,i){const{windows:n,windowSize:s}=ao(i,e),o=[];let a=r,c=a;for(let l=0;l<n;l++){c=a,o.push(c);for(let u=1;u<s;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,i,n){const{windows:s,windowSize:o}=ao(r,e);let a=t.ZERO,c=t.BASE;const l=BigInt(2**r-1),u=2**r,h=BigInt(r);for(let f=0;f<s;f++){const p=f*o;let d=Number(n&l);n>>=h,d>o&&(d-=u,n+=_n);const y=p,m=p+Math.abs(d)-1,x=f%2!==0,O=d<0;d===0?c=c.add(oo(x,i[y])):a=a.add(oo(O,i[m]))}return{p:a,f:c}},wNAFUnsafe(r,i,n,s=t.ZERO){const{windows:o,windowSize:a}=ao(r,e),c=BigInt(2**r-1),l=2**r,u=BigInt(r);for(let h=0;h<o;h++){const f=h*a;if(n===Dl)break;let p=Number(n&c);if(n>>=u,p>a&&(p-=l,n+=_n),p===0)continue;let d=i[f+Math.abs(p)-1];p<0&&(d=d.negate()),s=s.add(d)}return s},getPrecomputes(r,i,n){let s=co.get(i);return s||(s=this.precomputeWindow(i,r),r!==1&&co.set(i,n(s))),s},wNAFCached(r,i,n){const s=lo(r);return this.wNAF(s,this.getPrecomputes(s,r,n),i)},wNAFCachedUnsafe(r,i,n,s){const o=lo(r);return o===1?this.unsafeLadder(r,i,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,n),i,s)},setWindowSize(r,i){pd(i,e),gd.set(r,i),co.delete(r)}}}function ib(t,e,r,i){if(eb(r,t),tb(i,e),r.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const n=t.ZERO,s=q0(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(n),l=Math.floor((e.BITS-1)/o)*o;let u=n;for(let h=l;h>=0;h-=o){c.fill(n);for(let p=0;p<i.length;p++){const d=i[p],y=Number(d>>BigInt(h)&BigInt(a));c[y]=c[y].add(r[p])}let f=n;for(let p=c.length-1,d=n;p>0;p--)d=d.add(c[p]),f=f.add(d);if(u=u.add(f),h!==0)for(let p=0;p<o;p++)u=u.double()}return u}function nb(t){return J0(t.Fp),sc(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...fd(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const mt=BigInt(0),qe=BigInt(1),In=BigInt(2),sb=BigInt(8),ob={zip215:!0};function ab(t){const e=nb(t);return sc(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function cb(t){const e=ab(t),{Fp:r,n:i,prehash:n,hash:s,randomBytes:o,nByteLength:a,h:c}=e,l=In<<BigInt(a*8)-qe,u=r.create,h=dd(e.n,e.nBitLength),f=e.uvRatio||((g,w)=>{try{return{isValid:!0,value:r.sqrt(g*r.inv(w))}}catch{return{isValid:!1,value:mt}}}),p=e.adjustScalarBytes||(g=>g),d=e.domain||((g,w,I)=>{if(no("phflag",I),w.length||I)throw new Error("Contexts/pre-hash are not supported");return g});function y(g,w){Ai("coordinate "+g,w,mt,l)}function m(g){if(!(g instanceof v))throw new Error("ExtendedPoint expected")}const x=Il((g,w)=>{const{ex:I,ey:P,ez:S}=g,$=g.is0();w==null&&(w=$?sb:r.inv(S));const U=u(I*w),k=u(P*w),V=u(S*w);if($)return{x:mt,y:qe};if(V!==qe)throw new Error("invZ was invalid");return{x:U,y:k}}),O=Il(g=>{const{a:w,d:I}=e;if(g.is0())throw new Error("bad point: ZERO");const{ex:P,ey:S,ez:$,et:U}=g,k=u(P*P),V=u(S*S),F=u($*$),q=u(F*F),H=u(k*w),G=u(F*u(H+V)),Z=u(q+u(I*u(k*V)));if(G!==Z)throw new Error("bad point: equation left != right (1)");const W=u(P*S),J=u($*U);if(W!==J)throw new Error("bad point: equation left != right (2)");return!0});class v{constructor(w,I,P,S){this.ex=w,this.ey=I,this.ez=P,this.et=S,y("x",w),y("y",I),y("z",P),y("t",S),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(w){if(w instanceof v)throw new Error("extended point not allowed");const{x:I,y:P}=w||{};return y("x",I),y("y",P),new v(I,P,qe,u(I*P))}static normalizeZ(w){const I=r.invertBatch(w.map(P=>P.ez));return w.map((P,S)=>P.toAffine(I[S])).map(v.fromAffine)}static msm(w,I){return ib(v,h,w,I)}_setWindowSize(w){_.setWindowSize(this,w)}assertValidity(){O(this)}equals(w){m(w);const{ex:I,ey:P,ez:S}=this,{ex:$,ey:U,ez:k}=w,V=u(I*k),F=u($*S),q=u(P*k),H=u(U*S);return V===F&&q===H}is0(){return this.equals(v.ZERO)}negate(){return new v(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:w}=e,{ex:I,ey:P,ez:S}=this,$=u(I*I),U=u(P*P),k=u(In*u(S*S)),V=u(w*$),F=I+P,q=u(u(F*F)-$-U),H=V+U,G=H-k,Z=V-U,W=u(q*G),J=u(H*Z),ue=u(q*Z),ye=u(G*H);return new v(W,J,ye,ue)}add(w){m(w);const{a:I,d:P}=e,{ex:S,ey:$,ez:U,et:k}=this,{ex:V,ey:F,ez:q,et:H}=w;if(I===BigInt(-1)){const Tc=u(($-S)*(F+V)),Rc=u(($+S)*(F-V)),ks=u(Rc-Tc);if(ks===mt)return this.double();const Nc=u(U*In*H),Uc=u(k*In*q),jc=Uc+Nc,kc=Rc+Tc,Lc=Uc-Nc,zg=u(jc*ks),Vg=u(kc*Lc),Kg=u(jc*Lc),Hg=u(ks*kc);return new v(zg,Vg,Hg,Kg)}const G=u(S*V),Z=u($*F),W=u(k*P*H),J=u(U*q),ue=u((S+$)*(V+F)-G-Z),ye=J-W,be=J+W,ke=u(Z-I*G),$t=u(ue*ye),wn=u(be*ke),Mg=u(ue*ke),qg=u(ye*be);return new v($t,wn,qg,Mg)}subtract(w){return this.add(w.negate())}wNAF(w){return _.wNAFCached(this,w,v.normalizeZ)}multiply(w){const I=w;Ai("scalar",I,qe,i);const{p:P,f:S}=this.wNAF(I);return v.normalizeZ([P,S])[0]}multiplyUnsafe(w,I=v.ZERO){const P=w;return Ai("scalar",P,mt,i),P===mt?E:this.is0()||P===qe?this:_.wNAFCachedUnsafe(this,P,v.normalizeZ,I)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return _.unsafeLadder(this,i).is0()}toAffine(w){return x(this,w)}clearCofactor(){const{h:w}=e;return w===qe?this:this.multiplyUnsafe(w)}static fromHex(w,I=!1){const{d:P,a:S}=e,$=r.BYTES;w=Kt("pointHex",w,$),no("zip215",I);const U=w.slice(),k=w[$-1];U[$-1]=k&-129;const V=Mn(U),F=I?l:r.ORDER;Ai("pointHex.y",V,mt,F);const q=u(V*V),H=u(q-qe),G=u(P*q-S);let{isValid:Z,value:W}=f(H,G);if(!Z)throw new Error("Point.fromHex: invalid y coordinate");const J=(W&qe)===qe,ue=(k&128)!==0;if(!I&&W===mt&&ue)throw new Error("Point.fromHex: x=0 and x_0=1");return ue!==J&&(W=u(-W)),v.fromAffine({x:W,y:V})}static fromPrivateKey(w){return A(w).point}toRawBytes(){const{x:w,y:I}=this.toAffine(),P=na(I,r.BYTES);return P[P.length-1]|=w&qe?128:0,P}toHex(){return nc(this.toRawBytes())}}v.BASE=new v(e.Gx,e.Gy,qe,u(e.Gx*e.Gy)),v.ZERO=new v(mt,qe,qe,mt);const{BASE:b,ZERO:E}=v,_=rb(v,a*8);function C(g){return me(g,i)}function B(g){return C(Mn(g))}function A(g){const w=r.BYTES;g=Kt("private key",g,w);const I=Kt("hashed private key",s(g),2*w),P=p(I.slice(0,w)),S=I.slice(w,2*w),$=B(P),U=b.multiply($),k=U.toRawBytes();return{head:P,prefix:S,scalar:$,point:U,pointBytes:k}}function N(g){return A(g).pointBytes}function j(g=new Uint8Array,...w){const I=_l(...w);return B(s(d(I,Kt("context",g),!!n)))}function R(g,w,I={}){g=Kt("message",g),n&&(g=n(g));const{prefix:P,scalar:S,pointBytes:$}=A(w),U=j(I.context,P,g),k=b.multiply(U).toRawBytes(),V=j(I.context,k,$,g),F=C(U+V*S);Ai("signature.s",F,mt,i);const q=_l(k,na(F,r.BYTES));return Kt("result",q,r.BYTES*2)}const D=ob;function T(g,w,I,P=D){const{context:S,zip215:$}=P,U=r.BYTES;g=Kt("signature",g,2*U),w=Kt("message",w),I=Kt("publicKey",I,U),$!==void 0&&no("zip215",$),n&&(w=n(w));const k=Mn(g.slice(U,2*U));let V,F,q;try{V=v.fromHex(I,$),F=v.fromHex(g.slice(0,U),$),q=b.multiplyUnsafe(k)}catch{return!1}if(!$&&V.isSmallOrder())return!1;const H=j(S,F.toRawBytes(),V.toRawBytes(),w);return F.add(V.multiplyUnsafe(H)).subtract(q).clearCofactor().equals(v.ZERO)}return b._setWindowSize(8),{CURVE:e,getPublicKey:N,sign:R,verify:T,ExtendedPoint:v,utils:{getExtendedPublicKey:A,randomPrivateKey:()=>o(r.BYTES),precompute(g=8,w=v.BASE){return w._setWindowSize(g),w.multiply(BigInt(3)),w}}}}BigInt(0),BigInt(1);const oc=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Al=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const lb=BigInt(1),Pl=BigInt(2);BigInt(3);const ub=BigInt(5),hb=BigInt(8);function fb(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),n=BigInt(80),s=oc,o=t*t%s*t%s,a=Dt(o,Pl,s)*o%s,c=Dt(a,lb,s)*t%s,l=Dt(c,ub,s)*c%s,u=Dt(l,e,s)*l%s,h=Dt(u,r,s)*u%s,f=Dt(h,i,s)*h%s,p=Dt(f,n,s)*f%s,d=Dt(p,n,s)*f%s,y=Dt(d,e,s)*l%s;return{pow_p_5_8:Dt(y,Pl,s)*t%s,b2:o}}function db(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function pb(t,e){const r=oc,i=me(e*e*e,r),n=me(i*i*e,r),s=fb(t*n).pow_p_5_8;let o=me(t*i*s,r);const a=me(e*o*o,r),c=o,l=me(o*Al,r),u=a===t,h=a===me(-t,r),f=a===me(-t*Al,r);return u&&(o=c),(h||f)&&(o=l),Y0(o,r)&&(o=me(-o,r)),{isValid:u||h,value:o}}const gb=dd(oc,void 0,!0),yb={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:gb,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:hb,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:j0,randomBytes:od,adjustScalarBytes:db,uvRatio:pb},yd=cb(yb),wb="EdDSA",mb="JWT",ts=".",ms="base64url",wd="utf8",md="utf8",bb=":",vb="did",Eb="key",Cl="base58btc",xb="z",_b="K36",Ib=32;function ac(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function bd(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ac(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function vd(t,e){e||(e=t.reduce((n,s)=>n+s.length,0));const r=bd(e);let i=0;for(const n of t)r.set(n,i),i+=n.length;return ac(r)}function Sb(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=n}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var y=0,m=0,x=0,O=d.length;x!==O&&d[x]===0;)x++,y++;for(var v=(O-x)*u+1>>>0,b=new Uint8Array(v);x!==O;){for(var E=d[x],_=0,C=v-1;(E!==0||_<m)&&C!==-1;C--,_++)E+=256*b[C]>>>0,b[C]=E%a>>>0,E=E/a>>>0;if(E!==0)throw new Error("Non-zero carry");m=_,x++}for(var B=v-m;B!==v&&b[B]===0;)B++;for(var A=c.repeat(y);B<v;++B)A+=t.charAt(b[B]);return A}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var y=0;if(d[y]!==" "){for(var m=0,x=0;d[y]===c;)m++,y++;for(var O=(d.length-y)*l+1>>>0,v=new Uint8Array(O);d[y];){var b=r[d.charCodeAt(y)];if(b===255)return;for(var E=0,_=O-1;(b!==0||E<x)&&_!==-1;_--,E++)b+=a*v[_]>>>0,v[_]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");x=E,y++}if(d[y]!==" "){for(var C=O-x;C!==O&&v[C]===0;)C++;for(var B=new Uint8Array(m+(O-C)),A=m;C!==O;)B[A++]=v[C++];return B}}}function p(d){var y=f(d);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var Ob=Sb,$b=Ob;const Ed=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Db=t=>new TextEncoder().encode(t),Ab=t=>new TextDecoder().decode(t);let Pb=class{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Cb=class{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return xd(this,e)}},Bb=class{constructor(e){this.decoders=e}or(e){return xd(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const xd=(t,e)=>new Bb({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let Tb=class{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new Pb(e,r,i),this.decoder=new Cb(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const bs=({name:t,prefix:e,encode:r,decode:i})=>new Tb(t,e,r,i),ln=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=$b(r,e);return bs({prefix:t,name:e,encode:i,decode:s=>Ed(n(s))})},Rb=(t,e,r,i)=>{const n={};for(let u=0;u<e.length;++u)n[e[u]]=u;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,l=0;for(let u=0;u<s;++u){const h=n[t[u]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Nb=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[n&a>>o];if(o&&(s+=e[n&a<<r-o]),i)for(;s.length*r&7;)s+="=";return s},Pe=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>bs({prefix:e,name:t,encode(n){return Nb(n,i,r)},decode(n){return Rb(n,i,r,t)}}),Ub=bs({prefix:"\0",name:"identity",encode:t=>Ab(t),decode:t=>Db(t)});var jb=Object.freeze({__proto__:null,identity:Ub});const kb=Pe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Lb=Object.freeze({__proto__:null,base2:kb});const Fb=Pe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Mb=Object.freeze({__proto__:null,base8:Fb});const qb=ln({prefix:"9",name:"base10",alphabet:"0123456789"});var zb=Object.freeze({__proto__:null,base10:qb});const Vb=Pe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Kb=Pe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Hb=Object.freeze({__proto__:null,base16:Vb,base16upper:Kb});const Wb=Pe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Gb=Pe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Yb=Pe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Zb=Pe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Jb=Pe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Xb=Pe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Qb=Pe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),e1=Pe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),t1=Pe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var r1=Object.freeze({__proto__:null,base32:Wb,base32upper:Gb,base32pad:Yb,base32padupper:Zb,base32hex:Jb,base32hexupper:Xb,base32hexpad:Qb,base32hexpadupper:e1,base32z:t1});const i1=ln({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),n1=ln({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var s1=Object.freeze({__proto__:null,base36:i1,base36upper:n1});const o1=ln({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),a1=ln({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var c1=Object.freeze({__proto__:null,base58btc:o1,base58flickr:a1});const l1=Pe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),u1=Pe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),h1=Pe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),f1=Pe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var d1=Object.freeze({__proto__:null,base64:l1,base64pad:u1,base64url:h1,base64urlpad:f1});const _d=Array.from(""),p1=_d.reduce((t,e,r)=>(t[r]=e,t),[]),g1=_d.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function y1(t){return t.reduce((e,r)=>(e+=p1[r],e),"")}function w1(t){const e=[];for(const r of t){const i=g1[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const m1=bs({prefix:"",name:"base256emoji",encode:y1,decode:w1});var b1=Object.freeze({__proto__:null,base256emoji:m1}),v1=Id,Bl=128,E1=-128,x1=Math.pow(2,31);function Id(t,e,r){e=e||[],r=r||0;for(var i=r;t>=x1;)e[r++]=t&255|Bl,t/=128;for(;t&E1;)e[r++]=t&255|Bl,t>>>=7;return e[r]=t|0,Id.bytes=r-i+1,e}var _1=oa,I1=128,Tl=127;function oa(t,i){var r=0,i=i||0,n=0,s=i,o,a=t.length;do{if(s>=a)throw oa.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=n<28?(o&Tl)<<n:(o&Tl)*Math.pow(2,n),n+=7}while(o>=I1);return oa.bytes=s-i,r}var S1=Math.pow(2,7),O1=Math.pow(2,14),$1=Math.pow(2,21),D1=Math.pow(2,28),A1=Math.pow(2,35),P1=Math.pow(2,42),C1=Math.pow(2,49),B1=Math.pow(2,56),T1=Math.pow(2,63),R1=function(t){return t<S1?1:t<O1?2:t<$1?3:t<D1?4:t<A1?5:t<P1?6:t<C1?7:t<B1?8:t<T1?9:10},N1={encode:v1,decode:_1,encodingLength:R1},Sd=N1;const Rl=(t,e,r=0)=>(Sd.encode(t,e,r),e),Nl=t=>Sd.encodingLength(t),aa=(t,e)=>{const r=e.byteLength,i=Nl(t),n=i+Nl(r),s=new Uint8Array(n+r);return Rl(t,s,0),Rl(r,s,i),s.set(e,n),new U1(t,r,e,s)};let U1=class{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}};const Od=({name:t,code:e,encode:r})=>new j1(t,e,r);let j1=class{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?aa(this.code,r):r.then(i=>aa(this.code,i))}else throw Error("Unknown type, must be binary type")}};const $d=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),k1=Od({name:"sha2-256",code:18,encode:$d("SHA-256")}),L1=Od({name:"sha2-512",code:19,encode:$d("SHA-512")});var F1=Object.freeze({__proto__:null,sha256:k1,sha512:L1});const Dd=0,M1="identity",Ad=Ed,q1=t=>aa(Dd,Ad(t)),z1={code:Dd,name:M1,encode:Ad,digest:q1};var V1=Object.freeze({__proto__:null,identity:z1});new TextEncoder,new TextDecoder;const Ul={...jb,...Lb,...Mb,...zb,...Hb,...r1,...s1,...c1,...d1,...b1};({...F1,...V1});function Pd(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const jl=Pd("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),uo=Pd("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=bd(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Cd={utf8:jl,"utf-8":jl,hex:Ul.base16,latin1:uo,ascii:uo,binary:uo,...Ul};function vs(t,e="utf8"){const r=Cd[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function Ei(t,e="utf8"){const r=Cd[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ac(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function kl(t){return Hr(vs(Ei(t,ms),wd))}function rs(t){return vs(Ei(Wr(t),wd),ms)}function Bd(t){const e=Ei(_b,Cl),r=xb+vs(vd([e,t]),Cl);return[vb,Eb,r].join(bb)}function K1(t){return vs(t,ms)}function H1(t){return Ei(t,ms)}function W1(t){return Ei([rs(t.header),rs(t.payload)].join(ts),md)}function G1(t){return[rs(t.header),rs(t.payload),K1(t.signature)].join(ts)}function ca(t){const e=t.split(ts),r=kl(e[0]),i=kl(e[1]),n=H1(e[2]),s=Ei(e.slice(0,2).join(ts),md);return{header:r,payload:i,signature:n,data:s}}function Ll(t=od(Ib)){const e=yd.getPublicKey(t);return{secretKey:vd([t,e]),publicKey:e}}async function Y1(t,e,r,i,n=M.fromMiliseconds(Date.now())){const s={alg:wb,typ:mb},o=Bd(i.publicKey),a=n+r,c={iss:o,sub:t,aud:e,iat:n,exp:a},l=W1({header:s,payload:c}),u=yd.sign(l,i.secretKey.slice(0,32));return G1({header:s,payload:c,signature:u})}function cc(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Td(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?cc(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function zi(t,e){e||(e=t.reduce((n,s)=>n+s.length,0));const r=Td(e);let i=0;for(const n of t)r.set(n,i),i+=n.length;return cc(r)}function Z1(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=n}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var y=0,m=0,x=0,O=d.length;x!==O&&d[x]===0;)x++,y++;for(var v=(O-x)*u+1>>>0,b=new Uint8Array(v);x!==O;){for(var E=d[x],_=0,C=v-1;(E!==0||_<m)&&C!==-1;C--,_++)E+=256*b[C]>>>0,b[C]=E%a>>>0,E=E/a>>>0;if(E!==0)throw new Error("Non-zero carry");m=_,x++}for(var B=v-m;B!==v&&b[B]===0;)B++;for(var A=c.repeat(y);B<v;++B)A+=t.charAt(b[B]);return A}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var y=0;if(d[y]!==" "){for(var m=0,x=0;d[y]===c;)m++,y++;for(var O=(d.length-y)*l+1>>>0,v=new Uint8Array(O);d[y];){var b=r[d.charCodeAt(y)];if(b===255)return;for(var E=0,_=O-1;(b!==0||E<x)&&_!==-1;_--,E++)b+=a*v[_]>>>0,v[_]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");x=E,y++}if(d[y]!==" "){for(var C=O-x;C!==O&&v[C]===0;)C++;for(var B=new Uint8Array(m+(O-C)),A=m;C!==O;)B[A++]=v[C++];return B}}}function p(d){var y=f(d);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var J1=Z1,X1=J1;const Q1=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},ev=t=>new TextEncoder().encode(t),tv=t=>new TextDecoder().decode(t);class rv{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class iv{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Rd(this,e)}}class nv{constructor(e){this.decoders=e}or(e){return Rd(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Rd=(t,e)=>new nv({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class sv{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new rv(e,r,i),this.decoder=new iv(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Es=({name:t,prefix:e,encode:r,decode:i})=>new sv(t,e,r,i),un=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=X1(r,e);return Es({prefix:t,name:e,encode:i,decode:s=>Q1(n(s))})},ov=(t,e,r,i)=>{const n={};for(let u=0;u<e.length;++u)n[e[u]]=u;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,l=0;for(let u=0;u<s;++u){const h=n[t[u]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},av=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[n&a>>o];if(o&&(s+=e[n&a<<r-o]),i)for(;s.length*r&7;)s+="=";return s},Ce=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Es({prefix:e,name:t,encode(n){return av(n,i,r)},decode(n){return ov(n,i,r,t)}}),cv=Es({prefix:"\0",name:"identity",encode:t=>tv(t),decode:t=>ev(t)}),lv=Object.freeze(Object.defineProperty({__proto__:null,identity:cv},Symbol.toStringTag,{value:"Module"})),uv=Ce({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),hv=Object.freeze(Object.defineProperty({__proto__:null,base2:uv},Symbol.toStringTag,{value:"Module"})),fv=Ce({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),dv=Object.freeze(Object.defineProperty({__proto__:null,base8:fv},Symbol.toStringTag,{value:"Module"})),pv=un({prefix:"9",name:"base10",alphabet:"0123456789"}),gv=Object.freeze(Object.defineProperty({__proto__:null,base10:pv},Symbol.toStringTag,{value:"Module"})),yv=Ce({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),wv=Ce({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),mv=Object.freeze(Object.defineProperty({__proto__:null,base16:yv,base16upper:wv},Symbol.toStringTag,{value:"Module"})),bv=Ce({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),vv=Ce({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Ev=Ce({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),xv=Ce({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),_v=Ce({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Iv=Ce({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Sv=Ce({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ov=Ce({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),$v=Ce({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Dv=Object.freeze(Object.defineProperty({__proto__:null,base32:bv,base32hex:_v,base32hexpad:Sv,base32hexpadupper:Ov,base32hexupper:Iv,base32pad:Ev,base32padupper:xv,base32upper:vv,base32z:$v},Symbol.toStringTag,{value:"Module"})),Av=un({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Pv=un({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Cv=Object.freeze(Object.defineProperty({__proto__:null,base36:Av,base36upper:Pv},Symbol.toStringTag,{value:"Module"})),Bv=un({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Tv=un({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Rv=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Bv,base58flickr:Tv},Symbol.toStringTag,{value:"Module"})),Nv=Ce({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Uv=Ce({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),jv=Ce({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),kv=Ce({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Lv=Object.freeze(Object.defineProperty({__proto__:null,base64:Nv,base64pad:Uv,base64url:jv,base64urlpad:kv},Symbol.toStringTag,{value:"Module"})),Nd=Array.from(""),Fv=Nd.reduce((t,e,r)=>(t[r]=e,t),[]),Mv=Nd.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function qv(t){return t.reduce((e,r)=>(e+=Fv[r],e),"")}function zv(t){const e=[];for(const r of t){const i=Mv[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Vv=Es({prefix:"",name:"base256emoji",encode:qv,decode:zv}),Kv=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Vv},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Fl={...lv,...hv,...dv,...gv,...mv,...Dv,...Cv,...Rv,...Lv,...Kv};function Ud(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Ml=Ud("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),ho=Ud("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Td(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),jd={utf8:Ml,"utf-8":Ml,hex:Fl.base16,latin1:ho,ascii:ho,binary:ho,...Fl};function gt(t,e="utf8"){const r=jd[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?cc(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Je(t,e="utf8"){const r=jd[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}const Hv={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var fo,ql;function kd(){if(ql)return fo;ql=1;const t="Input must be an string, Buffer or Uint8Array";function e(o){let a;if(o instanceof Uint8Array)a=o;else if(typeof o=="string")a=new TextEncoder().encode(o);else throw new Error(t);return a}function r(o){return Array.prototype.map.call(o,function(a){return(a<16?"0":"")+a.toString(16)}).join("")}function i(o){return(4294967296+o).toString(16).substring(1)}function n(o,a,c){let l=`
`+o+" = ";for(let u=0;u<a.length;u+=2){if(c===32)l+=i(a[u]).toUpperCase(),l+=" ",l+=i(a[u+1]).toUpperCase();else if(c===64)l+=i(a[u+1]).toUpperCase(),l+=i(a[u]).toUpperCase();else throw new Error("Invalid size "+c);u%6===4?l+=`
`+new Array(o.length+4).join(" "):u<a.length-2&&(l+=" ")}console.log(l)}function s(o,a,c){let l=new Date().getTime();const u=new Uint8Array(a);for(let f=0;f<a;f++)u[f]=f%256;const h=new Date().getTime();console.log("Generated random input in "+(h-l)+"ms"),l=h;for(let f=0;f<c;f++){const p=o(u),d=new Date().getTime(),y=d-l;l=d,console.log("Hashed in "+y+"ms: "+p.substring(0,20)+"..."),console.log(Math.round(a/(1<<20)/(y/1e3)*100)/100+" MB PER SECOND")}}return fo={normalizeInput:e,toHex:r,debugPrint:n,testSpeed:s},fo}var po,zl;function Wv(){if(zl)return po;zl=1;const t=kd();function e(x,O,v){const b=x[O]+x[v];let E=x[O+1]+x[v+1];b>=4294967296&&E++,x[O]=b,x[O+1]=E}function r(x,O,v,b){let E=x[O]+v;v<0&&(E+=4294967296);let _=x[O+1]+b;E>=4294967296&&_++,x[O]=E,x[O+1]=_}function i(x,O){return x[O]^x[O+1]<<8^x[O+2]<<16^x[O+3]<<24}function n(x,O,v,b,E,_){const C=l[E],B=l[E+1],A=l[_],N=l[_+1];e(c,x,O),r(c,x,C,B);let j=c[b]^c[x],R=c[b+1]^c[x+1];c[b]=R,c[b+1]=j,e(c,v,b),j=c[O]^c[v],R=c[O+1]^c[v+1],c[O]=j>>>24^R<<8,c[O+1]=R>>>24^j<<8,e(c,x,O),r(c,x,A,N),j=c[b]^c[x],R=c[b+1]^c[x+1],c[b]=j>>>16^R<<16,c[b+1]=R>>>16^j<<16,e(c,v,b),j=c[O]^c[v],R=c[O+1]^c[v+1],c[O]=R>>>31^j<<1,c[O+1]=j>>>31^R<<1}const s=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],a=new Uint8Array(o.map(function(x){return x*2})),c=new Uint32Array(32),l=new Uint32Array(32);function u(x,O){let v=0;for(v=0;v<16;v++)c[v]=x.h[v],c[v+16]=s[v];for(c[24]=c[24]^x.t,c[25]=c[25]^x.t/4294967296,O&&(c[28]=~c[28],c[29]=~c[29]),v=0;v<32;v++)l[v]=i(x.b,4*v);for(v=0;v<12;v++)n(0,8,16,24,a[v*16+0],a[v*16+1]),n(2,10,18,26,a[v*16+2],a[v*16+3]),n(4,12,20,28,a[v*16+4],a[v*16+5]),n(6,14,22,30,a[v*16+6],a[v*16+7]),n(0,10,20,30,a[v*16+8],a[v*16+9]),n(2,12,22,24,a[v*16+10],a[v*16+11]),n(4,14,16,26,a[v*16+12],a[v*16+13]),n(6,8,18,28,a[v*16+14],a[v*16+15]);for(v=0;v<16;v++)x.h[v]=x.h[v]^c[v]^c[v+16]}const h=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function f(x,O,v,b){if(x===0||x>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(O&&O.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(v&&v.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(b&&b.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const E={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:x};h.fill(0),h[0]=x,O&&(h[1]=O.length),h[2]=1,h[3]=1,v&&h.set(v,32),b&&h.set(b,48);for(let _=0;_<16;_++)E.h[_]=s[_]^i(h,_*4);return O&&(p(E,O),E.c=128),E}function p(x,O){for(let v=0;v<O.length;v++)x.c===128&&(x.t+=x.c,u(x,!1),x.c=0),x.b[x.c++]=O[v]}function d(x){for(x.t+=x.c;x.c<128;)x.b[x.c++]=0;u(x,!0);const O=new Uint8Array(x.outlen);for(let v=0;v<x.outlen;v++)O[v]=x.h[v>>2]>>8*(v&3);return O}function y(x,O,v,b,E){v=v||64,x=t.normalizeInput(x),b&&(b=t.normalizeInput(b)),E&&(E=t.normalizeInput(E));const _=f(v,O,b,E);return p(_,x),d(_)}function m(x,O,v,b,E){const _=y(x,O,v,b,E);return t.toHex(_)}return po={blake2b:y,blake2bHex:m,blake2bInit:f,blake2bUpdate:p,blake2bFinal:d},po}var go,Vl;function Gv(){if(Vl)return go;Vl=1;const t=kd();function e(d,y){return d[y]^d[y+1]<<8^d[y+2]<<16^d[y+3]<<24}function r(d,y,m,x,O,v){o[d]=o[d]+o[y]+O,o[x]=i(o[x]^o[d],16),o[m]=o[m]+o[x],o[y]=i(o[y]^o[m],12),o[d]=o[d]+o[y]+v,o[x]=i(o[x]^o[d],8),o[m]=o[m]+o[x],o[y]=i(o[y]^o[m],7)}function i(d,y){return d>>>y^d<<32-y}const n=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),s=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),o=new Uint32Array(16),a=new Uint32Array(16);function c(d,y){let m=0;for(m=0;m<8;m++)o[m]=d.h[m],o[m+8]=n[m];for(o[12]^=d.t,o[13]^=d.t/4294967296,y&&(o[14]=~o[14]),m=0;m<16;m++)a[m]=e(d.b,4*m);for(m=0;m<10;m++)r(0,4,8,12,a[s[m*16+0]],a[s[m*16+1]]),r(1,5,9,13,a[s[m*16+2]],a[s[m*16+3]]),r(2,6,10,14,a[s[m*16+4]],a[s[m*16+5]]),r(3,7,11,15,a[s[m*16+6]],a[s[m*16+7]]),r(0,5,10,15,a[s[m*16+8]],a[s[m*16+9]]),r(1,6,11,12,a[s[m*16+10]],a[s[m*16+11]]),r(2,7,8,13,a[s[m*16+12]],a[s[m*16+13]]),r(3,4,9,14,a[s[m*16+14]],a[s[m*16+15]]);for(m=0;m<8;m++)d.h[m]^=o[m]^o[m+8]}function l(d,y){if(!(d>0&&d<=32))throw new Error("Incorrect output length, should be in [1, 32]");const m=y?y.length:0;if(y&&!(m>0&&m<=32))throw new Error("Incorrect key length, should be in [1, 32]");const x={h:new Uint32Array(n),b:new Uint8Array(64),c:0,t:0,outlen:d};return x.h[0]^=16842752^m<<8^d,m>0&&(u(x,y),x.c=64),x}function u(d,y){for(let m=0;m<y.length;m++)d.c===64&&(d.t+=d.c,c(d,!1),d.c=0),d.b[d.c++]=y[m]}function h(d){for(d.t+=d.c;d.c<64;)d.b[d.c++]=0;c(d,!0);const y=new Uint8Array(d.outlen);for(let m=0;m<d.outlen;m++)y[m]=d.h[m>>2]>>8*(m&3)&255;return y}function f(d,y,m){m=m||32,d=t.normalizeInput(d);const x=l(m,y);return u(x,d),h(x)}function p(d,y,m){const x=f(d,y,m);return t.toHex(x)}return go={blake2s:f,blake2sHex:p,blake2sInit:l,blake2sUpdate:u,blake2sFinal:h},go}var yo,Kl;function Yv(){if(Kl)return yo;Kl=1;const t=Wv(),e=Gv();return yo={blake2b:t.blake2b,blake2bHex:t.blake2bHex,blake2bInit:t.blake2bInit,blake2bUpdate:t.blake2bUpdate,blake2bFinal:t.blake2bFinal,blake2s:e.blake2s,blake2sHex:e.blake2sHex,blake2sInit:e.blake2sInit,blake2sUpdate:e.blake2sUpdate,blake2sFinal:e.blake2sFinal},yo}var Zv=Yv(),jt={exports:{}};function Jv(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var Xv=Qv;function Qv(t,e,r){var i=r&&r.stringify||Jv,n=1;if(typeof t=="object"&&t!==null){var s=e.length+n;if(s===1)return t;var o=new Array(s);o[0]=i(t);for(var a=1;a<s;a++)o[a]=i(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var l="",u=1-n,h=-1,f=t&&t.length||0,p=0;p<f;){if(t.charCodeAt(p)===37&&p+1<f){switch(h=h>-1?h:0,t.charCodeAt(p+1)){case 100:case 102:if(u>=c||e[u]==null)break;h<p&&(l+=t.slice(h,p)),l+=Number(e[u]),h=p+2,p++;break;case 105:if(u>=c||e[u]==null)break;h<p&&(l+=t.slice(h,p)),l+=Math.floor(Number(e[u])),h=p+2,p++;break;case 79:case 111:case 106:if(u>=c||e[u]===void 0)break;h<p&&(l+=t.slice(h,p));var d=typeof e[u];if(d==="string"){l+="'"+e[u]+"'",h=p+2,p++;break}if(d==="function"){l+=e[u].name||"<anonymous>",h=p+2,p++;break}l+=i(e[u]),h=p+2,p++;break;case 115:if(u>=c)break;h<p&&(l+=t.slice(h,p)),l+=String(e[u]),h=p+2,p++;break;case 37:h<p&&(l+=t.slice(h,p)),l+="%",h=p+2,p++,u--;break}++u}++p}return h===-1?t:(h<f&&(l+=t.slice(h)),l)}const Hl=Xv;jt.exports=rr;const Ji=pE().console||{},eE={mapHttpRequest:Sn,mapHttpResponse:Sn,wrapRequestSerializer:wo,wrapResponseSerializer:wo,wrapErrorSerializer:wo,req:Sn,res:Sn,err:Gl,errWithCause:Gl};function Er(t,e){return t==="silent"?1/0:e.levels.values[t]}const lc=Symbol("pino.logFuncs"),la=Symbol("pino.hierarchy"),tE={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function Wl(t,e){const r={logger:e,parent:t[la]};e[la]=r}function rE(t,e,r){const i={};e.forEach(n=>{i[n]=r[n]?r[n]:Ji[n]||Ji[tE[n]||"log"]||pi}),t[lc]=i}function iE(t,e){return Array.isArray(t)?t.filter(function(r){return r!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function rr(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||Ji;t.browser.write&&(t.browser.asObject=!0);const i=t.serializers||{},n=iE(t.browser.serialize,i);let s=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(s=!1);const o=Object.keys(t.customLevels||{}),a=["error","fatal","warn","info","debug","trace"].concat(o);typeof r=="function"&&a.forEach(function(y){r[y]=r}),(t.enabled===!1||t.browser.disabled)&&(t.level="silent");const c=t.level||"info",l=Object.create(r);l.log||(l.log=pi),rE(l,a,r),Wl({},l),Object.defineProperty(l,"levelVal",{get:h}),Object.defineProperty(l,"level",{get:f,set:p});const u={transmit:e,serialize:n,asObject:t.browser.asObject,asObjectBindingsOnly:t.browser.asObjectBindingsOnly,formatters:t.browser.formatters,levels:a,timestamp:hE(t),messageKey:t.messageKey||"msg",onChild:t.onChild||pi};l.levels=nE(t),l.level=c,l.isLevelEnabled=function(y){return this.levels.values[y]?this.levels.values[y]>=this.levels.values[this.level]:!1},l.setMaxListeners=l.getMaxListeners=l.emit=l.addListener=l.on=l.prependListener=l.once=l.prependOnceListener=l.removeListener=l.removeAllListeners=l.listeners=l.listenerCount=l.eventNames=l.write=l.flush=pi,l.serializers=i,l._serialize=n,l._stdErrSerialize=s,l.child=function(...y){return d.call(this,u,...y)},e&&(l._logEvent=ua());function h(){return Er(this.level,this)}function f(){return this._level}function p(y){if(y!=="silent"&&!this.levels.values[y])throw Error("unknown level "+y);this._level=y,Br(this,u,l,"error"),Br(this,u,l,"fatal"),Br(this,u,l,"warn"),Br(this,u,l,"info"),Br(this,u,l,"debug"),Br(this,u,l,"trace"),o.forEach(m=>{Br(this,u,l,m)})}function d(y,m,x){if(!m)throw new Error("missing bindings for child Pino");x=x||{},n&&m.serializers&&(x.serializers=m.serializers);const O=x.serializers;if(n&&O){var v=Object.assign({},i,O),b=t.browser.serialize===!0?Object.keys(v):n;delete m.serializers,uc([m],b,v,this._stdErrSerialize)}function E(C){this._childLevel=(C._childLevel|0)+1,this.bindings=m,v&&(this.serializers=v,this._serialize=b),e&&(this._logEvent=ua([].concat(C._logEvent.bindings,m)))}E.prototype=this;const _=new E(this);return Wl(this,_),_.child=function(...C){return d.call(this,y,...C)},_.level=x.level||this.level,y.onChild(_),_}return l}function nE(t){const e=t.customLevels||{},r=Object.assign({},rr.levels.values,e),i=Object.assign({},rr.levels.labels,sE(e));return{values:r,labels:i}}function sE(t){const e={};return Object.keys(t).forEach(function(r){e[t[r]]=r}),e}rr.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},rr.stdSerializers=eE,rr.stdTimeFunctions=Object.assign({},{nullTime:Ld,epochTime:Fd,unixTime:fE,isoTime:dE});function oE(t){const e=[];t.bindings&&e.push(t.bindings);let r=t[la];for(;r.parent;)r=r.parent,r.logger.bindings&&e.push(r.logger.bindings);return e.reverse()}function Br(t,e,r,i){if(Object.defineProperty(t,i,{value:Er(t.level,r)>Er(i,r)?pi:r[lc][i],writable:!0,enumerable:!0,configurable:!0}),t[i]===pi){if(!e.transmit)return;const s=e.transmit.level||t.level,o=Er(s,r);if(Er(i,r)<o)return}t[i]=cE(t,e,r,i);const n=oE(t);n.length!==0&&(t[i]=aE(n,t[i]))}function aE(t,e){return function(){return e.apply(this,[...t,...arguments])}}function cE(t,e,r,i){return(function(n){return function(){const s=e.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Ji?Ji:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];var l=!1;if(e.serialize&&(uc(o,this._serialize,this.serializers,this._stdErrSerialize),l=!0),e.asObject||e.formatters?n.call(a,...lE(this,i,o,s,e)):n.apply(a,o),e.transmit){const u=e.transmit.level||t._level,h=Er(u,r),f=Er(i,r);if(f<h)return;uE(this,{ts:s,methodLevel:i,methodValue:f,transmitValue:r.levels.values[e.transmit.level||t._level],send:e.transmit.send,val:Er(t._level,r)},o,l)}}})(t[lc][i])}function lE(t,e,r,i,n){const{level:s,log:o=h=>h}=n.formatters||{},a=r.slice();let c=a[0];const l={};let u=(t._childLevel|0)+1;if(u<1&&(u=1),i&&(l.time=i),s){const h=s(e,t.levels.values[e]);Object.assign(l,h)}else l.level=t.levels.values[e];if(n.asObjectBindingsOnly){if(c!==null&&typeof c=="object")for(;u--&&typeof a[0]=="object";)Object.assign(l,a.shift());return[o(l),...a]}else{if(c!==null&&typeof c=="object"){for(;u--&&typeof a[0]=="object";)Object.assign(l,a.shift());c=a.length?Hl(a.shift(),a):void 0}else typeof c=="string"&&(c=Hl(a.shift(),a));return c!==void 0&&(l[n.messageKey]=c),[o(l)]}}function uc(t,e,r,i){for(const n in t)if(i&&t[n]instanceof Error)t[n]=rr.stdSerializers.err(t[n]);else if(typeof t[n]=="object"&&!Array.isArray(t[n])&&e)for(const s in t[n])e.indexOf(s)>-1&&s in r&&(t[n][s]=r[s](t[n][s]))}function uE(t,e,r,i=!1){const n=e.send,s=e.ts,o=e.methodLevel,a=e.methodValue,c=e.val,l=t._logEvent.bindings;i||uc(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=s,t._logEvent.messages=r.filter(function(u){return l.indexOf(u)===-1}),t._logEvent.level.label=o,t._logEvent.level.value=a,n(o,t._logEvent,c),t._logEvent=ua(l)}function ua(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function Gl(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function hE(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?Ld:Fd}function Sn(){return{}}function wo(t){return t}function pi(){}function Ld(){return!1}function Fd(){return Date.now()}function fE(){return Math.round(Date.now()/1e3)}function dE(){return new Date(Date.now()).toISOString()}function pE(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}jt.exports.default=rr;jt.exports.pino=rr;const gE={level:"info"},xs="custom_context",hc=1e3*1024;var yE=Object.defineProperty,wE=(t,e,r)=>e in t?yE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,mr=(t,e,r)=>wE(t,typeof e!="symbol"?e+"":e,r);let mE=class{constructor(e){mr(this,"nodeValue"),mr(this,"sizeInBytes"),mr(this,"next"),this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},Yl=class{constructor(e){mr(this,"lengthInNodes"),mr(this,"sizeInBytes"),mr(this,"head"),mr(this,"tail"),mr(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new mE(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}};const bE=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r);function Zl(t){return typeof t=="string"?t:bE(t)||""}var vE=Object.defineProperty,EE=(t,e,r)=>e in t?vE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,On=(t,e,r)=>EE(t,typeof e!="symbol"?e+"":e,r);let Md=class{constructor(e,r=hc){On(this,"logs"),On(this,"level"),On(this,"levelValue"),On(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=e??"error",this.levelValue=jt.exports.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new Yl(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===jt.exports.levels.values.error?console.error(e):r===jt.exports.levels.values.warn?console.warn(e):r===jt.exports.levels.values.debug?console.debug(e):r===jt.exports.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Zl({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new Yl(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(Zl({extraMetadata:e})),new Blob(r,{type:"application/json"})}};var xE=Object.defineProperty,_E=(t,e,r)=>e in t?xE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,IE=(t,e,r)=>_E(t,e+"",r);let SE=class{constructor(e,r=hc){IE(this,"baseChunkLogger"),this.baseChunkLogger=new Md(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),i=document.createElement("a");i.href=r,i.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}};var OE=Object.defineProperty,$E=(t,e,r)=>e in t?OE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,DE=(t,e,r)=>$E(t,e+"",r);let AE=class{constructor(e,r=hc){DE(this,"baseChunkLogger"),this.baseChunkLogger=new Md(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var PE=Object.defineProperty,CE=Object.defineProperties,BE=Object.getOwnPropertyDescriptors,Jl=Object.getOwnPropertySymbols,TE=Object.prototype.hasOwnProperty,RE=Object.prototype.propertyIsEnumerable,Xl=(t,e,r)=>e in t?PE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_r=(t,e)=>{for(var r in e||(e={}))TE.call(e,r)&&Xl(t,r,e[r]);if(Jl)for(var r of Jl(e))RE.call(e,r)&&Xl(t,r,e[r]);return t},Ir=(t,e)=>CE(t,BE(e));function NE(t){return Ir(_r({},t),{level:t?.level||gE.level})}function UE(t,e,r=xs){return t[r]=e,t}function Xe(t,e=xs){return t[e]||""}function jE(t,e,r=xs){const i=Xe(t,r);return i.trim()?`${i}/${e}`:e}function at(t,e,r=xs){const i=jE(t,e,r),n=t.child({context:i});return UE(n,i,r)}function kE(t){var e,r;const i=new SE((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:jt.exports(Ir(_r({},t.opts),{level:"trace",browser:Ir(_r({},(r=t.opts)==null?void 0:r.browser),{write:n=>i.write(n)})})),chunkLoggerController:i}}function LE(t){var e,r;const i=new AE((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:jt.exports(Ir(_r({},t.opts),{level:"trace",browser:Ir(_r({},(r=t.opts)==null?void 0:r.browser),{write:n=>i.write(n)})}),i),chunkLoggerController:i}}function qd(t){var e;if(typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string")return{logger:t.loggerOverride,chunkLoggerController:null};const r=Ir(_r({},t.opts),{level:typeof t.loggerOverride=="string"?t.loggerOverride:(e=t.opts)==null?void 0:e.level});return typeof window<"u"?kE(Ir(_r({},t),{opts:r})):LE(Ir(_r({},t),{opts:r}))}var FE={};const ME=":";function ir(t){const[e,r]=t.split(ME);return{namespace:e,reference:r}}function Ql(t,e=[]){const r=[];return Object.keys(t).forEach(i=>{if(e.length&&!e.includes(i))return;const n=t[i];r.push(...n.accounts)}),r}function zd(t,e){return t.includes(":")?[t]:e.chains||[]}var qE=Object.defineProperty,zE=Object.defineProperties,VE=Object.getOwnPropertyDescriptors,eu=Object.getOwnPropertySymbols,KE=Object.prototype.hasOwnProperty,HE=Object.prototype.propertyIsEnumerable,ha=(t,e,r)=>e in t?qE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,tu=(t,e)=>{for(var r in e||(e={}))KE.call(e,r)&&ha(t,r,e[r]);if(eu)for(var r of eu(e))HE.call(e,r)&&ha(t,r,e[r]);return t},WE=(t,e)=>zE(t,VE(e)),ru=(t,e,r)=>ha(t,typeof e!="symbol"?e+"":e,r);const GE="ReactNative",st={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},YE="js";function is(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Dr(){return!sr.getDocument()&&!!sr.getNavigator()&&navigator.product===GE}function ZE(){return Dr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function JE(){return Dr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function xi(){return!is()&&!!sr.getNavigator()&&!!sr.getDocument()}function hn(){return Dr()?st.reactNative:is()?st.node:xi()?st.browser:st.unknown}function iu(){var t;try{return Dr()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function XE(t,e){const r=new URLSearchParams(t);return Object.entries(e).sort(([i],[n])=>i.localeCompare(n)).forEach(([i,n])=>{n!=null&&r.set(i,String(n))}),r.toString()}function QE(t){var e,r;const i=Vd();try{return t!=null&&t.url&&i.url&&new URL(t.url).host!==new URL(i.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${i.url}. This is probably unintended and can lead to issues.`),t.url=i.url),(e=t?.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(n=>n!=="")),WE(tu(tu({},i),t),{url:t?.url||i.url,name:t?.name||i.name,description:t?.description||i.description,icons:(r=t?.icons)!=null&&r.length&&t.icons.length>0?t.icons:i.icons})}catch(n){return console.warn("Error populating app metadata",n),t||i}}function Vd(){return tw.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function e2(){if(hn()===st.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:i}=global.Platform;return[r,i].join("-")}const t=by();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function t2(){var t;const e=hn();return e===st.browser?[e,((t=sr.getLocation())==null?void 0:t.host)||"unknown"].join(":"):e}function Kd(t,e,r){const i=e2(),n=t2();return[[t,e].join("-"),[YE,r].join("-"),i,n].join("/")}function r2({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:n,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){const l=r.split("?"),u=Kd(t,e,i),h={auth:n,ua:u,projectId:s,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},f=XE(l[1]||"",h);return l[0]+"?"+f}function Mr(t,e){return t.filter(r=>e.includes(r)).length===t.length}function fa(t){return Object.fromEntries(t.entries())}function da(t){return new Map(Object.entries(t))}function Ur(t=M.FIVE_MINUTES,e){const r=M.toMiliseconds(t||M.FIVE_MINUTES);let i,n,s,o;return{resolve:a=>{s&&i&&(clearTimeout(s),i(a),o=Promise.resolve(a))},reject:a=>{s&&n&&(clearTimeout(s),n(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},r),i=a,n=c})}}function kt(t,e,r){return new Promise(async(i,n)=>{const s=setTimeout(()=>n(new Error(r)),e);try{const o=await t;i(o)}catch(o){n(o)}clearTimeout(s)})}function Hd(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function i2(t){return Hd("topic",t)}function n2(t){return Hd("id",t)}function Wd(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function pe(t,e){return M.fromMiliseconds(Date.now()+M.toMiliseconds(t))}function Ut(t){return Date.now()>=M.toMiliseconds(t)}function ie(t,e){return`${t}${e?`:${e}`:""}`}function Lt(t=[],e=[]){return[...new Set([...t,...e])]}async function s2({id:t,topic:e,wcDeepLink:r}){var i;try{if(!r)return;const n=typeof r=="string"?JSON.parse(r):r,s=n?.href;if(typeof s!="string")return;const o=o2(s,t,e),a=hn();if(a===st.browser){if(!((i=sr.getDocument())!=null&&i.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}a2(o)}else a===st.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(n){console.error(n)}}function o2(t,e,r){const i=`requestId=${e}&sessionTopic=${r}`;t.endsWith("/")&&(t=t.slice(0,-1));let n=`${t}`;if(t.startsWith("https://t.me")){const s=t.includes("?")?"&startapp=":"?startapp=";n=`${n}${s}${h2(i,!0)}`}else n=`${n}/wc?${i}`;return n}function a2(t){let e="_self";u2()?e="_top":(l2()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function c2(t,e){let r="";try{if(xi()&&(r=localStorage.getItem(e),r))return r;r=await t.getItem(e)}catch(i){console.error(i)}return r}function nu(t,e){if(!t.includes(e))return null;const r=t.split(/([&,?,=])/),i=r.indexOf(e);return r[i+2]}function su(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function fc(){return typeof process<"u"&&FE.IS_VITEST==="true"}function l2(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function u2(){try{return window.self!==window.top}catch{return!1}}function h2(t,e=!1){const r=Buffer.from(t).toString("base64");return e?r.replace(/[=]/g,""):r}function Gd(t){return Buffer.from(t,"base64").toString("utf-8")}function f2(t){return new Promise(e=>setTimeout(e,t))}let d2=class{constructor({limit:e}){ru(this,"limit"),ru(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const r=this.set.values().next().value;r&&this.set.delete(r)}this.set.add(e)}}has(e){return this.set.has(e)}};const $n=BigInt(2**32-1),ou=BigInt(32);function Yd(t,e=!1){return e?{h:Number(t&$n),l:Number(t>>ou&$n)}:{h:Number(t>>ou&$n)|0,l:Number(t&$n)|0}}function Zd(t,e=!1){const r=t.length;let i=new Uint32Array(r),n=new Uint32Array(r);for(let s=0;s<r;s++){const{h:o,l:a}=Yd(t[s],e);[i[s],n[s]]=[o,a]}return[i,n]}const au=(t,e,r)=>t>>>r,cu=(t,e,r)=>t<<32-r|e>>>r,gr=(t,e,r)=>t>>>r|e<<32-r,yr=(t,e,r)=>t<<32-r|e>>>r,Li=(t,e,r)=>t<<64-r|e>>>r-32,Fi=(t,e,r)=>t>>>r-32|e<<64-r,p2=(t,e)=>e,g2=(t,e)=>t,y2=(t,e,r)=>t<<r|e>>>32-r,w2=(t,e,r)=>e<<r|t>>>32-r,m2=(t,e,r)=>e<<r-32|t>>>64-r,b2=(t,e,r)=>t<<r-32|e>>>64-r;function xt(t,e,r,i){const n=(e>>>0)+(i>>>0);return{h:t+r+(n/2**32|0)|0,l:n|0}}const dc=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),pc=(t,e,r,i)=>e+r+i+(t/2**32|0)|0,v2=(t,e,r,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0),E2=(t,e,r,i,n)=>e+r+i+n+(t/2**32|0)|0,x2=(t,e,r,i,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0)+(n>>>0),_2=(t,e,r,i,n,s)=>e+r+i+n+s+(t/2**32|0)|0,ii=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function _s(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function or(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Ot(t,...e){if(!_s(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Is(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");or(t.outputLen),or(t.blockLen)}function $r(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function gc(t,e){Ot(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Xi(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function wt(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function mo(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function At(t,e){return t<<32-e|t>>>e}const Jd=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Xd(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Yt=Jd?t=>t:t=>Xd(t);function I2(t){for(let e=0;e<t.length;e++)t[e]=Xd(t[e]);return t}const wr=Jd?t=>t:I2,Qd=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",S2=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function gi(t){if(Ot(t),Qd)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=S2[t[r]];return e}const Ht={_0:48,_9:57,A:65,F:70,a:97,f:102};function lu(t){if(t>=Ht._0&&t<=Ht._9)return t-Ht._0;if(t>=Ht.A&&t<=Ht.F)return t-(Ht.A-10);if(t>=Ht.a&&t<=Ht.f)return t-(Ht.a-10)}function ns(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Qd)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let n=0,s=0;n<r;n++,s+=2){const o=lu(t.charCodeAt(s)),a=lu(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[n]=o*16+a}return i}function ep(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function St(t){return typeof t=="string"&&(t=ep(t)),Ot(t),t}function br(...t){let e=0;for(let i=0;i<t.length;i++){const n=t[i];Ot(n),e+=n.length}const r=new Uint8Array(e);for(let i=0,n=0;i<t.length;i++){const s=t[i];r.set(s,n),n+=s.length}return r}let Ss=class{};function fn(t){const e=i=>t().update(St(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function O2(t){const e=(i,n)=>t(n).update(St(i)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=i=>t(i),e}function Jr(t=32){if(ii&&typeof ii.getRandomValues=="function")return ii.getRandomValues(new Uint8Array(t));if(ii&&typeof ii.randomBytes=="function")return Uint8Array.from(ii.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const $2=BigInt(0),Pi=BigInt(1),D2=BigInt(2),A2=BigInt(7),P2=BigInt(256),C2=BigInt(113),tp=[],rp=[],ip=[];for(let t=0,e=Pi,r=1,i=0;t<24;t++){[r,i]=[i,(2*r+3*i)%5],tp.push(2*(5*i+r)),rp.push((t+1)*(t+2)/2%64);let n=$2;for(let s=0;s<7;s++)e=(e<<Pi^(e>>A2)*C2)%P2,e&D2&&(n^=Pi<<(Pi<<BigInt(s))-Pi);ip.push(n)}const np=Zd(ip,!0),B2=np[0],T2=np[1],uu=(t,e,r)=>r>32?m2(t,e,r):y2(t,e,r),hu=(t,e,r)=>r>32?b2(t,e,r):w2(t,e,r);function R2(t,e=24){const r=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=r[c],u=r[c+1],h=uu(l,u,1)^r[a],f=hu(l,u,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=f}let n=t[2],s=t[3];for(let o=0;o<24;o++){const a=rp[o],c=uu(n,s,a),l=hu(n,s,a),u=tp[o];n=t[u],s=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=B2[i],t[1]^=T2[i]}wt(r)}let N2=class sp extends Ss{constructor(e,r,i,n=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=i,this.enableXOF=n,this.rounds=s,or(i),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Xi(this.state)}clone(){return this._cloneInto()}keccak(){wr(this.state32),R2(this.state32,this.rounds),wr(this.state32),this.posOut=0,this.pos=0}update(e){$r(this),e=St(e),Ot(e);const{blockLen:r,state:i}=this,n=e.length;for(let s=0;s<n;){const o=Math.min(r-this.pos,n-s);for(let a=0;a<o;a++)i[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:i,blockLen:n}=this;e[i]^=r,(r&128)!==0&&i===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){$r(this,!1),Ot(e),this.finish();const r=this.state,{blockLen:i}=this;for(let n=0,s=e.length;n<s;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,s-n);e.set(r.subarray(this.posOut,this.posOut+o),n),this.posOut+=o,n+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return or(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(gc(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,wt(this.state)}_cloneInto(e){const{blockLen:r,suffix:i,outputLen:n,rounds:s,enableXOF:o}=this;return e||(e=new sp(r,i,n,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=i,e.outputLen=n,e.enableXOF=o,e.destroyed=this.destroyed,e}};const U2=(t,e,r)=>fn(()=>new N2(e,t,r)),j2=U2(1,136,256/8);function k2(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const n=BigInt(32),s=BigInt(4294967295),o=Number(r>>n&s),a=Number(r&s),c=i?4:0,l=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+l,a,i)}function L2(t,e,r){return t&e^~t&r}function F2(t,e,r){return t&e^t&r^e&r}let op=class extends Ss{constructor(e,r,i,n){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=n,this.buffer=new Uint8Array(e),this.view=mo(this.buffer)}update(e){$r(this),e=St(e),Ot(e);const{view:r,buffer:i,blockLen:n}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(n-this.pos,s-o);if(a===n){const c=mo(e);for(;n<=s-o;o+=n)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===n&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){$r(this),gc(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:n,isLE:s}=this;let{pos:o}=this;r[o++]=128,wt(this.buffer.subarray(o)),this.padOffset>n-o&&(this.process(i,0),o=0);for(let h=o;h<n;h++)r[h]=0;k2(i,n-8,BigInt(this.length*8),s),this.process(i,0);const a=mo(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:n,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=n,e.pos=a,n%r&&e.buffer.set(i),e}clone(){return this._cloneInto()}};const lr=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Te=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Re=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),M2=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ur=new Uint32Array(64);class q2 extends op{constructor(e=32){super(64,e,8,!1),this.A=lr[0]|0,this.B=lr[1]|0,this.C=lr[2]|0,this.D=lr[3]|0,this.E=lr[4]|0,this.F=lr[5]|0,this.G=lr[6]|0,this.H=lr[7]|0}get(){const{A:e,B:r,C:i,D:n,E:s,F:o,G:a,H:c}=this;return[e,r,i,n,s,o,a,c]}set(e,r,i,n,s,o,a,c){this.A=e|0,this.B=r|0,this.C=i|0,this.D=n|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)ur[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const f=ur[h-15],p=ur[h-2],d=At(f,7)^At(f,18)^f>>>3,y=At(p,17)^At(p,19)^p>>>10;ur[h]=y+ur[h-7]+d+ur[h-16]|0}let{A:i,B:n,C:s,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const f=At(a,6)^At(a,11)^At(a,25),p=u+f+L2(a,c,l)+M2[h]+ur[h]|0,d=(At(i,2)^At(i,13)^At(i,22))+F2(i,n,s)|0;u=l,l=c,c=a,a=o+p|0,o=s,s=n,n=i,i=p+d|0}i=i+this.A|0,n=n+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(i,n,s,o,a,c,l,u)}roundClean(){wt(ur)}destroy(){this.set(0,0,0,0,0,0,0,0),wt(this.buffer)}}const ap=Zd(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),z2=ap[0],V2=ap[1],hr=new Uint32Array(80),fr=new Uint32Array(80);let yc=class extends op{constructor(e=64){super(128,e,16,!1),this.Ah=Re[0]|0,this.Al=Re[1]|0,this.Bh=Re[2]|0,this.Bl=Re[3]|0,this.Ch=Re[4]|0,this.Cl=Re[5]|0,this.Dh=Re[6]|0,this.Dl=Re[7]|0,this.Eh=Re[8]|0,this.El=Re[9]|0,this.Fh=Re[10]|0,this.Fl=Re[11]|0,this.Gh=Re[12]|0,this.Gl=Re[13]|0,this.Hh=Re[14]|0,this.Hl=Re[15]|0}get(){const{Ah:e,Al:r,Bh:i,Bl:n,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:f,Gh:p,Gl:d,Hh:y,Hl:m}=this;return[e,r,i,n,s,o,a,c,l,u,h,f,p,d,y,m]}set(e,r,i,n,s,o,a,c,l,u,h,f,p,d,y,m){this.Ah=e|0,this.Al=r|0,this.Bh=i|0,this.Bl=n|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=f|0,this.Gh=p|0,this.Gl=d|0,this.Hh=y|0,this.Hl=m|0}process(e,r){for(let v=0;v<16;v++,r+=4)hr[v]=e.getUint32(r),fr[v]=e.getUint32(r+=4);for(let v=16;v<80;v++){const b=hr[v-15]|0,E=fr[v-15]|0,_=gr(b,E,1)^gr(b,E,8)^au(b,E,7),C=yr(b,E,1)^yr(b,E,8)^cu(b,E,7),B=hr[v-2]|0,A=fr[v-2]|0,N=gr(B,A,19)^Li(B,A,61)^au(B,A,6),j=yr(B,A,19)^Fi(B,A,61)^cu(B,A,6),R=v2(C,j,fr[v-7],fr[v-16]),D=E2(R,_,N,hr[v-7],hr[v-16]);hr[v]=D|0,fr[v]=R|0}let{Ah:i,Al:n,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:f,Fh:p,Fl:d,Gh:y,Gl:m,Hh:x,Hl:O}=this;for(let v=0;v<80;v++){const b=gr(h,f,14)^gr(h,f,18)^Li(h,f,41),E=yr(h,f,14)^yr(h,f,18)^Fi(h,f,41),_=h&p^~h&y,C=f&d^~f&m,B=x2(O,E,C,V2[v],fr[v]),A=_2(B,x,b,_,z2[v],hr[v]),N=B|0,j=gr(i,n,28)^Li(i,n,34)^Li(i,n,39),R=yr(i,n,28)^Fi(i,n,34)^Fi(i,n,39),D=i&s^i&a^s&a,T=n&o^n&c^o&c;x=y|0,O=m|0,y=p|0,m=d|0,p=h|0,d=f|0,{h,l:f}=xt(l|0,u|0,A|0,N|0),l=a|0,u=c|0,a=s|0,c=o|0,s=i|0,o=n|0;const g=dc(N,R,T);i=pc(g,A,j,D),n=g|0}({h:i,l:n}=xt(this.Ah|0,this.Al|0,i|0,n|0)),{h:s,l:o}=xt(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=xt(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=xt(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:f}=xt(this.Eh|0,this.El|0,h|0,f|0),{h:p,l:d}=xt(this.Fh|0,this.Fl|0,p|0,d|0),{h:y,l:m}=xt(this.Gh|0,this.Gl|0,y|0,m|0),{h:x,l:O}=xt(this.Hh|0,this.Hl|0,x|0,O|0),this.set(i,n,s,o,a,c,l,u,h,f,p,d,y,m,x,O)}roundClean(){wt(hr,fr)}destroy(){wt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};class K2 extends yc{constructor(){super(48),this.Ah=Te[0]|0,this.Al=Te[1]|0,this.Bh=Te[2]|0,this.Bl=Te[3]|0,this.Ch=Te[4]|0,this.Cl=Te[5]|0,this.Dh=Te[6]|0,this.Dl=Te[7]|0,this.Eh=Te[8]|0,this.El=Te[9]|0,this.Fh=Te[10]|0,this.Fl=Te[11]|0,this.Gh=Te[12]|0,this.Gl=Te[13]|0,this.Hh=Te[14]|0,this.Hl=Te[15]|0}}const Ne=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class H2 extends yc{constructor(){super(32),this.Ah=Ne[0]|0,this.Al=Ne[1]|0,this.Bh=Ne[2]|0,this.Bl=Ne[3]|0,this.Ch=Ne[4]|0,this.Cl=Ne[5]|0,this.Dh=Ne[6]|0,this.Dl=Ne[7]|0,this.Eh=Ne[8]|0,this.El=Ne[9]|0,this.Fh=Ne[10]|0,this.Fl=Ne[11]|0,this.Gh=Ne[12]|0,this.Gl=Ne[13]|0,this.Hh=Ne[14]|0,this.Hl=Ne[15]|0}}const Os=fn(()=>new q2),W2=fn(()=>new yc),G2=fn(()=>new K2),Y2=fn(()=>new H2),Z2=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),we=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),K=new Uint32Array(32);function dr(t,e,r,i,n,s){const o=n[s],a=n[s+1];let c=K[2*t],l=K[2*t+1],u=K[2*e],h=K[2*e+1],f=K[2*r],p=K[2*r+1],d=K[2*i],y=K[2*i+1],m=dc(c,u,o);l=pc(m,l,h,a),c=m|0,{Dh:y,Dl:d}={Dh:y^l,Dl:d^c},{Dh:y,Dl:d}={Dh:p2(y,d),Dl:g2(y)},{h:p,l:f}=xt(p,f,y,d),{Bh:h,Bl:u}={Bh:h^p,Bl:u^f},{Bh:h,Bl:u}={Bh:gr(h,u,24),Bl:yr(h,u,24)},K[2*t]=c,K[2*t+1]=l,K[2*e]=u,K[2*e+1]=h,K[2*r]=f,K[2*r+1]=p,K[2*i]=d,K[2*i+1]=y}function pr(t,e,r,i,n,s){const o=n[s],a=n[s+1];let c=K[2*t],l=K[2*t+1],u=K[2*e],h=K[2*e+1],f=K[2*r],p=K[2*r+1],d=K[2*i],y=K[2*i+1],m=dc(c,u,o);l=pc(m,l,h,a),c=m|0,{Dh:y,Dl:d}={Dh:y^l,Dl:d^c},{Dh:y,Dl:d}={Dh:gr(y,d,16),Dl:yr(y,d,16)},{h:p,l:f}=xt(p,f,y,d),{Bh:h,Bl:u}={Bh:h^p,Bl:u^f},{Bh:h,Bl:u}={Bh:Li(h,u,63),Bl:Fi(h,u,63)},K[2*t]=c,K[2*t+1]=l,K[2*e]=u,K[2*e+1]=h,K[2*r]=f,K[2*r+1]=p,K[2*i]=d,K[2*i+1]=y}function J2(t,e={},r,i,n){if(or(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:s,salt:o,personalization:a}=e;if(s!==void 0&&(s.length<1||s.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==i)throw new Error("salt must be undefined or "+i);if(a!==void 0&&a.length!==n)throw new Error("personalization must be undefined or "+n)}class X2 extends Ss{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,or(e),or(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=Xi(this.buffer)}update(e){$r(this),e=St(e),Ot(e);const{blockLen:r,buffer:i,buffer32:n}=this,s=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<s;){this.pos===r&&(wr(n),this.compress(n,0,!1),wr(n),this.pos=0);const l=Math.min(r-this.pos,s-c),u=o+c;if(l===r&&!(u%4)&&c+l<s){const h=new Uint32Array(a,u,Math.floor((s-c)/4));wr(h);for(let f=0;c+r<s;f+=n.length,c+=r)this.length+=r,this.compress(h,f,!1);wr(h);continue}i.set(e.subarray(c,c+l),this.pos),this.pos+=l,this.length+=l,c+=l}return this}digestInto(e){$r(this),gc(e,this);const{pos:r,buffer32:i}=this;this.finished=!0,wt(this.buffer.subarray(r)),wr(i),this.compress(i,0,!0),wr(i);const n=Xi(e);this.get().forEach((s,o)=>n[o]=Yt(s))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){const{buffer:r,length:i,finished:n,destroyed:s,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=s,e.finished=n,e.length=i,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class Q2 extends X2{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=we[0]|0,this.v0h=we[1]|0,this.v1l=we[2]|0,this.v1h=we[3]|0,this.v2l=we[4]|0,this.v2h=we[5]|0,this.v3l=we[6]|0,this.v3h=we[7]|0,this.v4l=we[8]|0,this.v4h=we[9]|0,this.v5l=we[10]|0,this.v5h=we[11]|0,this.v6l=we[12]|0,this.v6h=we[13]|0,this.v7l=we[14]|0,this.v7h=we[15]|0,J2(r,e,64,16,16);let{key:i,personalization:n,salt:s}=e,o=0;if(i!==void 0&&(i=St(i),o=i.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=St(s);const a=Xi(s);this.v4l^=Yt(a[0]),this.v4h^=Yt(a[1]),this.v5l^=Yt(a[2]),this.v5h^=Yt(a[3])}if(n!==void 0){n=St(n);const a=Xi(n);this.v6l^=Yt(a[0]),this.v6h^=Yt(a[1]),this.v7l^=Yt(a[2]),this.v7h^=Yt(a[3])}if(i!==void 0){const a=new Uint8Array(this.blockLen);a.set(i),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:i,v1h:n,v2l:s,v2h:o,v3l:a,v3h:c,v4l:l,v4h:u,v5l:h,v5h:f,v6l:p,v6h:d,v7l:y,v7h:m}=this;return[e,r,i,n,s,o,a,c,l,u,h,f,p,d,y,m]}set(e,r,i,n,s,o,a,c,l,u,h,f,p,d,y,m){this.v0l=e|0,this.v0h=r|0,this.v1l=i|0,this.v1h=n|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=l|0,this.v4h=u|0,this.v5l=h|0,this.v5h=f|0,this.v6l=p|0,this.v6h=d|0,this.v7l=y|0,this.v7h=m|0}compress(e,r,i){this.get().forEach((c,l)=>K[l]=c),K.set(we,16);let{h:n,l:s}=Yd(BigInt(this.length));K[24]=we[8]^s,K[25]=we[9]^n,i&&(K[28]=~K[28],K[29]=~K[29]);let o=0;const a=Z2;for(let c=0;c<12;c++)dr(0,4,8,12,e,r+2*a[o++]),pr(0,4,8,12,e,r+2*a[o++]),dr(1,5,9,13,e,r+2*a[o++]),pr(1,5,9,13,e,r+2*a[o++]),dr(2,6,10,14,e,r+2*a[o++]),pr(2,6,10,14,e,r+2*a[o++]),dr(3,7,11,15,e,r+2*a[o++]),pr(3,7,11,15,e,r+2*a[o++]),dr(0,5,10,15,e,r+2*a[o++]),pr(0,5,10,15,e,r+2*a[o++]),dr(1,6,11,12,e,r+2*a[o++]),pr(1,6,11,12,e,r+2*a[o++]),dr(2,7,8,13,e,r+2*a[o++]),pr(2,7,8,13,e,r+2*a[o++]),dr(3,4,9,14,e,r+2*a[o++]),pr(3,4,9,14,e,r+2*a[o++]);this.v0l^=K[0]^K[16],this.v0h^=K[1]^K[17],this.v1l^=K[2]^K[18],this.v1h^=K[3]^K[19],this.v2l^=K[4]^K[20],this.v2h^=K[5]^K[21],this.v3l^=K[6]^K[22],this.v3h^=K[7]^K[23],this.v4l^=K[8]^K[24],this.v4h^=K[9]^K[25],this.v5l^=K[10]^K[26],this.v5h^=K[11]^K[27],this.v6l^=K[12]^K[28],this.v6h^=K[13]^K[29],this.v7l^=K[14]^K[30],this.v7h^=K[15]^K[31],wt(K)}destroy(){this.destroyed=!0,wt(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const ex=O2(t=>new Q2(t)),tx="https://rpc.walletconnect.org/v1";function cp(t){const e=`Ethereum Signed Message:
${t.length}`,r=new TextEncoder().encode(e+t);return"0x"+Buffer.from(j2(r)).toString("hex")}async function rx(t,e,r,i,n,s){switch(r.t){case"eip191":return await ix(t,e,r.s);case"eip1271":return await nx(t,e,r.s,i,n,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}function ix(t,e,r){const i=gm(r);return vm({payload:cp(e),signature:i}).toLowerCase()===t.toLowerCase()}async function nx(t,e,r,i,n,s){const o=ir(i);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l=r.substring(2),u=(l.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:cp(e)).substring(2),f=a+h+c+u+l,p=await fetch(`${s||tx}/?chainId=${i}&projectId=${n}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:sx(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:f},"latest"]})}),{result:d}=await p.json();return d?d.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function sx(){return Date.now()+Math.floor(Math.random()*1e3)}function ox(t){const e=atob(t),r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);const i=r[0];if(i===0)throw new Error("No signatures found");const n=1+i*64;if(r.length<n)throw new Error("Transaction data too short for claimed signature count");if(r.length<100)throw new Error("Transaction too short");const s=Buffer.from(t,"base64").slice(1,65);return sn.encode(s)}function ax(t){const e=new Uint8Array(Buffer.from(t,"base64")),r=Array.from("TransactionData::").map(s=>s.charCodeAt(0)),i=new Uint8Array(r.length+e.length);i.set(r),i.set(e,r.length);const n=ex(i,{dkLen:32});return sn.encode(n)}function fu(t){const e=new Uint8Array(Os(cx(t)));return sn.encode(e)}function cx(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function du(t){const e=Buffer.from(t,"base64"),r=i0(e).txn;if(!r)throw new Error("Invalid signed transaction: missing 'txn' field");const i=Gm(r),n=Buffer.from("TX"),s=Buffer.concat([n,Buffer.from(i)]),o=Y2(s);return iy.encode(o).replace(/=+$/,"")}function bo(t){const e=[];let r=BigInt(t);for(;r>=BigInt(128);)e.push(Number(r&BigInt(127)|BigInt(128))),r>>=BigInt(7);return e.push(Number(r)),Buffer.from(e)}function lx(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),r=Buffer.from(t.signed.authInfoBytes,"base64"),i=Buffer.from(t.signature.signature,"base64"),n=[];n.push(Buffer.from([10])),n.push(bo(e.length)),n.push(e),n.push(Buffer.from([18])),n.push(bo(r.length)),n.push(r),n.push(Buffer.from([26])),n.push(bo(i.length)),n.push(i);const s=Buffer.concat(n),o=Os(s);return Buffer.from(o).toString("hex").toUpperCase()}function ux(t){var e,r;const i=[];try{if(typeof t=="string")return i.push(t),i;if(typeof t!="object")return i;t!=null&&t.id&&i.push(t.id);const n=(r=(e=t?.capabilities)==null?void 0:e.caip345)==null?void 0:r.transactionHashes;n&&i.push(...n)}catch(n){console.warn("getWalletSendCallsHashes failed: ",n)}return i}var hx=Object.defineProperty,fx=Object.defineProperties,dx=Object.getOwnPropertyDescriptors,pu=Object.getOwnPropertySymbols,px=Object.prototype.hasOwnProperty,gx=Object.prototype.propertyIsEnumerable,gu=(t,e,r)=>e in t?hx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yx=(t,e)=>{for(var r in e||(e={}))px.call(e,r)&&gu(t,r,e[r]);if(pu)for(var r of pu(e))gx.call(e,r)&&gu(t,r,e[r]);return t},wx=(t,e)=>fx(t,dx(e));const lp="did:pkh:",mx={eip155:"Ethereum",solana:"Solana",bip122:"Bitcoin"},bx=t=>t?mx[t]||t:"",$s=t=>t?.split(":"),vx=t=>{const e=t&&$s(t);if(e)return t.includes(lp)?e[3]:e[1]},Ex=t=>{const e=t&&$s(t);if(e)return t.includes(lp)?e[2]:e[0]},pa=t=>{const e=t&&$s(t);if(e)return e[2]+":"+e[3]},ss=t=>{const e=t&&$s(t);if(e)return e.pop()};async function yu(t){const{cacao:e,projectId:r}=t,{s:i,p:n}=e,s=up(n,n.iss),o=ss(n.iss);return await rx(o,s,i,pa(n.iss),r)}const up=(t,e)=>{const r=Ex(e);if(!r)throw new Error("Invalid issuer: "+e);const i=`${t.domain} wants you to sign in with your ${bx(r)} account:`,n=ss(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=t.statement||void 0;const o=`URI: ${t.aud||t.uri}`,a=`Version: ${t.version}`,c=`Chain ID: ${vx(e)}`,l=`Nonce: ${t.nonce}`,u=`Issued At: ${t.iat}`,h=t.exp?`Expiration Time: ${t.exp}`:void 0,f=t.nbf?`Not Before: ${t.nbf}`:void 0,p=t.requestId?`Request ID: ${t.requestId}`:void 0,d=t.resources?`Resources:${t.resources.map(m=>`
- ${m}`).join("")}`:void 0,y=qn(t.resources);if(y){const m=Qi(y);s=Px(s,m)}return[i,n,"",s,"",o,a,c,l,u,h,f,p,d].filter(m=>m!=null).join(`
`)};function xx(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function _x(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function Gr(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{const i=t.att[r];if(Array.isArray(i))throw new Error(`Resource must be an object: ${r}`);if(typeof i!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(i).forEach(n=>{const s=i[n];if(!Array.isArray(s))throw new Error(`Ability limits ${n} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${n} is empty array, must be an array with objects`);s.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${n}) must be an array of objects, found: ${o}`)})})})}function Ix(t,e,r,i={}){return r?.sort((n,s)=>n.localeCompare(s)),{att:{[t]:Sx(e,r,i)}}}function Sx(t,e,r={}){e=e?.sort((n,s)=>n.localeCompare(s));const i=e.map(n=>({[`${t}/${n}`]:[r]}));return Object.assign({},...i)}function hp(t){return Gr(t),`urn:recap:${xx(t).replace(/=/g,"")}`}function Qi(t){const e=_x(t.replace("urn:recap:",""));return Gr(e),e}function Ox(t,e,r){const i=Ix(t,e,r);return hp(i)}function $x(t){return t&&t.includes("urn:recap:")}function Dx(t,e){const r=Qi(t),i=Qi(e),n=Ax(r,i);return hp(n)}function Ax(t,e){Gr(t),Gr(e);const r=Object.keys(t.att).concat(Object.keys(e.att)).sort((n,s)=>n.localeCompare(s)),i={att:{}};return r.forEach(n=>{var s,o;Object.keys(((s=t.att)==null?void 0:s[n])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[n])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;i.att[n]=wx(yx({},i.att[n]),{[a]:((c=t.att[n])==null?void 0:c[a])||((l=e.att[n])==null?void 0:l[a])})})}),i}function Px(t="",e){Gr(e);const r="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(r))return t;const i=[];let n=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,f)=>h.action.localeCompare(f.action));const l={};c.forEach(h=>{l[h.ability]||(l[h.ability]=[]),l[h.ability].push(h.action)});const u=Object.keys(l).map(h=>(n++,`(${n}) '${h}': '${l[h].join("', '")}' for '${a}'.`));i.push(u.join(", ").replace(".,","."))});const s=i.join(" "),o=`${r}${s}`;return`${t?t+" ":""}${o}`}function wu(t){var e;const r=Qi(t);Gr(r);const i=(e=r.att)==null?void 0:e.eip155;return i?Object.keys(i).map(n=>n.split("/")[1]):[]}function mu(t){const e=Qi(t);Gr(e);const r=[];return Object.values(e.att).forEach(i=>{Object.values(i).forEach(n=>{var s;(s=n?.[0])!=null&&s.chains&&r.push(n[0].chains)})}),[...new Set(r.flat())]}function qn(t){if(!t)return;const e=t?.[t.length-1];return $x(e)?e:void 0}function fp(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ga(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function vo(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function We(t,...e){if(!fp(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function bu(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Cx(t,e){We(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Sr(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function bi(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Bx(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const Tx=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Rx(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function ya(t){if(typeof t=="string")t=Rx(t);else if(fp(t))t=wa(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function Nx(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function Ux(t,e){if(t.length!==e.length)return!1;let r=0;for(let i=0;i<t.length;i++)r|=t[i]^e[i];return r===0}const jx=(t,e)=>{function r(i,...n){if(We(i),!Tx)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const l=n[0];if(!l)throw new Error("nonce / iv required");t.varSizeNonce?We(l):We(l,t.nonceLength)}const s=t.tagLength;s&&n[1]!==void 0&&We(n[1]);const o=e(i,...n),a=(l,u)=>{if(u!==void 0){if(l!==2)throw new Error("cipher output not supported");We(u)}};let c=!1;return{encrypt(l,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,We(l),a(o.encrypt.length,u),o.encrypt(l,u)},decrypt(l,u){if(We(l),s&&l.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,u),o.decrypt(l,u)}}}return Object.assign(r,t),r};function vu(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!Lx(e))throw new Error("invalid output, must be aligned");return e}function Eu(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const n=BigInt(32),s=BigInt(4294967295),o=Number(r>>n&s),a=Number(r&s);t.setUint32(e+4,o,i),t.setUint32(e+0,a,i)}function kx(t,e,r){ga(r);const i=new Uint8Array(16),n=Bx(i);return Eu(n,0,BigInt(e),r),Eu(n,8,BigInt(t),r),i}function Lx(t){return t.byteOffset%4===0}function wa(t){return Uint8Array.from(t)}const dp=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),Fx=dp("expand 16-byte k"),Mx=dp("expand 32-byte k"),qx=Sr(Fx),zx=Sr(Mx);function te(t,e){return t<<e|t>>>32-e}function ma(t){return t.byteOffset%4===0}const Dn=64,Vx=16,pp=2**32-1,xu=new Uint32Array;function Kx(t,e,r,i,n,s,o,a){const c=n.length,l=new Uint8Array(Dn),u=Sr(l),h=ma(n)&&ma(s),f=h?Sr(n):xu,p=h?Sr(s):xu;for(let d=0;d<c;o++){if(t(e,r,i,u,o,a),o>=pp)throw new Error("arx: counter overflow");const y=Math.min(Dn,c-d);if(h&&y===Dn){const m=d/4;if(d%4!==0)throw new Error("arx: invalid block position");for(let x=0,O;x<Vx;x++)O=m+x,p[O]=f[O]^u[x];d+=Dn;continue}for(let m=0,x;m<y;m++)x=d+m,s[x]=n[x]^l[m];d+=y}}function Hx(t,e){const{allowShortKeys:r,extendNonceFn:i,counterLength:n,counterRight:s,rounds:o}=Nx({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return vo(n),vo(o),ga(s),ga(r),(a,c,l,u,h=0)=>{We(a),We(c),We(l);const f=l.length;if(u===void 0&&(u=new Uint8Array(f)),We(u),vo(h),h<0||h>=pp)throw new Error("arx: counter overflow");if(u.length<f)throw new Error(`arx: output (${u.length}) is shorter than data (${f})`);const p=[];let d=a.length,y,m;if(d===32)p.push(y=wa(a)),m=zx;else if(d===16&&r)y=new Uint8Array(32),y.set(a),y.set(a,16),m=qx,p.push(y);else throw new Error(`arx: invalid 32-byte key, got length=${d}`);ma(c)||p.push(c=wa(c));const x=Sr(y);if(i){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(m,x,Sr(c.subarray(0,16)),x),c=c.subarray(16)}const O=16-n;if(O!==c.length)throw new Error(`arx: nonce must be ${O} or 16 bytes`);if(O!==12){const b=new Uint8Array(12);b.set(c,s?0:12-c.length),c=b,p.push(c)}const v=Sr(c);return Kx(t,m,x,v,l,u,h,o),bi(...p),u}}const Oe=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class Wx{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=ya(e),We(e,32);const r=Oe(e,0),i=Oe(e,2),n=Oe(e,4),s=Oe(e,6),o=Oe(e,8),a=Oe(e,10),c=Oe(e,12),l=Oe(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|i<<3)&8191,this.r[2]=(i>>>10|n<<6)&7939,this.r[3]=(n>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Oe(e,16+2*u)}process(e,r,i=!1){const n=i?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],h=o[4],f=o[5],p=o[6],d=o[7],y=o[8],m=o[9],x=Oe(e,r+0),O=Oe(e,r+2),v=Oe(e,r+4),b=Oe(e,r+6),E=Oe(e,r+8),_=Oe(e,r+10),C=Oe(e,r+12),B=Oe(e,r+14);let A=s[0]+(x&8191),N=s[1]+((x>>>13|O<<3)&8191),j=s[2]+((O>>>10|v<<6)&8191),R=s[3]+((v>>>7|b<<9)&8191),D=s[4]+((b>>>4|E<<12)&8191),T=s[5]+(E>>>1&8191),g=s[6]+((E>>>14|_<<2)&8191),w=s[7]+((_>>>11|C<<5)&8191),I=s[8]+((C>>>8|B<<8)&8191),P=s[9]+(B>>>5|n),S=0,$=S+A*a+N*(5*m)+j*(5*y)+R*(5*d)+D*(5*p);S=$>>>13,$&=8191,$+=T*(5*f)+g*(5*h)+w*(5*u)+I*(5*l)+P*(5*c),S+=$>>>13,$&=8191;let U=S+A*c+N*a+j*(5*m)+R*(5*y)+D*(5*d);S=U>>>13,U&=8191,U+=T*(5*p)+g*(5*f)+w*(5*h)+I*(5*u)+P*(5*l),S+=U>>>13,U&=8191;let k=S+A*l+N*c+j*a+R*(5*m)+D*(5*y);S=k>>>13,k&=8191,k+=T*(5*d)+g*(5*p)+w*(5*f)+I*(5*h)+P*(5*u),S+=k>>>13,k&=8191;let V=S+A*u+N*l+j*c+R*a+D*(5*m);S=V>>>13,V&=8191,V+=T*(5*y)+g*(5*d)+w*(5*p)+I*(5*f)+P*(5*h),S+=V>>>13,V&=8191;let F=S+A*h+N*u+j*l+R*c+D*a;S=F>>>13,F&=8191,F+=T*(5*m)+g*(5*y)+w*(5*d)+I*(5*p)+P*(5*f),S+=F>>>13,F&=8191;let q=S+A*f+N*h+j*u+R*l+D*c;S=q>>>13,q&=8191,q+=T*a+g*(5*m)+w*(5*y)+I*(5*d)+P*(5*p),S+=q>>>13,q&=8191;let H=S+A*p+N*f+j*h+R*u+D*l;S=H>>>13,H&=8191,H+=T*c+g*a+w*(5*m)+I*(5*y)+P*(5*d),S+=H>>>13,H&=8191;let G=S+A*d+N*p+j*f+R*h+D*u;S=G>>>13,G&=8191,G+=T*l+g*c+w*a+I*(5*m)+P*(5*y),S+=G>>>13,G&=8191;let Z=S+A*y+N*d+j*p+R*f+D*h;S=Z>>>13,Z&=8191,Z+=T*u+g*l+w*c+I*a+P*(5*m),S+=Z>>>13,Z&=8191;let W=S+A*m+N*y+j*d+R*p+D*f;S=W>>>13,W&=8191,W+=T*h+g*u+w*l+I*c+P*a,S+=W>>>13,W&=8191,S=(S<<2)+S|0,S=S+$|0,$=S&8191,S=S>>>13,U+=S,s[0]=$,s[1]=U,s[2]=k,s[3]=V,s[4]=F,s[5]=q,s[6]=H,s[7]=G,s[8]=Z,s[9]=W}finalize(){const{h:e,pad:r}=this,i=new Uint16Array(10);let n=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=n,n=e[a]>>>13,e[a]&=8191;e[0]+=n*5,n=e[0]>>>13,e[0]&=8191,e[1]+=n,n=e[1]>>>13,e[1]&=8191,e[2]+=n,i[0]=e[0]+5,n=i[0]>>>13,i[0]&=8191;for(let a=1;a<10;a++)i[a]=e[a]+n,n=i[a]>>>13,i[a]&=8191;i[9]-=8192;let s=(n^1)-1;for(let a=0;a<10;a++)i[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|i[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;bi(i)}update(e){bu(this),e=ya(e),We(e);const{buffer:r,blockLen:i}=this,n=e.length;for(let s=0;s<n;){const o=Math.min(i-this.pos,n-s);if(o===i){for(;i<=n-s;s+=i)this.process(e,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===i&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){bi(this.h,this.r,this.buffer,this.pad)}digestInto(e){bu(this),Cx(e,this),this.finished=!0;const{buffer:r,h:i}=this;let{pos:n}=this;if(n){for(r[n++]=1;n<16;n++)r[n]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=i[o]>>>0,e[s++]=i[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}}function Gx(t){const e=(i,n)=>t(n).update(ya(i)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=i=>t(i),e}const Yx=Gx(t=>new Wx(t));function Zx(t,e,r,i,n,s=20){let o=t[0],a=t[1],c=t[2],l=t[3],u=e[0],h=e[1],f=e[2],p=e[3],d=e[4],y=e[5],m=e[6],x=e[7],O=n,v=r[0],b=r[1],E=r[2],_=o,C=a,B=c,A=l,N=u,j=h,R=f,D=p,T=d,g=y,w=m,I=x,P=O,S=v,$=b,U=E;for(let V=0;V<s;V+=2)_=_+N|0,P=te(P^_,16),T=T+P|0,N=te(N^T,12),_=_+N|0,P=te(P^_,8),T=T+P|0,N=te(N^T,7),C=C+j|0,S=te(S^C,16),g=g+S|0,j=te(j^g,12),C=C+j|0,S=te(S^C,8),g=g+S|0,j=te(j^g,7),B=B+R|0,$=te($^B,16),w=w+$|0,R=te(R^w,12),B=B+R|0,$=te($^B,8),w=w+$|0,R=te(R^w,7),A=A+D|0,U=te(U^A,16),I=I+U|0,D=te(D^I,12),A=A+D|0,U=te(U^A,8),I=I+U|0,D=te(D^I,7),_=_+j|0,U=te(U^_,16),w=w+U|0,j=te(j^w,12),_=_+j|0,U=te(U^_,8),w=w+U|0,j=te(j^w,7),C=C+R|0,P=te(P^C,16),I=I+P|0,R=te(R^I,12),C=C+R|0,P=te(P^C,8),I=I+P|0,R=te(R^I,7),B=B+D|0,S=te(S^B,16),T=T+S|0,D=te(D^T,12),B=B+D|0,S=te(S^B,8),T=T+S|0,D=te(D^T,7),A=A+N|0,$=te($^A,16),g=g+$|0,N=te(N^g,12),A=A+N|0,$=te($^A,8),g=g+$|0,N=te(N^g,7);let k=0;i[k++]=o+_|0,i[k++]=a+C|0,i[k++]=c+B|0,i[k++]=l+A|0,i[k++]=u+N|0,i[k++]=h+j|0,i[k++]=f+R|0,i[k++]=p+D|0,i[k++]=d+T|0,i[k++]=y+g|0,i[k++]=m+w|0,i[k++]=x+I|0,i[k++]=O+P|0,i[k++]=v+S|0,i[k++]=b+$|0,i[k++]=E+U|0}const Jx=Hx(Zx,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Xx=new Uint8Array(16),_u=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(Xx.subarray(r))},Qx=new Uint8Array(32);function Iu(t,e,r,i,n){const s=t(e,r,Qx),o=Yx.create(s);n&&_u(o,n),_u(o,i);const a=kx(i.length,n?n.length:0,!0);o.update(a);const c=o.digest();return bi(s,a),c}const e_=t=>(e,r,i)=>({encrypt(n,s){const o=n.length;s=vu(o+16,s,!1),s.set(n);const a=s.subarray(0,-16);t(e,r,a,a,1);const c=Iu(t,e,r,a,i);return s.set(c,o),bi(c),s},decrypt(n,s){s=vu(n.length-16,s,!1);const o=n.subarray(0,-16),a=n.subarray(-16),c=Iu(t,e,r,o,i);if(!Ux(a,c))throw new Error("invalid tag");return s.set(n.subarray(0,-16)),t(e,r,s,s,1),bi(c),s}}),gp=jx({blockSize:64,nonceLength:12,tagLength:16},e_(Jx));let yp=class extends Ss{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Is(e);const i=St(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,s=new Uint8Array(n);s.set(i.length>n?e.create().update(i).digest():i);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),wt(s)}update(e){return $r(this),this.iHash.update(e),this}digestInto(e){$r(this),Ot(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:i,finished:n,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=n,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Ds=(t,e,r)=>new yp(t,e).update(r).digest();Ds.create=(t,e)=>new yp(t,e);function t_(t,e,r){return Is(t),r===void 0&&(r=new Uint8Array(t.outputLen)),Ds(t,St(r),St(e))}const Eo=Uint8Array.from([0]),Su=Uint8Array.of();function r_(t,e,r,i=32){Is(t),or(i);const n=t.outputLen;if(i>255*n)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(i/n);r===void 0&&(r=Su);const o=new Uint8Array(s*n),a=Ds.create(t,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<s;u++)Eo[0]=u+1,c.update(u===0?Su:l).update(r).update(Eo).digestInto(l),o.set(l,n*u),a._cloneInto(c);return a.destroy(),c.destroy(),wt(l,Eo),o.slice(0,i)}const i_=(t,e,r,i,n)=>r_(t,t_(t,e,r),i,n),As=Os,wc=BigInt(0),ba=BigInt(1);function os(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function qr(t,e,r=""){const i=_s(t),n=t?.length,s=e!==void 0;if(!i||s&&n!==e){const o=r&&`"${r}" `,a=s?` of length ${e}`:"",c=i?`length=${n}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function An(t){const e=t.toString(16);return e.length&1?"0"+e:e}function wp(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?wc:BigInt("0x"+t)}function Ps(t){return wp(gi(t))}function as(t){return Ot(t),wp(gi(Uint8Array.from(t).reverse()))}function mc(t,e){return ns(t.toString(16).padStart(e*2,"0"))}function bc(t,e){return mc(t,e).reverse()}function je(t,e,r){let i;if(typeof e=="string")try{i=ns(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(_s(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const n=i.length;if(typeof r=="number"&&n!==r)throw new Error(t+" of length "+r+" expected, got "+n);return i}const xo=t=>typeof t=="bigint"&&wc<=t;function n_(t,e,r){return xo(t)&&xo(e)&&xo(r)&&e<=t&&t<r}function va(t,e,r,i){if(!n_(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function mp(t){let e;for(e=0;t>wc;t>>=ba,e+=1);return e}const dn=t=>(ba<<BigInt(t))-ba;function s_(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const i=f=>new Uint8Array(f),n=f=>Uint8Array.of(f);let s=i(t),o=i(t),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},l=(...f)=>r(o,s,...f),u=(f=i(0))=>{o=l(n(0),f),s=l(),f.length!==0&&(o=l(n(1),f),s=l())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const p=[];for(;f<e;){s=l();const d=s.slice();p.push(d),f+=s.length}return br(...p)};return(f,p)=>{c(),u(f);let d;for(;!(d=p(h()));)u();return c(),d}}function Cs(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function i(n,s,o){const a=t[n];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${n}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([n,s])=>i(n,s,!1)),Object.entries(r).forEach(([n,s])=>i(n,s,!0))}function Ou(t){const e=new WeakMap;return(r,...i)=>{const n=e.get(r);if(n!==void 0)return n;const s=t(r,...i);return e.set(r,s),s}}const Ze=BigInt(0),Fe=BigInt(1),zr=BigInt(2),bp=BigInt(3),vp=BigInt(4),Ep=BigInt(5),o_=BigInt(7),xp=BigInt(8),a_=BigInt(9),_p=BigInt(16);function nt(t,e){const r=t%e;return r>=Ze?r:e+r}function Et(t,e,r){let i=t;for(;e-- >Ze;)i*=i,i%=r;return i}function $u(t,e){if(t===Ze)throw new Error("invert: expected non-zero number");if(e<=Ze)throw new Error("invert: expected positive modulus, got "+e);let r=nt(t,e),i=e,n=Ze,s=Fe;for(;r!==Ze;){const o=i/r,a=i%r,c=n-s*o;i=r,r=a,n=s,s=c}if(i!==Fe)throw new Error("invert: does not exist");return nt(n,e)}function vc(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function Ip(t,e){const r=(t.ORDER+Fe)/vp,i=t.pow(e,r);return vc(t,i,e),i}function c_(t,e){const r=(t.ORDER-Ep)/xp,i=t.mul(e,zr),n=t.pow(i,r),s=t.mul(e,n),o=t.mul(t.mul(s,zr),n),a=t.mul(s,t.sub(o,t.ONE));return vc(t,a,e),a}function l_(t){const e=Ar(t),r=Sp(t),i=r(e,e.neg(e.ONE)),n=r(e,i),s=r(e,e.neg(i)),o=(t+o_)/_p;return(a,c)=>{let l=a.pow(c,o),u=a.mul(l,i);const h=a.mul(l,n),f=a.mul(l,s),p=a.eql(a.sqr(u),c),d=a.eql(a.sqr(h),c);l=a.cmov(l,u,p),u=a.cmov(f,h,d);const y=a.eql(a.sqr(u),c),m=a.cmov(l,u,y);return vc(a,m,c),m}}function Sp(t){if(t<bp)throw new Error("sqrt is not defined for small field");let e=t-Fe,r=0;for(;e%zr===Ze;)e/=zr,r++;let i=zr;const n=Ar(t);for(;Du(n,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Ip;let s=n.pow(i,e);const o=(e+Fe)/zr;return function(a,c){if(a.is0(c))return c;if(Du(a,c)!==1)throw new Error("Cannot find square root");let l=r,u=a.mul(a.ONE,s),h=a.pow(c,e),f=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let p=1,d=a.sqr(h);for(;!a.eql(d,a.ONE);)if(p++,d=a.sqr(d),p===l)throw new Error("Cannot find square root");const y=Fe<<BigInt(l-p-1),m=a.pow(u,y);l=p,u=a.sqr(m),h=a.mul(h,u),f=a.mul(f,m)}return f}}function u_(t){return t%vp===bp?Ip:t%xp===Ep?c_:t%_p===a_?l_(t):Sp(t)}const h_=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function f_(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=h_.reduce((i,n)=>(i[n]="function",i),e);return Cs(t,r),t}function d_(t,e,r){if(r<Ze)throw new Error("invalid exponent, negatives unsupported");if(r===Ze)return t.ONE;if(r===Fe)return e;let i=t.ONE,n=e;for(;r>Ze;)r&Fe&&(i=t.mul(i,n)),n=t.sqr(n),r>>=Fe;return i}function Op(t,e,r=!1){const i=new Array(e.length).fill(r?t.ZERO:void 0),n=e.reduce((o,a,c)=>t.is0(a)?o:(i[c]=o,t.mul(o,a)),t.ONE),s=t.inv(n);return e.reduceRight((o,a,c)=>t.is0(a)?o:(i[c]=t.mul(o,i[c]),t.mul(o,a)),s),i}function Du(t,e){const r=(t.ORDER-Fe)/zr,i=t.pow(e,r),n=t.eql(i,t.ONE),s=t.eql(i,t.ZERO),o=t.eql(i,t.neg(t.ONE));if(!n&&!s&&!o)throw new Error("invalid Legendre symbol result");return n?1:s?0:-1}function $p(t,e){e!==void 0&&or(e);const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function Ar(t,e,r=!1,i={}){if(t<=Ze)throw new Error("invalid field: expected ORDER > 0, got "+t);let n,s,o=!1,a;if(typeof e=="object"&&e!=null){if(i.sqrt||r)throw new Error("cannot specify opts in two arguments");const f=e;f.BITS&&(n=f.BITS),f.sqrt&&(s=f.sqrt),typeof f.isLE=="boolean"&&(r=f.isLE),typeof f.modFromBytes=="boolean"&&(o=f.modFromBytes),a=f.allowedLengths}else typeof e=="number"&&(n=e),i.sqrt&&(s=i.sqrt);const{nBitLength:c,nByteLength:l}=$p(t,n);if(l>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const h=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:l,MASK:dn(c),ZERO:Ze,ONE:Fe,allowedLengths:a,create:f=>nt(f,t),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return Ze<=f&&f<t},is0:f=>f===Ze,isValidNot0:f=>!h.is0(f)&&h.isValid(f),isOdd:f=>(f&Fe)===Fe,neg:f=>nt(-f,t),eql:(f,p)=>f===p,sqr:f=>nt(f*f,t),add:(f,p)=>nt(f+p,t),sub:(f,p)=>nt(f-p,t),mul:(f,p)=>nt(f*p,t),pow:(f,p)=>d_(h,f,p),div:(f,p)=>nt(f*$u(p,t),t),sqrN:f=>f*f,addN:(f,p)=>f+p,subN:(f,p)=>f-p,mulN:(f,p)=>f*p,inv:f=>$u(f,t),sqrt:s||(f=>(u||(u=u_(t)),u(h,f))),toBytes:f=>r?bc(f,l):mc(f,l),fromBytes:(f,p=!0)=>{if(a){if(!a.includes(f.length)||f.length>l)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+f.length);const y=new Uint8Array(l);y.set(f,r?0:y.length-f.length),f=y}if(f.length!==l)throw new Error("Field.fromBytes: expected "+l+" bytes, got "+f.length);let d=r?as(f):Ps(f);if(o&&(d=nt(d,t)),!p&&!h.isValid(d))throw new Error("invalid field element: outside of range 0..ORDER");return d},invertBatch:f=>Op(h,f),cmov:(f,p,d)=>d?p:f});return Object.freeze(h)}function Dp(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Ap(t){const e=Dp(t);return e+Math.ceil(e/2)}function p_(t,e,r=!1){const i=t.length,n=Dp(e),s=Ap(e);if(i<16||i<s||i>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+i);const o=r?as(t):Ps(t),a=nt(o,e-Fe)+Fe;return r?bc(a,n):mc(a,n)}const vi=BigInt(0),Vr=BigInt(1);function cs(t,e){const r=e.negate();return t?r:e}function _o(t,e){const r=Op(t.Fp,e.map(i=>i.Z));return e.map((i,n)=>t.fromAffine(i.toAffine(r[n])))}function Pp(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Io(t,e){Pp(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1),n=2**t,s=dn(t),o=BigInt(t);return{windows:r,windowSize:i,mask:s,maxNumber:n,shiftBy:o}}function Au(t,e,r){const{windowSize:i,mask:n,maxNumber:s,shiftBy:o}=r;let a=Number(t&n),c=t>>o;a>i&&(a-=s,c+=Vr);const l=e*i,u=l+Math.abs(a)-1,h=a===0,f=a<0,p=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:f,isNegF:p,offsetF:l}}function g_(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function y_(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const So=new WeakMap,Cp=new WeakMap;function Oo(t){return Cp.get(t)||1}function Pu(t){if(t!==vi)throw new Error("invalid wNAF")}class w_{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,i=this.ZERO){let n=e;for(;r>vi;)r&Vr&&(i=i.add(n)),n=n.double(),r>>=Vr;return i}precomputeWindow(e,r){const{windows:i,windowSize:n}=Io(r,this.bits),s=[];let o=e,a=o;for(let c=0;c<i;c++){a=o,s.push(a);for(let l=1;l<n;l++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,r,i){if(!this.Fn.isValid(i))throw new Error("invalid scalar");let n=this.ZERO,s=this.BASE;const o=Io(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:l,isZero:u,isNeg:h,isNegF:f,offsetF:p}=Au(i,a,o);i=c,u?s=s.add(cs(f,r[p])):n=n.add(cs(h,r[l]))}return Pu(i),{p:n,f:s}}wNAFUnsafe(e,r,i,n=this.ZERO){const s=Io(e,this.bits);for(let o=0;o<s.windows&&i!==vi;o++){const{nextN:a,offset:c,isZero:l,isNeg:u}=Au(i,o,s);if(i=a,!l){const h=r[c];n=n.add(u?h.negate():h)}}return Pu(i),n}getPrecomputes(e,r,i){let n=So.get(r);return n||(n=this.precomputeWindow(r,e),e!==1&&(typeof i=="function"&&(n=i(n)),So.set(r,n))),n}cached(e,r,i){const n=Oo(e);return this.wNAF(n,this.getPrecomputes(n,e,i),r)}unsafe(e,r,i,n){const s=Oo(e);return s===1?this._unsafeLadder(e,r,n):this.wNAFUnsafe(s,this.getPrecomputes(s,e,i),r,n)}createCache(e,r){Pp(r,this.bits),Cp.set(e,r),So.delete(e)}hasCache(e){return Oo(e)!==1}}function m_(t,e,r,i){let n=e,s=t.ZERO,o=t.ZERO;for(;r>vi||i>vi;)r&Vr&&(s=s.add(n)),i&Vr&&(o=o.add(n)),n=n.double(),r>>=Vr,i>>=Vr;return{p1:s,p2:o}}function b_(t,e,r,i){g_(r,t),y_(i,e);const n=r.length,s=i.length;if(n!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=mp(BigInt(n));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=dn(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let p=h;p>=0;p-=c){u.fill(o);for(let y=0;y<s;y++){const m=i[y],x=Number(m>>BigInt(p)&l);u[x]=u[x].add(r[y])}let d=o;for(let y=u.length-1,m=o;y>0;y--)m=m.add(u[y]),d=d.add(m);if(f=f.add(d),p!==0)for(let y=0;y<c;y++)f=f.double()}return f}function Cu(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return f_(e),e}else return Ar(t,{isLE:r})}function v_(t,e,r={},i){if(i===void 0&&(i=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>vi))throw new Error(`CURVE.${a} must be positive bigint`)}const n=Cu(e.p,r.Fp,i),s=Cu(e.n,r.Fn,i),o=["Gx","Gy","a","b"];for(const a of o)if(!n.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:n,Fn:s}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),ep("HashToScalar-");const Ci=BigInt(0),ni=BigInt(1),Pn=BigInt(2);function E_(t){return Cs(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function x_(t){const e=E_(t),{P:r,type:i,adjustScalarBytes:n,powPminus2:s,randomBytes:o}=e,a=i==="x25519";if(!a&&i!=="x448")throw new Error("invalid type");const c=o||Jr,l=a?255:448,u=a?32:56,h=BigInt(a?9:5),f=BigInt(a?121665:39081),p=a?Pn**BigInt(254):Pn**BigInt(447),d=a?BigInt(8)*Pn**BigInt(251)-ni:BigInt(4)*Pn**BigInt(445)-ni,y=p+d+ni,m=R=>nt(R,r),x=O(h);function O(R){return bc(m(R),u)}function v(R){const D=je("u coordinate",R,u);return a&&(D[31]&=127),m(as(D))}function b(R){return as(n(je("scalar",R,u)))}function E(R,D){const T=B(v(D),b(R));if(T===Ci)throw new Error("invalid private or public key received");return O(T)}function _(R){return E(R,x)}function C(R,D,T){const g=m(R*(D-T));return D=m(D-g),T=m(T+g),{x_2:D,x_3:T}}function B(R,D){va("u",R,Ci,r),va("scalar",D,p,y);const T=D,g=R;let w=ni,I=Ci,P=R,S=ni,$=Ci;for(let k=BigInt(l-1);k>=Ci;k--){const V=T>>k&ni;$^=V,{x_2:w,x_3:P}=C($,w,P),{x_2:I,x_3:S}=C($,I,S),$=V;const F=w+I,q=m(F*F),H=w-I,G=m(H*H),Z=q-G,W=P+S,J=P-S,ue=m(J*F),ye=m(W*H),be=ue+ye,ke=ue-ye;P=m(be*be),S=m(g*m(ke*ke)),w=m(q*G),I=m(Z*(q+m(f*Z)))}({x_2:w,x_3:P}=C($,w,P)),{x_2:I,x_3:S}=C($,I,S);const U=s(I);return m(w*U)}const A={secretKey:u,publicKey:u,seed:u},N=(R=c(u))=>(Ot(R,A.seed),R);function j(R){const D=N(R);return{secretKey:D,publicKey:_(D)}}return{keygen:j,getSharedSecret:(R,D)=>E(R,D),getPublicKey:R=>_(R),scalarMult:E,scalarMultBase:_,utils:{randomSecretKey:N,randomPrivateKey:N},GuBytes:x.slice(),lengths:A}}const __=BigInt(1),Bu=BigInt(2),I_=BigInt(3),S_=BigInt(5);BigInt(8);const Bp=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),O_={p:Bp,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function $_(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),n=BigInt(80),s=Bp,o=t*t%s*t%s,a=Et(o,Bu,s)*o%s,c=Et(a,__,s)*t%s,l=Et(c,S_,s)*c%s,u=Et(l,e,s)*l%s,h=Et(u,r,s)*u%s,f=Et(h,i,s)*h%s,p=Et(f,n,s)*f%s,d=Et(p,n,s)*f%s,y=Et(d,e,s)*l%s;return{pow_p_5_8:Et(y,Bu,s)*t%s,b2:o}}function D_(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const A_=Ar(O_.p,{isLE:!0}),Ea=(()=>{const t=A_.ORDER;return x_({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:i}=$_(e);return nt(Et(r,I_,t)*i,t)},adjustScalarBytes:D_})})(),Tu=(t,e)=>(t+(t>=0?e:-e)/Tp)/e;function P_(t,e,r){const[[i,n],[s,o]]=e,a=Tu(o*t,r),c=Tu(-n*t,r);let l=t-a*i-c*s,u=-a*n-c*o;const h=l<tr,f=u<tr;h&&(l=-l),f&&(u=-u);const p=dn(Math.ceil(mp(r)/2))+yi;if(l<tr||l>=p||u<tr||u>=p)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:l,k2neg:f,k2:u}}function xa(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function $o(t,e){const r={};for(let i of Object.keys(e))r[i]=t[i]===void 0?e[i]:t[i];return os(r.lowS,"lowS"),os(r.prehash,"prehash"),r.format!==void 0&&xa(r.format),r}class C_ extends Error{constructor(e=""){super(e)}}const Qt={Err:C_,_tlv:{encode:(t,e)=>{const{Err:r}=Qt;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const i=e.length/2,n=An(i);if(n.length/2&128)throw new r("tlv.encode: long form length too big");const s=i>127?An(n.length/2|128):"";return An(t)+s+n+e},decode(t,e){const{Err:r}=Qt;let i=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new r("tlv.decode: wrong tlv");const n=e[i++],s=!!(n&128);let o=0;if(!s)o=n;else{const c=n&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const l=e.subarray(i,i+c);if(l.length!==c)throw new r("tlv.decode: length bytes not complete");if(l[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(i+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(t){const{Err:e}=Qt;if(t<tr)throw new e("integer: negative integers are not allowed");let r=An(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Qt;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Ps(t)}},toSig(t){const{Err:e,_int:r,_tlv:i}=Qt,n=je("signature",t),{v:s,l:o}=i.decode(48,n);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,s),{v:l,l:u}=i.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(t){const{_tlv:e,_int:r}=Qt,i=e.encode(2,r.encode(t.r)),n=e.encode(2,r.encode(t.s)),s=i+n;return e.encode(48,s)}},tr=BigInt(0),yi=BigInt(1),Tp=BigInt(2),Cn=BigInt(3),B_=BigInt(4);function li(t,e){const{BYTES:r}=t;let i;if(typeof e=="bigint")i=e;else{let n=je("private key",e);try{i=t.fromBytes(n)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(i))throw new Error("invalid private key: out of range [1..N-1]");return i}function T_(t,e={}){const r=v_("weierstrass",t,e),{Fp:i,Fn:n}=r;let s=r.CURVE;const{h:o,n:a}=s;Cs(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!i.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const l=Np(i,n);function u(){if(!i.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(R,D,T){const{x:g,y:w}=D.toAffine(),I=i.toBytes(g);if(os(T,"isCompressed"),T){u();const P=!i.isOdd(w);return br(Rp(P),I)}else return br(Uint8Array.of(4),I,i.toBytes(w))}function f(R){qr(R,void 0,"Point");const{publicKey:D,publicKeyUncompressed:T}=l,g=R.length,w=R[0],I=R.subarray(1);if(g===D&&(w===2||w===3)){const P=i.fromBytes(I);if(!i.isValid(P))throw new Error("bad point: is not on curve, wrong x");const S=y(P);let $;try{$=i.sqrt(S)}catch(k){const V=k instanceof Error?": "+k.message:"";throw new Error("bad point: is not on curve, sqrt error"+V)}u();const U=i.isOdd($);return(w&1)===1!==U&&($=i.neg($)),{x:P,y:$}}else if(g===T&&w===4){const P=i.BYTES,S=i.fromBytes(I.subarray(0,P)),$=i.fromBytes(I.subarray(P,P*2));if(!m(S,$))throw new Error("bad point: is not on curve");return{x:S,y:$}}else throw new Error(`bad point: got length ${g}, expected compressed=${D} or uncompressed=${T}`)}const p=e.toBytes||h,d=e.fromBytes||f;function y(R){const D=i.sqr(R),T=i.mul(D,R);return i.add(i.add(T,i.mul(R,s.a)),s.b)}function m(R,D){const T=i.sqr(D),g=y(R);return i.eql(T,g)}if(!m(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const x=i.mul(i.pow(s.a,Cn),B_),O=i.mul(i.sqr(s.b),BigInt(27));if(i.is0(i.add(x,O)))throw new Error("bad curve params: a or b");function v(R,D,T=!1){if(!i.isValid(D)||T&&i.is0(D))throw new Error(`bad point coordinate ${R}`);return D}function b(R){if(!(R instanceof A))throw new Error("ProjectivePoint expected")}function E(R){if(!c||!c.basises)throw new Error("no endo");return P_(R,c.basises,n.ORDER)}const _=Ou((R,D)=>{const{X:T,Y:g,Z:w}=R;if(i.eql(w,i.ONE))return{x:T,y:g};const I=R.is0();D==null&&(D=I?i.ONE:i.inv(w));const P=i.mul(T,D),S=i.mul(g,D),$=i.mul(w,D);if(I)return{x:i.ZERO,y:i.ZERO};if(!i.eql($,i.ONE))throw new Error("invZ was invalid");return{x:P,y:S}}),C=Ou(R=>{if(R.is0()){if(e.allowInfinityPoint&&!i.is0(R.Y))return;throw new Error("bad point: ZERO")}const{x:D,y:T}=R.toAffine();if(!i.isValid(D)||!i.isValid(T))throw new Error("bad point: x or y not field elements");if(!m(D,T))throw new Error("bad point: equation left != right");if(!R.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function B(R,D,T,g,w){return T=new A(i.mul(T.X,R),T.Y,T.Z),D=cs(g,D),T=cs(w,T),D.add(T)}class A{constructor(D,T,g){this.X=v("x",D),this.Y=v("y",T,!0),this.Z=v("z",g),Object.freeze(this)}static CURVE(){return s}static fromAffine(D){const{x:T,y:g}=D||{};if(!D||!i.isValid(T)||!i.isValid(g))throw new Error("invalid affine point");if(D instanceof A)throw new Error("projective point not allowed");return i.is0(T)&&i.is0(g)?A.ZERO:new A(T,g,i.ONE)}static fromBytes(D){const T=A.fromAffine(d(qr(D,void 0,"point")));return T.assertValidity(),T}static fromHex(D){return A.fromBytes(je("pointHex",D))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(D=8,T=!0){return j.createCache(this,D),T||this.multiply(Cn),this}assertValidity(){C(this)}hasEvenY(){const{y:D}=this.toAffine();if(!i.isOdd)throw new Error("Field doesn't support isOdd");return!i.isOdd(D)}equals(D){b(D);const{X:T,Y:g,Z:w}=this,{X:I,Y:P,Z:S}=D,$=i.eql(i.mul(T,S),i.mul(I,w)),U=i.eql(i.mul(g,S),i.mul(P,w));return $&&U}negate(){return new A(this.X,i.neg(this.Y),this.Z)}double(){const{a:D,b:T}=s,g=i.mul(T,Cn),{X:w,Y:I,Z:P}=this;let S=i.ZERO,$=i.ZERO,U=i.ZERO,k=i.mul(w,w),V=i.mul(I,I),F=i.mul(P,P),q=i.mul(w,I);return q=i.add(q,q),U=i.mul(w,P),U=i.add(U,U),S=i.mul(D,U),$=i.mul(g,F),$=i.add(S,$),S=i.sub(V,$),$=i.add(V,$),$=i.mul(S,$),S=i.mul(q,S),U=i.mul(g,U),F=i.mul(D,F),q=i.sub(k,F),q=i.mul(D,q),q=i.add(q,U),U=i.add(k,k),k=i.add(U,k),k=i.add(k,F),k=i.mul(k,q),$=i.add($,k),F=i.mul(I,P),F=i.add(F,F),k=i.mul(F,q),S=i.sub(S,k),U=i.mul(F,V),U=i.add(U,U),U=i.add(U,U),new A(S,$,U)}add(D){b(D);const{X:T,Y:g,Z:w}=this,{X:I,Y:P,Z:S}=D;let $=i.ZERO,U=i.ZERO,k=i.ZERO;const V=s.a,F=i.mul(s.b,Cn);let q=i.mul(T,I),H=i.mul(g,P),G=i.mul(w,S),Z=i.add(T,g),W=i.add(I,P);Z=i.mul(Z,W),W=i.add(q,H),Z=i.sub(Z,W),W=i.add(T,w);let J=i.add(I,S);return W=i.mul(W,J),J=i.add(q,G),W=i.sub(W,J),J=i.add(g,w),$=i.add(P,S),J=i.mul(J,$),$=i.add(H,G),J=i.sub(J,$),k=i.mul(V,W),$=i.mul(F,G),k=i.add($,k),$=i.sub(H,k),k=i.add(H,k),U=i.mul($,k),H=i.add(q,q),H=i.add(H,q),G=i.mul(V,G),W=i.mul(F,W),H=i.add(H,G),G=i.sub(q,G),G=i.mul(V,G),W=i.add(W,G),q=i.mul(H,W),U=i.add(U,q),q=i.mul(J,W),$=i.mul(Z,$),$=i.sub($,q),q=i.mul(Z,H),k=i.mul(J,k),k=i.add(k,q),new A($,U,k)}subtract(D){return this.add(D.negate())}is0(){return this.equals(A.ZERO)}multiply(D){const{endo:T}=e;if(!n.isValidNot0(D))throw new Error("invalid scalar: out of range");let g,w;const I=P=>j.cached(this,P,S=>_o(A,S));if(T){const{k1neg:P,k1:S,k2neg:$,k2:U}=E(D),{p:k,f:V}=I(S),{p:F,f:q}=I(U);w=V.add(q),g=B(T.beta,k,F,P,$)}else{const{p:P,f:S}=I(D);g=P,w=S}return _o(A,[g,w])[0]}multiplyUnsafe(D){const{endo:T}=e,g=this;if(!n.isValid(D))throw new Error("invalid scalar: out of range");if(D===tr||g.is0())return A.ZERO;if(D===yi)return g;if(j.hasCache(this))return this.multiply(D);if(T){const{k1neg:w,k1:I,k2neg:P,k2:S}=E(D),{p1:$,p2:U}=m_(A,g,I,S);return B(T.beta,$,U,w,P)}else return j.unsafe(g,D)}multiplyAndAddUnsafe(D,T,g){const w=this.multiplyUnsafe(T).add(D.multiplyUnsafe(g));return w.is0()?void 0:w}toAffine(D){return _(this,D)}isTorsionFree(){const{isTorsionFree:D}=e;return o===yi?!0:D?D(A,this):j.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:D}=e;return o===yi?this:D?D(A,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(D=!0){return os(D,"isCompressed"),this.assertValidity(),p(A,this,D)}toHex(D=!0){return gi(this.toBytes(D))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(D=!0){return this.toBytes(D)}_setWindowSize(D){this.precompute(D)}static normalizeZ(D){return _o(A,D)}static msm(D,T){return b_(A,n,D,T)}static fromPrivateKey(D){return A.BASE.multiply(li(n,D))}}A.BASE=new A(s.Gx,s.Gy,i.ONE),A.ZERO=new A(i.ZERO,i.ONE,i.ZERO),A.Fp=i,A.Fn=n;const N=n.BITS,j=new w_(A,e.endo?Math.ceil(N/2):N);return A.BASE.precompute(8),A}function Rp(t){return Uint8Array.of(t?2:3)}function Np(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function R_(t,e={}){const{Fn:r}=t,i=e.randomBytes||Jr,n=Object.assign(Np(t.Fp,r),{seed:Ap(r.ORDER)});function s(f){try{return!!li(r,f)}catch{return!1}}function o(f,p){const{publicKey:d,publicKeyUncompressed:y}=n;try{const m=f.length;return p===!0&&m!==d||p===!1&&m!==y?!1:!!t.fromBytes(f)}catch{return!1}}function a(f=i(n.seed)){return p_(qr(f,n.seed,"seed"),r.ORDER)}function c(f,p=!0){return t.BASE.multiply(li(r,f)).toBytes(p)}function l(f){const p=a(f);return{secretKey:p,publicKey:c(p)}}function u(f){if(typeof f=="bigint")return!1;if(f instanceof t)return!0;const{secretKey:p,publicKey:d,publicKeyUncompressed:y}=n;if(r.allowedLengths||p===d)return;const m=je("key",f).length;return m===d||m===y}function h(f,p,d=!0){if(u(f)===!0)throw new Error("first arg must be private key");if(u(p)===!1)throw new Error("second arg must be public key");const y=li(r,f);return t.fromHex(p).multiply(y).toBytes(d)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:l,Point:t,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:f=>li(r,f),precompute(f=8,p=t.BASE){return p.precompute(f,!1)}},lengths:n})}function N_(t,e,r={}){Is(e),Cs(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const i=r.randomBytes||Jr,n=r.hmac||((T,...g)=>Ds(e,T,br(...g))),{Fp:s,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:l,getPublicKey:u,getSharedSecret:h,utils:f,lengths:p}=R_(t,r),d={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},y="compact";function m(T){const g=a>>yi;return T>g}function x(T,g){if(!o.isValidNot0(g))throw new Error(`invalid signature ${T}: out of range 1..Point.Fn.ORDER`);return g}function O(T,g){xa(g);const w=p.signature,I=g==="compact"?w:g==="recovered"?w+1:void 0;return qr(T,I,`${g} signature`)}class v{constructor(g,w,I){this.r=x("r",g),this.s=x("s",w),I!=null&&(this.recovery=I),Object.freeze(this)}static fromBytes(g,w=y){O(g,w);let I;if(w==="der"){const{r:U,s:k}=Qt.toSig(qr(g));return new v(U,k)}w==="recovered"&&(I=g[0],w="compact",g=g.subarray(1));const P=o.BYTES,S=g.subarray(0,P),$=g.subarray(P,P*2);return new v(o.fromBytes(S),o.fromBytes($),I)}static fromHex(g,w){return this.fromBytes(ns(g),w)}addRecoveryBit(g){return new v(this.r,this.s,g)}recoverPublicKey(g){const w=s.ORDER,{r:I,s:P,recovery:S}=this;if(S==null||![0,1,2,3].includes(S))throw new Error("recovery id invalid");if(a*Tp<w&&S>1)throw new Error("recovery id is ambiguous for h>1 curve");const $=S===2||S===3?I+a:I;if(!s.isValid($))throw new Error("recovery id 2 or 3 invalid");const U=s.toBytes($),k=t.fromBytes(br(Rp((S&1)===0),U)),V=o.inv($),F=E(je("msgHash",g)),q=o.create(-F*V),H=o.create(P*V),G=t.BASE.multiplyUnsafe(q).add(k.multiplyUnsafe(H));if(G.is0())throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return m(this.s)}toBytes(g=y){if(xa(g),g==="der")return ns(Qt.hexFromSig(this));const w=o.toBytes(this.r),I=o.toBytes(this.s);if(g==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return br(Uint8Array.of(this.recovery),w,I)}return br(w,I)}toHex(g){return gi(this.toBytes(g))}assertValidity(){}static fromCompact(g){return v.fromBytes(je("sig",g),"compact")}static fromDER(g){return v.fromBytes(je("sig",g),"der")}normalizeS(){return this.hasHighS()?new v(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return gi(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return gi(this.toBytes("compact"))}}const b=r.bits2int||function(T){if(T.length>8192)throw new Error("input is too large");const g=Ps(T),w=T.length*8-c;return w>0?g>>BigInt(w):g},E=r.bits2int_modN||function(T){return o.create(b(T))},_=dn(c);function C(T){return va("num < 2^"+c,T,tr,_),o.toBytes(T)}function B(T,g){return qr(T,void 0,"message"),g?qr(e(T),void 0,"prehashed message"):T}function A(T,g,w){if(["recovered","canonical"].some(H=>H in w))throw new Error("sign() legacy options not supported");const{lowS:I,prehash:P,extraEntropy:S}=$o(w,d);T=B(T,P);const $=E(T),U=li(o,g),k=[C(U),C($)];if(S!=null&&S!==!1){const H=S===!0?i(p.secretKey):S;k.push(je("extraEntropy",H))}const V=br(...k),F=$;function q(H){const G=b(H);if(!o.isValidNot0(G))return;const Z=o.inv(G),W=t.BASE.multiply(G).toAffine(),J=o.create(W.x);if(J===tr)return;const ue=o.create(Z*o.create(F+J*U));if(ue===tr)return;let ye=(W.x===J?0:2)|Number(W.y&yi),be=ue;return I&&m(ue)&&(be=o.neg(ue),ye^=1),new v(J,be,ye)}return{seed:V,k2sig:q}}function N(T,g,w={}){T=je("message",T);const{seed:I,k2sig:P}=A(T,g,w);return s_(e.outputLen,o.BYTES,n)(I,P)}function j(T){let g;const w=typeof T=="string"||_s(T),I=!w&&T!==null&&typeof T=="object"&&typeof T.r=="bigint"&&typeof T.s=="bigint";if(!w&&!I)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(I)g=new v(T.r,T.s);else if(w){try{g=v.fromBytes(je("sig",T),"der")}catch(P){if(!(P instanceof Qt.Err))throw P}if(!g)try{g=v.fromBytes(je("sig",T),"compact")}catch{return!1}}return g||!1}function R(T,g,w,I={}){const{lowS:P,prehash:S,format:$}=$o(I,d);if(w=je("publicKey",w),g=B(je("message",g),S),"strict"in I)throw new Error("options.strict was renamed to lowS");const U=$===void 0?j(T):v.fromBytes(je("sig",T),$);if(U===!1)return!1;try{const k=t.fromBytes(w);if(P&&U.hasHighS())return!1;const{r:V,s:F}=U,q=E(g),H=o.inv(F),G=o.create(q*H),Z=o.create(V*H),W=t.BASE.multiplyUnsafe(G).add(k.multiplyUnsafe(Z));return W.is0()?!1:o.create(W.x)===V}catch{return!1}}function D(T,g,w={}){const{prehash:I}=$o(w,d);return g=B(g,I),v.fromBytes(T,"recovered").recoverPublicKey(g).toBytes()}return Object.freeze({keygen:l,getPublicKey:u,getSharedSecret:h,utils:f,lengths:p,Point:t,sign:N,verify:R,recoverPublicKey:D,Signature:v,hash:e})}function U_(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let i=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const n=Ar(e.n,{BITS:t.nBitLength,allowedLengths:i,modFromBytes:t.wrapPrivateKey}),s={Fp:r,Fn:n,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function j_(t){const{CURVE:e,curveOpts:r}=U_(t),i={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:i}}function k_(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,$p(r.Fn.ORDER,r.Fn.BITS))})}function L_(t){const{CURVE:e,curveOpts:r,hash:i,ecdsaOpts:n}=j_(t),s=T_(e,r),o=N_(s,i,n);return k_(t,o)}function _a(t,e){const r=i=>L_({...t,hash:i});return{...r(e),create:r}}const Up={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},jp={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},kp={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},F_=Ar(Up.p),M_=Ar(jp.p),q_=Ar(kp.p),z_=_a({...Up,Fp:F_,lowS:!1},Os);_a({...jp,Fp:M_,lowS:!1},G2),_a({...kp,Fp:q_,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},W2);const V_=z_,Lp="base10",Me="base16",Ge="base64pad",vr="base64url",pn="utf8",Fp=0,nr=1,gn=2,K_=0,Ru=1,Vi=12,Ec=32;function H_(){const t=Ea.utils.randomPrivateKey(),e=Ea.getPublicKey(t);return{privateKey:Je(t,Me),publicKey:Je(e,Me)}}function Ia(){const t=Jr(Ec);return Je(t,Me)}function W_(t,e){const r=Ea.getSharedSecret(gt(t,Me),gt(e,Me)),i=i_(As,r,void 0,void 0,Ec);return Je(i,Me)}function zn(t){const e=As(gt(t,Me));return Je(e,Me)}function dt(t){const e=As(gt(t,pn));return Je(e,Me)}function Mp(t){return gt(`${t}`,Lp)}function Yr(t){return Number(Je(t,Lp))}function qp(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function zp(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function G_(t){const e=Mp(typeof t.type<"u"?t.type:Fp);if(Yr(e)===nr&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?gt(t.senderPublicKey,Me):void 0,i=typeof t.iv<"u"?gt(t.iv,Me):Jr(Vi),n=gt(t.symKey,Me),s=gp(n,i).encrypt(gt(t.message,pn)),o=Vp({type:e,sealed:s,iv:i,senderPublicKey:r});return t.encoding===vr?qp(o):o}function Y_(t){const e=gt(t.symKey,Me),{sealed:r,iv:i}=en({encoded:t.encoded,encoding:t.encoding}),n=gp(e,i).decrypt(r);if(n===null)throw new Error("Failed to decrypt");return Je(n,pn)}function Z_(t,e){const r=Mp(gn),i=Jr(Vi),n=gt(t,pn),s=Vp({type:r,sealed:n,iv:i});return e===vr?qp(s):s}function J_(t,e){const{sealed:r}=en({encoded:t,encoding:e});return Je(r,pn)}function Vp(t){if(Yr(t.type)===gn)return Je(zi([t.type,t.sealed]),Ge);if(Yr(t.type)===nr){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Je(zi([t.type,t.senderPublicKey,t.iv,t.sealed]),Ge)}return Je(zi([t.type,t.iv,t.sealed]),Ge)}function en(t){const e=(t.encoding||Ge)===vr?zp(t.encoded):t.encoded,r=gt(e,Ge),i=r.slice(K_,Ru),n=Ru;if(Yr(i)===nr){const c=n+Ec,l=c+Vi,u=r.slice(n,c),h=r.slice(c,l),f=r.slice(l);return{type:i,sealed:f,iv:h,senderPublicKey:u}}if(Yr(i)===gn){const c=r.slice(n),l=Jr(Vi);return{type:i,sealed:c,iv:l}}const s=n+Vi,o=r.slice(n,s),a=r.slice(s);return{type:i,sealed:a,iv:o}}function X_(t,e){const r=en({encoded:t,encoding:e?.encoding});return Kp({type:Yr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?Je(r.senderPublicKey,Me):void 0,receiverPublicKey:e?.receiverPublicKey})}function Kp(t){const e=t?.type||Fp;if(e===nr){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function Nu(t){return t.type===nr&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function Uu(t){return t.type===gn}function Q_(t){const e=Buffer.from(t.x,"base64"),r=Buffer.from(t.y,"base64");return zi([new Uint8Array([4]),e,r])}function e3(t,e){const[r,i,n]=t.split("."),s=Buffer.from(zp(n),"base64");if(s.length!==64)throw new Error("Invalid signature length");const o=s.slice(0,32),a=s.slice(32,64),c=`${r}.${i}`,l=As(c),u=Q_(e);if(!V_.verify(zi([o,a]),l,u))throw new Error("Invalid signature");return ca(t).payload}const t3="irn";function ls(t){return t?.relay||{protocol:t3}}function ui(t){const e=Hv[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var r3=Object.defineProperty,i3=Object.defineProperties,n3=Object.getOwnPropertyDescriptors,ju=Object.getOwnPropertySymbols,s3=Object.prototype.hasOwnProperty,o3=Object.prototype.propertyIsEnumerable,ku=(t,e,r)=>e in t?r3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Do=(t,e)=>{for(var r in e||(e={}))s3.call(e,r)&&ku(t,r,e[r]);if(ju)for(var r of ju(e))o3.call(e,r)&&ku(t,r,e[r]);return t},a3=(t,e)=>i3(t,n3(e));function c3(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(n=>{if(n.startsWith(i)){const s=n.replace(i,""),o=t[n];r[s]=o}}),r}function Lu(t){if(!t.includes("wc:")){const l=Gd(t);l!=null&&l.includes("wc:")&&(t=l)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),n=t.substring(e+1,r).split("@"),s=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(s),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:i,topic:l3(n[0]),version:parseInt(n[1],10),symKey:a.symKey,relay:c3(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function l3(t){return t.startsWith("//")?t.substring(2):t}function u3(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(n=>{const s=n,o=r+e+s;t[s]&&(i[o]=t[s])}),i}function Fu(t){const e=new URLSearchParams,r=Do(Do(a3(Do({},u3(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(r).sort(([i],[n])=>i.localeCompare(n)).forEach(([i,n])=>{n!==void 0&&e.append(i,String(n))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}function Bn(t,e,r){return`${t}?wc_ev=${r}&topic=${e}`}var h3=Object.defineProperty,f3=Object.defineProperties,d3=Object.getOwnPropertyDescriptors,Mu=Object.getOwnPropertySymbols,p3=Object.prototype.hasOwnProperty,g3=Object.prototype.propertyIsEnumerable,qu=(t,e,r)=>e in t?h3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,y3=(t,e)=>{for(var r in e||(e={}))p3.call(e,r)&&qu(t,r,e[r]);if(Mu)for(var r of Mu(e))g3.call(e,r)&&qu(t,r,e[r]);return t},w3=(t,e)=>f3(t,d3(e));function _i(t){const e=[];return t.forEach(r=>{const[i,n]=r.split(":");e.push(`${i}:${n}`)}),e}function Hp(t){const e=[];return Object.values(t).forEach(r=>{e.push(..._i(r.accounts))}),[...new Set(e)]}function m3(t){const e=[];return Object.values(t).forEach(r=>{e.push(...r.methods)}),[...new Set(e)]}function b3(t){const e=[];return Object.values(t).forEach(r=>{e.push(...r.events)}),[...new Set(e)]}function v3(t,e){const r=[];return Object.values(t).forEach(i=>{_i(i.accounts).includes(e)&&r.push(...i.methods)}),r}function E3(t,e){const r=[];return Object.values(t).forEach(i=>{_i(i.accounts).includes(e)&&r.push(...i.events)}),r}function Bs(t){return t.includes(":")}function hi(t){return Bs(t)?t.split(":")[0]:t}function zu(t){var e,r,i;const n={};if(!Ft(t))return n;for(const[s,o]of Object.entries(t)){const a=Bs(s)?[s]:o.chains,c=o.methods||[],l=o.events||[],u=hi(s);n[u]=w3(y3({},n[u]),{chains:Lt(a,(e=n[u])==null?void 0:e.chains),methods:Lt(c,(r=n[u])==null?void 0:r.methods),events:Lt(l,(i=n[u])==null?void 0:i.events)})}return n}function x3(t){const e={};return t?.forEach(r=>{var i;const[n,s]=r.split(":");e[n]||(e[n]={accounts:[],chains:[],events:[],methods:[]}),e[n].accounts.push(r),(i=e[n].chains)==null||i.push(`${n}:${s}`)}),e}function Vu(t,e){e=e.map(i=>i.replace("did:pkh:",""));const r=x3(e);for(const[i,n]of Object.entries(r))n.methods?n.methods=Lt(n.methods,t):n.methods=t,n.events=["chainChanged","accountsChanged"];return r}function _3(t,e){var r,i,n,s,o,a;const c=zu(t),l=zu(e),u={},h=Object.keys(c).concat(Object.keys(l));for(const f of h)u[f]={chains:Lt((r=c[f])==null?void 0:r.chains,(i=l[f])==null?void 0:i.chains),methods:Lt((n=c[f])==null?void 0:n.methods,(s=l[f])==null?void 0:s.methods),events:Lt((o=c[f])==null?void 0:o.events,(a=l[f])==null?void 0:a.events)};return u}const I3={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},S3={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function z(t,e){const{message:r,code:i}=S3[t];return{message:e?`${r} ${e}`:r,code:i}}function ce(t,e){const{message:r,code:i}=I3[t];return{message:e?`${r} ${e}`:r,code:i}}function yt(t,e){return!!Array.isArray(t)}function Ft(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Ie(t){return typeof t>"u"}function ge(t,e){return e&&Ie(t)?!0:typeof t=="string"&&!!t.trim().length}function xc(t,e){return typeof t=="number"&&!isNaN(t)}function O3(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),n=Object.keys(r);let s=!0;return Mr(n,i)?(i.forEach(o=>{const{accounts:a,methods:c,events:l}=t.namespaces[o],u=_i(a),h=r[o];(!Mr(zd(o,h),u)||!Mr(h.methods,c)||!Mr(h.events,l))&&(s=!1)}),s):!1}function us(t){return ge(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function $3(t){if(ge(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&us(r)}}return!1}function D3(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(ge(t,!1)){if(e(t))return!0;const r=Gd(t);return e(r)}}catch{}return!1}function A3(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function P3(t){return t?.topic}function C3(t,e){let r=null;return ge(t?.publicKey,!1)||(r=z("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function Ku(t){let e=!0;return yt(t)?t.length&&(e=t.every(r=>ge(r,!1))):e=!1,e}function B3(t,e,r){let i=null;return yt(e)&&e.length?e.forEach(n=>{i||us(n)||(i=ce("UNSUPPORTED_CHAINS",`${r}, chain ${n} should be a string and conform to "namespace:chainId" format`))}):us(t)||(i=ce("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function T3(t,e,r){let i=null;return Object.entries(t).forEach(([n,s])=>{if(i)return;const o=B3(n,zd(n,s),`${e} ${r}`);o&&(i=o)}),i}function R3(t,e){let r=null;return yt(t)?t.forEach(i=>{r||$3(i)||(r=ce("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=ce("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function N3(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=R3(i?.accounts,`${e} namespace`);n&&(r=n)}),r}function U3(t,e){let r=null;return Ku(t?.methods)?Ku(t?.events)||(r=ce("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=ce("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function Wp(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=U3(i,`${e}, namespace`);n&&(r=n)}),r}function j3(t,e,r){let i=null;if(t&&Ft(t)){const n=Wp(t,e);n&&(i=n);const s=T3(t,e,r);s&&(i=s)}else i=z("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return i}function Ao(t,e){let r=null;if(t&&Ft(t)){const i=Wp(t,e);i&&(r=i);const n=N3(t,e);n&&(r=n)}else r=z("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function Gp(t){return ge(t.protocol,!0)}function k3(t,e){let r=!1;return t?t&&yt(t)&&t.length&&t.forEach(i=>{r=Gp(i)}):r=!0,r}function L3(t){return typeof t=="number"}function Ke(t){return typeof t<"u"&&typeof t!==null}function F3(t){return!(!t||typeof t!="object"||!t.code||!xc(t.code)||!t.message||!ge(t.message,!1))}function M3(t){return!(Ie(t)||!ge(t.method,!1))}function q3(t){return!(Ie(t)||Ie(t.result)&&Ie(t.error)||!xc(t.id)||!ge(t.jsonrpc,!1))}function z3(t){return!(Ie(t)||!ge(t.name,!1))}function Hu(t,e){return!(!us(e)||!Hp(t).includes(e))}function V3(t,e,r){return ge(r,!1)?v3(t,e).includes(r):!1}function K3(t,e,r){return ge(r,!1)?E3(t,e).includes(r):!1}function Wu(t,e,r){let i=null;const n=H3(t),s=W3(e),o=Object.keys(n),a=Object.keys(s),c=Gu(Object.keys(t)),l=Gu(Object.keys(e)),u=c.filter(h=>!l.includes(h));return u.length&&(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(e).toString()}`)),Mr(o,a)||(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||i)return;const f=_i(e[h].accounts);f.includes(h)||(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${f.toString()}`))}),o.forEach(h=>{i||(Mr(n[h].methods,s[h].methods)?Mr(n[h].events,s[h].events)||(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${h}`)):i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${h}`))}),i}function H3(t){const e={};return Object.keys(t).forEach(r=>{var i;r.includes(":")?e[r]=t[r]:(i=t[r].chains)==null||i.forEach(n=>{e[n]={methods:t[r].methods,events:t[r].events}})}),e}function Gu(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function W3(t){const e={};return Object.keys(t).forEach(r=>{r.includes(":")?e[r]=t[r]:_i(t[r].accounts)?.forEach(n=>{e[n]={accounts:t[r].accounts.filter(s=>s.includes(`${n}:`)),methods:t[r].methods,events:t[r].events}})}),e}function G3(t,e){return xc(t)&&t<=e.max&&t>=e.min}function Yu(){const t=hn();return new Promise(e=>{switch(t){case st.browser:e(Y3());break;case st.reactNative:e(Z3());break;case st.node:e(J3());break;default:e(!0)}})}function Y3(){return xi()&&navigator?.onLine}async function Z3(){return Dr()&&typeof global<"u"&&global!=null&&global.NetInfo?(await(global==null?void 0:global.NetInfo.fetch()))?.isConnected:!0}function J3(){return!0}function X3(t){switch(hn()){case st.browser:Q3(t);break;case st.reactNative:eI(t);break}}function Q3(t){!Dr()&&xi()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function eI(t){Dr()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}function tI(){var t;return xi()&&sr.getDocument()?((t=sr.getDocument())==null?void 0:t.visibilityState)==="visible":!0}const Po={};class Bi{static get(e){return Po[e]}static set(e,r){Po[e]=r}static delete(e){delete Po[e]}}function rI(t){const e=sn.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function iI({publicKey:t,signature:e,payload:r}){var i;const n=Sa(r.method),s=128|parseInt(((i=r.version)==null?void 0:i.toString())||"4"),o=oI(r.address),a=r.era==="00"?new Uint8Array([0]):Sa(r.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(r.nonce,16),l=new Uint8Array([c&255,c>>8&255]),u=BigInt(`0x${sI(r.tip)}`),h=cI(u),f=new Uint8Array([0,...t,o,...e,...a,...l,...h,...n]),p=aI(f.length+1);return new Uint8Array([...p,s,...f])}function nI(t){const e=Sa(t),r=Zv.blake2b(e,void 0,32);return"0x"+Buffer.from(r).toString("hex")}function Sa(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function sI(t){return t.startsWith("0x")?t.slice(2):t}function oI(t){const e=sn.decode(t)[0];return e===42?0:e===60?2:1}function aI(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function cI(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function lI(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),r=rI(t.transaction.address),i=iI({publicKey:r,signature:e,payload:t.transaction}),n=Buffer.from(i).toString("hex");return nI(n)}function _c({logger:t,name:e}){const r=typeof t=="string"?qd({opts:{level:t,name:e}}).logger:t;return r.level=typeof t=="string"?t:t.level,r}class Xr{}let uI=class extends Xr{constructor(e){super()}};const Zu=M.FIVE_SECONDS,Qr={pulse:"heartbeat_pulse"};let hI=class Yp extends uI{constructor(e){super(e),this.events=new ot.EventEmitter,this.interval=Zu,this.interval=e?.interval||Zu}static async init(e){const r=new Yp(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),M.toMiliseconds(this.interval))}pulse(){this.events.emit(Qr.pulse)}};const fI=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,dI=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,pI=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function gI(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){yI(t);return}return e}function yI(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function Tn(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const r=t.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!pI.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(fI.test(t)||dI.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,gI)}return JSON.parse(t)}catch(i){if(e.strict)throw i;return t}}function wI(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function xe(t,...e){try{return wI(t(...e))}catch(r){return Promise.reject(r)}}function mI(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function bI(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function Vn(t){if(mI(t))return String(t);if(bI(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return Vn(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Oa="base64:";function vI(t){return typeof t=="string"?t:Oa+_I(t)}function EI(t){return typeof t!="string"||!t.startsWith(Oa)?t:xI(t.slice(Oa.length))}function xI(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function _I(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Ve(t){return t&&t.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function II(...t){return Ve(t.join(":"))}function Rn(t){return t=Ve(t),t?t+":":""}function SI(t,e){if(e===void 0)return!0;let r=0,i=t.indexOf(":");for(;i>-1;)r++,i=t.indexOf(":",i+1);return r<=e}function OI(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const $I="memory",DI=()=>{const t=new Map;return{name:$I,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function AI(t={}){const e={mounts:{"":t.driver||DI()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=l=>{for(const u of e.mountpoints)if(l.startsWith(u))return{base:u,relativeKey:l.slice(u.length),driver:e.mounts[u]};return{base:"",relativeKey:l,driver:e.mounts[""]}},i=(l,u)=>e.mountpoints.filter(h=>h.startsWith(l)||u&&l.startsWith(h)).map(h=>({relativeBase:l.length>h.length?l.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),n=(l,u)=>{if(e.watching){u=Ve(u);for(const h of e.watchListeners)h(l,u)}},s=async()=>{if(!e.watching){e.watching=!0;for(const l in e.mounts)e.unwatch[l]=await Ju(e.mounts[l],n,l)}},o=async()=>{if(e.watching){for(const l in e.unwatch)await e.unwatch[l]();e.unwatch={},e.watching=!1}},a=(l,u,h)=>{const f=new Map,p=d=>{let y=f.get(d.base);return y||(y={driver:d.driver,base:d.base,items:[]},f.set(d.base,y)),y};for(const d of l){const y=typeof d=="string",m=Ve(y?d:d.key),x=y?void 0:d.value,O=y||!d.options?u:{...u,...d.options},v=r(m);p(v).items.push({key:m,value:x,relativeKey:v.relativeKey,options:O})}return Promise.all([...f.values()].map(d=>h(d))).then(d=>d.flat())},c={hasItem(l,u={}){l=Ve(l);const{relativeKey:h,driver:f}=r(l);return xe(f.hasItem,h,u)},getItem(l,u={}){l=Ve(l);const{relativeKey:h,driver:f}=r(l);return xe(f.getItem,h,u).then(p=>Tn(p))},getItems(l,u={}){return a(l,u,h=>h.driver.getItems?xe(h.driver.getItems,h.items.map(f=>({key:f.relativeKey,options:f.options})),u).then(f=>f.map(p=>({key:II(h.base,p.key),value:Tn(p.value)}))):Promise.all(h.items.map(f=>xe(h.driver.getItem,f.relativeKey,f.options).then(p=>({key:f.key,value:Tn(p)})))))},getItemRaw(l,u={}){l=Ve(l);const{relativeKey:h,driver:f}=r(l);return f.getItemRaw?xe(f.getItemRaw,h,u):xe(f.getItem,h,u).then(p=>EI(p))},async setItem(l,u,h={}){if(u===void 0)return c.removeItem(l);l=Ve(l);const{relativeKey:f,driver:p}=r(l);p.setItem&&(await xe(p.setItem,f,Vn(u),h),p.watch||n("update",l))},async setItems(l,u){await a(l,u,async h=>{if(h.driver.setItems)return xe(h.driver.setItems,h.items.map(f=>({key:f.relativeKey,value:Vn(f.value),options:f.options})),u);h.driver.setItem&&await Promise.all(h.items.map(f=>xe(h.driver.setItem,f.relativeKey,Vn(f.value),f.options)))})},async setItemRaw(l,u,h={}){if(u===void 0)return c.removeItem(l,h);l=Ve(l);const{relativeKey:f,driver:p}=r(l);if(p.setItemRaw)await xe(p.setItemRaw,f,u,h);else if(p.setItem)await xe(p.setItem,f,vI(u),h);else return;p.watch||n("update",l)},async removeItem(l,u={}){typeof u=="boolean"&&(u={removeMeta:u}),l=Ve(l);const{relativeKey:h,driver:f}=r(l);f.removeItem&&(await xe(f.removeItem,h,u),(u.removeMeta||u.removeMata)&&await xe(f.removeItem,h+"$",u),f.watch||n("remove",l))},async getMeta(l,u={}){typeof u=="boolean"&&(u={nativeOnly:u}),l=Ve(l);const{relativeKey:h,driver:f}=r(l),p=Object.create(null);if(f.getMeta&&Object.assign(p,await xe(f.getMeta,h,u)),!u.nativeOnly){const d=await xe(f.getItem,h+"$",u).then(y=>Tn(y));d&&typeof d=="object"&&(typeof d.atime=="string"&&(d.atime=new Date(d.atime)),typeof d.mtime=="string"&&(d.mtime=new Date(d.mtime)),Object.assign(p,d))}return p},setMeta(l,u,h={}){return this.setItem(l+"$",u,h)},removeMeta(l,u={}){return this.removeItem(l+"$",u)},async getKeys(l,u={}){l=Rn(l);const h=i(l,!0);let f=[];const p=[];let d=!0;for(const m of h){m.driver.flags?.maxDepth||(d=!1);const x=await xe(m.driver.getKeys,m.relativeBase,u);for(const O of x){const v=m.mountpoint+Ve(O);f.some(b=>v.startsWith(b))||p.push(v)}f=[m.mountpoint,...f.filter(O=>!O.startsWith(m.mountpoint))]}const y=u.maxDepth!==void 0&&!d;return p.filter(m=>(!y||SI(m,u.maxDepth))&&OI(m,l))},async clear(l,u={}){l=Rn(l),await Promise.all(i(l,!1).map(async h=>{if(h.driver.clear)return xe(h.driver.clear,h.relativeBase,u);if(h.driver.removeItem){const f=await h.driver.getKeys(h.relativeBase||"",u);return Promise.all(f.map(p=>h.driver.removeItem(p,u)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(l=>Xu(l)))},async watch(l){return await s(),e.watchListeners.push(l),async()=>{e.watchListeners=e.watchListeners.filter(u=>u!==l),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(l,u){if(l=Rn(l),l&&e.mounts[l])throw new Error(`already mounted at ${l}`);return l&&(e.mountpoints.push(l),e.mountpoints.sort((h,f)=>f.length-h.length)),e.mounts[l]=u,e.watching&&Promise.resolve(Ju(u,n,l)).then(h=>{e.unwatch[l]=h}).catch(console.error),c},async unmount(l,u=!0){l=Rn(l),!(!l||!e.mounts[l])&&(e.watching&&l in e.unwatch&&(e.unwatch[l]?.(),delete e.unwatch[l]),u&&await Xu(e.mounts[l]),e.mountpoints=e.mountpoints.filter(h=>h!==l),delete e.mounts[l])},getMount(l=""){l=Ve(l)+":";const u=r(l);return{driver:u.driver,base:u.base}},getMounts(l="",u={}){return l=Ve(l),i(l,u.parents).map(f=>({driver:f.driver,base:f.mountpoint}))},keys:(l,u={})=>c.getKeys(l,u),get:(l,u={})=>c.getItem(l,u),set:(l,u,h={})=>c.setItem(l,u,h),has:(l,u={})=>c.hasItem(l,u),del:(l,u={})=>c.removeItem(l,u),remove:(l,u={})=>c.removeItem(l,u)};return c}function Ju(t,e,r){return t.watch?t.watch((i,n)=>e(i,r+n)):()=>{}}async function Xu(t){typeof t.dispose=="function"&&await xe(t.dispose)}const PI="idb-keyval";var CI=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=n=>e+n;let i;return t.dbName&&t.storeName&&(i=xf(t.dbName,t.storeName)),{name:PI,options:t,async hasItem(n){return!(typeof await qc(r(n),i)>"u")},async getItem(n){return await qc(r(n),i)??null},setItem(n,s){return sy(r(n),s,i)},removeItem(n){return oy(r(n),i)},getKeys(){return ly(i)},clear(){return ay(i)}}};const BI="WALLET_CONNECT_V2_INDEXED_DB",TI="keyvaluestorage";let RI=class{constructor(){this.indexedDb=AI({driver:CI({dbName:BI,storeName:TI})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,Wr(r))}async removeItem(e){await this.indexedDb.removeItem(e)}};var Co=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Kn={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Co<"u"&&Co.localStorage?Kn.exports=Co.localStorage:typeof window<"u"&&window.localStorage?Kn.exports=window.localStorage:Kn.exports=new e})();function NI(t){var e;return[t[0],Hr((e=t[1])!=null?e:"")]}let UI=class{constructor(){this.localStorage=Kn.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(NI)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return Hr(r)}async setItem(e,r){this.localStorage.setItem(e,Wr(r))}async removeItem(e){this.localStorage.removeItem(e)}};const jI="wc_storage_version",Qu=1,kI=async(t,e,r)=>{const i=jI,n=await e.getItem(i);if(n&&n>=Qu){r(e);return}const s=await t.getKeys();if(!s.length){r(e);return}const o=[];for(;s.length;){const a=s.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const l=await t.getItem(a);await e.setItem(a,l),o.push(a)}}await e.setItem(i,Qu),r(e),LI(t,o)},LI=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};let FI=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new UI;this.storage=e;try{const r=new RI;kI(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}};var MI=Object.defineProperty,qI=(t,e,r)=>e in t?MI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,eh=(t,e,r)=>qI(t,typeof e!="symbol"?e+"":e,r);let zI=class extends Xr{constructor(e){super(),this.opts=e,eh(this,"protocol","wc"),eh(this,"version",2)}};var VI=Object.defineProperty,KI=(t,e,r)=>e in t?VI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,HI=(t,e,r)=>KI(t,e+"",r);let WI=class extends Xr{constructor(e,r){super(),this.core=e,this.logger=r,HI(this,"records",new Map)}},GI=class{constructor(e,r){this.logger=e,this.core=r}};class YI extends Xr{constructor(e,r){super(),this.relayer=e,this.logger=r}}let ZI=class extends Xr{constructor(e){super()}},JI=class{constructor(e,r,i,n){this.core=e,this.logger=r,this.name=i}},XI=class extends Xr{constructor(e,r){super(),this.relayer=e,this.logger=r}},QI=class extends Xr{constructor(e,r){super(),this.core=e,this.logger=r}},eS=class{constructor(e,r,i){this.core=e,this.logger=r,this.store=i}},tS=class{constructor(e,r){this.projectId=e,this.logger=r}},rS=class{constructor(e,r,i){this.core=e,this.logger=r,this.telemetryEnabled=i}};var iS=Object.defineProperty,nS=(t,e,r)=>e in t?iS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,th=(t,e,r)=>nS(t,typeof e!="symbol"?e+"":e,r);let sS=class{constructor(e){this.opts=e,th(this,"protocol","wc"),th(this,"version",2)}},oS=class{constructor(e){this.client=e}};const aS="PARSE_ERROR",cS="INVALID_REQUEST",lS="METHOD_NOT_FOUND",uS="INVALID_PARAMS",Zp="INTERNAL_ERROR",Ic="SERVER_ERROR",hS=[-32700,-32600,-32601,-32602,-32603],Ki={[aS]:{code:-32700,message:"Parse error"},[cS]:{code:-32600,message:"Invalid Request"},[lS]:{code:-32601,message:"Method not found"},[uS]:{code:-32602,message:"Invalid params"},[Zp]:{code:-32603,message:"Internal error"},[Ic]:{code:-32e3,message:"Server error"}},Jp=Ic;function fS(t){return hS.includes(t)}function rh(t){return Object.keys(Ki).includes(t)?Ki[t]:Ki[Jp]}function dS(t){const e=Object.values(Ki).find(r=>r.code===t);return e||Ki[Jp]}function Xp(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var Bo={};var $a=function(t,e){return $a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},$a(t,e)};function pS(t,e){$a(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Da=function(){return Da=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Da.apply(this,arguments)};function gS(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function yS(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,r,s):o(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function wS(t,e){return function(r,i){e(r,i,t)}}function mS(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function bS(t,e,r,i){function n(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(h){o(h)}}function c(u){try{l(i.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):n(u.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function vS(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=l[0]&2?n.return:l[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,l[1])).done)return s;switch(n=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(u){l=[6,u],n=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function ES(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function xS(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Aa(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Qp(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}function _S(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Qp(arguments[e]));return t}function IS(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,n++)i[n]=s[o];return i}function tn(t){return this instanceof tn?(this.v=t,this):new tn(t)}function SS(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(f){i[f]&&(n[f]=function(p){return new Promise(function(d,y){s.push([f,p,d,y])>1||a(f,p)})})}function a(f,p){try{c(i[f](p))}catch(d){h(s[0][3],d)}}function c(f){f.value instanceof tn?Promise.resolve(f.value.v).then(l,u):h(s[0][2],f)}function l(f){a("next",f)}function u(f){a("throw",f)}function h(f,p){f(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}function OS(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(o){return(r=!r)?{value:tn(t[n](o)),done:n==="return"}:s?s(o):o}:s}}function $S(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Aa=="function"?Aa(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),n(a,c,o.done,o.value)})}}function n(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function DS(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function AS(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function PS(t){return t&&t.__esModule?t:{default:t}}function CS(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function BS(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const TS=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Da},__asyncDelegator:OS,__asyncGenerator:SS,__asyncValues:$S,__await:tn,__awaiter:bS,__classPrivateFieldGet:CS,__classPrivateFieldSet:BS,__createBinding:ES,__decorate:yS,__exportStar:xS,__extends:pS,__generator:vS,__importDefault:PS,__importStar:AS,__makeTemplateObject:DS,__metadata:mS,__param:wS,__read:Qp,__rest:gS,__spread:_S,__spreadArrays:IS,__values:Aa},Symbol.toStringTag,{value:"Module"})),RS=pf(TS);var Wt={},ih;function NS(){if(ih)return Wt;ih=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.isBrowserCryptoAvailable=Wt.getSubtleCrypto=Wt.getBrowerCrypto=void 0;function t(){return(Nt===null||Nt===void 0?void 0:Nt.crypto)||(Nt===null||Nt===void 0?void 0:Nt.msCrypto)||{}}Wt.getBrowerCrypto=t;function e(){const i=t();return i.subtle||i.webkitSubtle}Wt.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return Wt.isBrowserCryptoAvailable=r,Wt}var Gt={},nh;function US(){if(nh)return Gt;nh=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.isBrowser=Gt.isNode=Gt.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Gt.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Gt.isNode=e;function r(){return!t()&&!e()}return Gt.isBrowser=r,Gt}var sh;function jS(){return sh||(sh=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=RS;e.__exportStar(NS(),t),e.__exportStar(US(),t)})(Bo)),Bo}var kS=jS();function Tt(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function xr(t=6){return BigInt(Tt(t))}function It(t,e,r){return{id:r||Tt(),jsonrpc:"2.0",method:t,params:e}}function rn(t,e){return{id:t,jsonrpc:"2.0",result:e}}function Ts(t,e,r){return{id:t,jsonrpc:"2.0",error:LS(e)}}function LS(t,e){return typeof t>"u"?rh(Zp):(typeof t=="string"&&(t=Object.assign(Object.assign({},rh(Ic)),{message:t})),fS(t.code)&&(t=dS(t.code)),t)}class FS{}class MS extends FS{constructor(){super()}}class qS extends MS{constructor(e){super()}}const zS="^https?:",VS="^wss?:";function KS(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function eg(t,e){const r=KS(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function oh(t){return eg(t,zS)}function ah(t){return eg(t,VS)}function HS(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function tg(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function Sc(t){return tg(t)&&"method"in t}function Rs(t){return tg(t)&&(Rt(t)||pt(t))}function Rt(t){return"result"in t}function pt(t){return"error"in t}let Oc=class extends qS{constructor(e){super(e),this.events=new ot.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(It(e.method,e.params||[],e.id||xr().toString()),r)}async requestStrict(e,r){return new Promise(async(i,n)=>{if(!this.connection.connected)try{await this.open()}catch(s){n(s)}this.events.on(`${e.id}`,s=>{pt(s)?n(s.error):i(s.result)});try{await this.connection.send(e,r)}catch(s){n(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Rs(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const WS=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),GS=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",ch=t=>t.split("?")[0],lh=10,YS=WS();let ZS=class{constructor(e){if(this.url=e,this.events=new ot.EventEmitter,this.registering=!1,!ah(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Wr(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!ah(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,n)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),n(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return n(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const n=kS.isReactNative()?void 0:{rejectUnauthorized:!HS(e)},s=new YS(e,[],n);GS()?s.onerror=o=>{const a=o;i(this.emitError(a.error))}:s.on("error",o=>{i(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),r(s)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Hr(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),n=i.message||i.toString(),s=Ts(e,n);this.events.emit("payload",s)}parseError(e,r=this.url){return Xp(e,ch(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>lh&&this.events.setMaxListeners(lh)}emitError(e){const r=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${ch(this.url)}`));return this.events.emit("register_error",r),r}};var JS={};const rg="wc",ig=2,Pa="core",Mt=`${rg}@2:${Pa}:`,XS={logger:"error"},QS={database:":memory:"},e8="crypto",uh="client_ed25519_seed",t8=M.ONE_DAY,r8="keychain",i8="0.3",n8="messages",s8="0.3",o8=M.SIX_HOURS,a8="publisher",ng="irn",c8="error",sg="wss://relay.walletconnect.org",l8="relayer",he={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},u8="_subscription",lt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},h8=.1,Ca="2.23.6",ae={link_mode:"link_mode",relay:"relay"},Hn={inbound:"inbound",outbound:"outbound"},f8="0.3",d8="WALLETCONNECT_CLIENT_ID",hh="WALLETCONNECT_LINK_MODE_APPS",rt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},p8="subscription",g8="0.3",y8="pairing",w8="0.3",Ti={wc_pairingDelete:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:M.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:M.ONE_DAY,prompt:!1,tag:0},res:{ttl:M.ONE_DAY,prompt:!1,tag:0}}},Lr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},bt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},m8="history",b8="0.3",v8="expirer",ht={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},E8="0.3",x8="verify-api",_8="https://verify.walletconnect.com",og="https://verify.walletconnect.org",Hi=og,I8=`${Hi}/v3`,S8=[_8,og],O8="echo",$8="https://echo.walletconnect.com",Bt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Zt={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},vt={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success",session_request_response_started:"session_request_response_started",session_request_response_validation_success:"session_request_response_validation_success",session_request_response_publish_started:"session_request_response_publish_started"},Tr={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found",session_request_response_validation_failure:"session_request_response_validation_failure",session_request_response_publish_failure:"session_request_response_publish_failure"},Rr={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},Ri={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},D8=.1,A8="event-client",P8=86400,C8="https://pulse.walletconnect.org/batch";function B8(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=n}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var y=0,m=0,x=0,O=d.length;x!==O&&d[x]===0;)x++,y++;for(var v=(O-x)*u+1>>>0,b=new Uint8Array(v);x!==O;){for(var E=d[x],_=0,C=v-1;(E!==0||_<m)&&C!==-1;C--,_++)E+=256*b[C]>>>0,b[C]=E%a>>>0,E=E/a>>>0;if(E!==0)throw new Error("Non-zero carry");m=_,x++}for(var B=v-m;B!==v&&b[B]===0;)B++;for(var A=c.repeat(y);B<v;++B)A+=t.charAt(b[B]);return A}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var y=0;if(d[y]!==" "){for(var m=0,x=0;d[y]===c;)m++,y++;for(var O=(d.length-y)*l+1>>>0,v=new Uint8Array(O);d[y];){var b=r[d.charCodeAt(y)];if(b===255)return;for(var E=0,_=O-1;(b!==0||E<x)&&_!==-1;_--,E++)b+=a*v[_]>>>0,v[_]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");x=E,y++}if(d[y]!==" "){for(var C=O-x;C!==O&&v[C]===0;)C++;for(var B=new Uint8Array(m+(O-C)),A=m;C!==O;)B[A++]=v[C++];return B}}}function p(d){var y=f(d);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var T8=B8,R8=T8;const ag=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},N8=t=>new TextEncoder().encode(t),U8=t=>new TextDecoder().decode(t);class j8{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class k8{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return cg(this,e)}}class L8{constructor(e){this.decoders=e}or(e){return cg(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const cg=(t,e)=>new L8({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class F8{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new j8(e,r,i),this.decoder=new k8(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Ns=({name:t,prefix:e,encode:r,decode:i})=>new F8(t,e,r,i),yn=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=R8(r,e);return Ns({prefix:t,name:e,encode:i,decode:s=>ag(n(s))})},M8=(t,e,r,i)=>{const n={};for(let u=0;u<e.length;++u)n[e[u]]=u;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,l=0;for(let u=0;u<s;++u){const h=n[t[u]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},q8=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[n&a>>o];if(o&&(s+=e[n&a<<r-o]),i)for(;s.length*r&7;)s+="=";return s},Be=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Ns({prefix:e,name:t,encode(n){return q8(n,i,r)},decode(n){return M8(n,i,r,t)}}),z8=Ns({prefix:"\0",name:"identity",encode:t=>U8(t),decode:t=>N8(t)});var V8=Object.freeze({__proto__:null,identity:z8});const K8=Be({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var H8=Object.freeze({__proto__:null,base2:K8});const W8=Be({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var G8=Object.freeze({__proto__:null,base8:W8});const Y8=yn({prefix:"9",name:"base10",alphabet:"0123456789"});var Z8=Object.freeze({__proto__:null,base10:Y8});const J8=Be({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),X8=Be({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Q8=Object.freeze({__proto__:null,base16:J8,base16upper:X8});const eO=Be({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),tO=Be({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),rO=Be({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),iO=Be({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),nO=Be({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),sO=Be({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),oO=Be({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),aO=Be({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),cO=Be({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var lO=Object.freeze({__proto__:null,base32:eO,base32upper:tO,base32pad:rO,base32padupper:iO,base32hex:nO,base32hexupper:sO,base32hexpad:oO,base32hexpadupper:aO,base32z:cO});const uO=yn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),hO=yn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var fO=Object.freeze({__proto__:null,base36:uO,base36upper:hO});const dO=yn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),pO=yn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var gO=Object.freeze({__proto__:null,base58btc:dO,base58flickr:pO});const yO=Be({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),wO=Be({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),mO=Be({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),bO=Be({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var vO=Object.freeze({__proto__:null,base64:yO,base64pad:wO,base64url:mO,base64urlpad:bO});const lg=Array.from(""),EO=lg.reduce((t,e,r)=>(t[r]=e,t),[]),xO=lg.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function _O(t){return t.reduce((e,r)=>(e+=EO[r],e),"")}function IO(t){const e=[];for(const r of t){const i=xO[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const SO=Ns({prefix:"",name:"base256emoji",encode:_O,decode:IO});var OO=Object.freeze({__proto__:null,base256emoji:SO}),$O=ug,fh=128,DO=-128,AO=Math.pow(2,31);function ug(t,e,r){e=e||[],r=r||0;for(var i=r;t>=AO;)e[r++]=t&255|fh,t/=128;for(;t&DO;)e[r++]=t&255|fh,t>>>=7;return e[r]=t|0,ug.bytes=r-i+1,e}var PO=Ba,CO=128,dh=127;function Ba(t,i){var r=0,i=i||0,n=0,s=i,o,a=t.length;do{if(s>=a)throw Ba.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=n<28?(o&dh)<<n:(o&dh)*Math.pow(2,n),n+=7}while(o>=CO);return Ba.bytes=s-i,r}var BO=Math.pow(2,7),TO=Math.pow(2,14),RO=Math.pow(2,21),NO=Math.pow(2,28),UO=Math.pow(2,35),jO=Math.pow(2,42),kO=Math.pow(2,49),LO=Math.pow(2,56),FO=Math.pow(2,63),MO=function(t){return t<BO?1:t<TO?2:t<RO?3:t<NO?4:t<UO?5:t<jO?6:t<kO?7:t<LO?8:t<FO?9:10},qO={encode:$O,decode:PO,encodingLength:MO},hg=qO;const ph=(t,e,r=0)=>(hg.encode(t,e,r),e),gh=t=>hg.encodingLength(t),Ta=(t,e)=>{const r=e.byteLength,i=gh(t),n=i+gh(r),s=new Uint8Array(n+r);return ph(t,s,0),ph(r,s,i),s.set(e,n),new zO(t,r,e,s)};class zO{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const fg=({name:t,code:e,encode:r})=>new VO(t,e,r);class VO{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Ta(this.code,r):r.then(i=>Ta(this.code,i))}else throw Error("Unknown type, must be binary type")}}const dg=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),KO=fg({name:"sha2-256",code:18,encode:dg("SHA-256")}),HO=fg({name:"sha2-512",code:19,encode:dg("SHA-512")});var WO=Object.freeze({__proto__:null,sha256:KO,sha512:HO});const pg=0,GO="identity",gg=ag,YO=t=>Ta(pg,gg(t)),ZO={code:pg,name:GO,encode:gg,digest:YO};var JO=Object.freeze({__proto__:null,identity:ZO});new TextEncoder,new TextDecoder;const yh={...V8,...H8,...G8,...Z8,...Q8,...lO,...fO,...gO,...vO,...OO};({...WO,...JO});function yg(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function XO(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?yg(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function wg(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const wh=wg("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),To=wg("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=XO(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),QO={utf8:wh,"utf-8":wh,hex:yh.base16,latin1:To,ascii:To,binary:To,...yh};function e$(t,e="utf8"){const r=QO[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?yg(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}var t$=Object.defineProperty,r$=(t,e,r)=>e in t?t$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pt=(t,e,r)=>r$(t,typeof e!="symbol"?e+"":e,r);class i${constructor(e,r){this.core=e,this.logger=r,Pt(this,"keychain",new Map),Pt(this,"name",r8),Pt(this,"version",i8),Pt(this,"initialized",!1),Pt(this,"storagePrefix",Mt),Pt(this,"init",async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}}),Pt(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),Pt(this,"set",async(i,n)=>{this.isInitialized(),this.keychain.set(i,n),await this.persist()}),Pt(this,"get",i=>{this.isInitialized();const n=this.keychain.get(i);if(typeof n>"u"){const{message:s}=z("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(s)}return n}),Pt(this,"del",async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()}),this.core=e,this.logger=at(r,this.name)}get context(){return Xe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,fa(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?da(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var n$=Object.defineProperty,s$=(t,e,r)=>e in t?n$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ve=(t,e,r)=>s$(t,typeof e!="symbol"?e+"":e,r);class o${constructor(e,r,i){this.core=e,this.logger=r,ve(this,"name",e8),ve(this,"keychain"),ve(this,"randomSessionIdentifier",Ia()),ve(this,"initialized",!1),ve(this,"clientId"),ve(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),ve(this,"hasKeys",n=>(this.isInitialized(),this.keychain.has(n))),ve(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;const n=await this.getClientSeed(),s=Ll(n),o=Bd(s.publicKey);return this.clientId=o,o}),ve(this,"generateKeyPair",()=>{this.isInitialized();const n=H_();return this.setPrivateKey(n.publicKey,n.privateKey)}),ve(this,"signJWT",async n=>{this.isInitialized();const s=await this.getClientSeed(),o=Ll(s),a=this.randomSessionIdentifier;return await Y1(a,n,t8,o)}),ve(this,"generateSharedKey",(n,s,o)=>{this.isInitialized();const a=this.getPrivateKey(n),c=W_(a,s);return this.setSymKey(c,o)}),ve(this,"setSymKey",async(n,s)=>{this.isInitialized();const o=s||zn(n);return await this.keychain.set(o,n),o}),ve(this,"deleteKeyPair",async n=>{this.isInitialized(),await this.keychain.del(n)}),ve(this,"deleteSymKey",async n=>{this.isInitialized(),await this.keychain.del(n)}),ve(this,"encode",async(n,s,o)=>{this.isInitialized();const a=Kp(o),c=Wr(s);if(Uu(a))return Z_(c,o?.encoding);if(Nu(a)){const f=a.senderPublicKey,p=a.receiverPublicKey;n=await this.generateSharedKey(f,p)}const l=this.getSymKey(n),{type:u,senderPublicKey:h}=a;return G_({type:u,symKey:l,message:c,senderPublicKey:h,encoding:o?.encoding})}),ve(this,"decode",async(n,s,o)=>{this.isInitialized();const a=X_(s,o);if(Uu(a)){const c=J_(s,o?.encoding);return Hr(c)}if(Nu(a)){const c=a.receiverPublicKey,l=a.senderPublicKey;n=await this.generateSharedKey(c,l)}try{const c=this.getSymKey(n),l=Y_({symKey:c,encoded:s,encoding:o?.encoding});return Hr(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${n}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),ve(this,"getPayloadType",(n,s=Ge)=>{const o=en({encoded:n,encoding:s});return Yr(o.type)}),ve(this,"getPayloadSenderPublicKey",(n,s=Ge)=>{const o=en({encoded:n,encoding:s});return o.senderPublicKey?Je(o.senderPublicKey,Me):void 0}),this.core=e,this.logger=at(r,this.name),this.keychain=i||new i$(this.core,this.logger)}get context(){return Xe(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(uh)}catch{e=Ia(),await this.keychain.set(uh,e)}return e$(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var a$=Object.defineProperty,c$=Object.defineProperties,l$=Object.getOwnPropertyDescriptors,mh=Object.getOwnPropertySymbols,u$=Object.prototype.hasOwnProperty,h$=Object.prototype.propertyIsEnumerable,Ra=(t,e,r)=>e in t?a$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,f$=(t,e)=>{for(var r in e||(e={}))u$.call(e,r)&&Ra(t,r,e[r]);if(mh)for(var r of mh(e))h$.call(e,r)&&Ra(t,r,e[r]);return t},d$=(t,e)=>c$(t,l$(e)),Qe=(t,e,r)=>Ra(t,typeof e!="symbol"?e+"":e,r);class p$ extends GI{constructor(e,r){super(e,r),this.logger=e,this.core=r,Qe(this,"messages",new Map),Qe(this,"messagesWithoutClientAck",new Map),Qe(this,"name",n8),Qe(this,"version",s8),Qe(this,"initialized",!1),Qe(this,"storagePrefix",Mt),Qe(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i);const n=await this.getRelayerMessagesWithoutClientAck();typeof n<"u"&&(this.messagesWithoutClientAck=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}}),Qe(this,"set",async(i,n,s)=>{this.isInitialized();const o=dt(n);let a=this.messages.get(i);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=n,this.messages.set(i,a),s===Hn.inbound){const c=this.messagesWithoutClientAck.get(i)||{};this.messagesWithoutClientAck.set(i,d$(f$({},c),{[o]:n}))}return await this.persist(),o}),Qe(this,"get",i=>{this.isInitialized();let n=this.messages.get(i);return typeof n>"u"&&(n={}),n}),Qe(this,"getWithoutAck",i=>{this.isInitialized();const n={};for(const s of i){const o=this.messagesWithoutClientAck.get(s)||{};n[s]=Object.values(o)}return n}),Qe(this,"has",(i,n)=>{this.isInitialized();const s=this.get(i),o=dt(n);return typeof s[o]<"u"}),Qe(this,"ack",async(i,n)=>{this.isInitialized();const s=this.messagesWithoutClientAck.get(i);if(typeof s>"u")return;const o=dt(n);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(i):this.messagesWithoutClientAck.set(i,s),await this.persist()}),Qe(this,"del",async i=>{this.isInitialized(),this.messages.delete(i),this.messagesWithoutClientAck.delete(i),await this.persist()}),this.logger=at(e,this.name),this.core=r}get context(){return Xe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,fa(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,fa(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?da(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?da(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var g$=Object.defineProperty,y$=Object.defineProperties,w$=Object.getOwnPropertyDescriptors,bh=Object.getOwnPropertySymbols,m$=Object.prototype.hasOwnProperty,b$=Object.prototype.propertyIsEnumerable,Na=(t,e,r)=>e in t?g$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,si=(t,e)=>{for(var r in e||(e={}))m$.call(e,r)&&Na(t,r,e[r]);if(bh)for(var r of bh(e))b$.call(e,r)&&Na(t,r,e[r]);return t},vh=(t,e)=>y$(t,w$(e)),ut=(t,e,r)=>Na(t,typeof e!="symbol"?e+"":e,r);class v$ extends YI{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,ut(this,"events",new ot.EventEmitter),ut(this,"name",a8),ut(this,"queue",new Map),ut(this,"publishTimeout",M.toMiliseconds(M.ONE_MINUTE)),ut(this,"initialPublishTimeout",M.toMiliseconds(M.ONE_SECOND*15)),ut(this,"needsTransportRestart",!1),ut(this,"publish",async(i,n,s)=>{var o,a,c,l,u;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:s}});const h=s?.ttl||o8,f=s?.prompt||!1,p=s?.tag||0,d=s?.id||xr().toString(),y=ui(ls().protocol),m={id:d,method:s?.publishMethod||y.publish,params:si({topic:i,message:n,ttl:h,prompt:f,tag:p,attestation:s?.attestation},s?.tvf)},x=`Failed to publish payload, please try again. id:${d} tag:${p}`;try{Ie((o=m.params)==null?void 0:o.prompt)&&((a=m.params)==null||delete a.prompt),Ie((c=m.params)==null?void 0:c.tag)&&((l=m.params)==null||delete l.tag);const O=new Promise(async v=>{const b=({id:_})=>{var C;((C=m.id)==null?void 0:C.toString())===_.toString()&&(this.removeRequestFromQueue(_),this.relayer.events.removeListener(he.publish,b),v())};this.relayer.events.on(he.publish,b);const E=kt(new Promise((_,C)=>{this.rpcPublish(m,s).then(_).catch(B=>{this.logger.warn(B,B?.message),C(B)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${d} tag:${p}`);try{await E,this.events.removeListener(he.publish,b)}catch(_){this.queue.set(d,{request:m,opts:s,attempt:1}),this.logger.warn(_,_?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:d,topic:i,message:n,opts:s}}),await kt(O,this.publishTimeout,x)}catch(O){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(O),(u=s?.internal)!=null&&u.throwOnFailedPublish)throw O}finally{this.queue.delete(d)}}),ut(this,"publishCustom",async i=>{var n,s,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:i});const{payload:l,opts:u={}}=i,{attestation:h,tvf:f,publishMethod:p,prompt:d,tag:y,ttl:m=M.FIVE_MINUTES}=u,x=u.id||xr().toString(),O=ui(ls().protocol),v=p||O.publish,b={id:x,method:v,params:si(vh(si({},l),{ttl:m,prompt:d,tag:y,attestation:h}),f)},E=`Failed to publish custom payload, please try again. id:${x} tag:${y}`;try{Ie((n=b.params)==null?void 0:n.prompt)&&((s=b.params)==null||delete s.prompt),Ie((o=b.params)==null?void 0:o.tag)&&((a=b.params)==null||delete a.tag);const _=new Promise(async C=>{const B=({id:N})=>{var j;((j=b.id)==null?void 0:j.toString())===N.toString()&&(this.removeRequestFromQueue(N),this.relayer.events.removeListener(he.publish,B),C())};this.relayer.events.on(he.publish,B);const A=kt(new Promise((N,j)=>{this.rpcPublish(b,u).then(N).catch(R=>{this.logger.warn(R,R?.message),j(R)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${v} id:${x} tag:${y}`);try{await A,this.events.removeListener(he.publish,B)}catch(N){this.queue.set(x,{request:b,opts:u,attempt:1}),this.logger.warn(N,N?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:x,payload:l,opts:u}}),await kt(_,this.publishTimeout,E)}catch(_){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(_),(c=u?.internal)!=null&&c.throwOnFailedPublish)throw _}finally{this.queue.delete(x)}}),ut(this,"on",(i,n)=>{this.events.on(i,n)}),ut(this,"once",(i,n)=>{this.events.once(i,n)}),ut(this,"off",(i,n)=>{this.events.off(i,n)}),ut(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),this.relayer=e,this.logger=at(r,this.name),this.registerEventListeners()}get context(){return Xe(this.logger)}async rpcPublish(e,r){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const i=await this.relayer.request(e);return this.relayer.events.emit(he.publish,si(si({},e),r)),this.logger.debug("Successfully Published Payload"),i}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{var i;const n=e.attempt+1;this.queue.set(r,vh(si({},e),{attempt:n})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(i=e.request.params)==null?void 0:i.tag}, attempt: ${n}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Qr.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(he.connection_stalled);return}this.checkQueue()}),this.relayer.on(he.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var E$=Object.defineProperty,x$=(t,e,r)=>e in t?E$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,oi=(t,e,r)=>x$(t,typeof e!="symbol"?e+"":e,r);class _${constructor(){oi(this,"map",new Map),oi(this,"set",(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])}),oi(this,"get",e=>this.map.get(e)||[]),oi(this,"exists",(e,r)=>this.get(e).includes(r)),oi(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const n=i.filter(s=>s!==r);if(!n.length){this.map.delete(e);return}this.map.set(e,n)}),oi(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var I$=Object.defineProperty,S$=Object.defineProperties,O$=Object.getOwnPropertyDescriptors,Eh=Object.getOwnPropertySymbols,$$=Object.prototype.hasOwnProperty,D$=Object.prototype.propertyIsEnumerable,Ua=(t,e,r)=>e in t?I$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ni=(t,e)=>{for(var r in e||(e={}))$$.call(e,r)&&Ua(t,r,e[r]);if(Eh)for(var r of Eh(e))D$.call(e,r)&&Ua(t,r,e[r]);return t},Ro=(t,e)=>S$(t,O$(e)),se=(t,e,r)=>Ua(t,typeof e!="symbol"?e+"":e,r);class A$ extends XI{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,se(this,"subscriptions",new Map),se(this,"topicMap",new _$),se(this,"events",new ot.EventEmitter),se(this,"name",p8),se(this,"version",g8),se(this,"pending",new Map),se(this,"cached",[]),se(this,"initialized",!1),se(this,"storagePrefix",Mt),se(this,"subscribeTimeout",M.toMiliseconds(M.ONE_MINUTE)),se(this,"initialSubscribeTimeout",M.toMiliseconds(M.ONE_SECOND*15)),se(this,"clientId"),se(this,"batchSubscribeTopicsLimit",500),se(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),se(this,"subscribe",async(i,n)=>{var s;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}});try{const o=ls(n),a={topic:i,relay:o,transportType:n?.transportType};(s=n?.internal)!=null&&s.skipSubscribe||this.pending.set(i,a);const c=await this.rpcSubscribe(i,o,n);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),se(this,"unsubscribe",async(i,n)=>{this.isInitialized(),typeof n?.id<"u"?await this.unsubscribeById(i,n.id,n):await this.unsubscribeByTopic(i,n)}),se(this,"isSubscribed",i=>new Promise(n=>{n(this.topicMap.topics.includes(i))})),se(this,"isKnownTopic",i=>new Promise(n=>{n(this.topicMap.topics.includes(i)||this.pending.has(i)||this.cached.some(s=>s.topic===i))})),se(this,"on",(i,n)=>{this.events.on(i,n)}),se(this,"once",(i,n)=>{this.events.once(i,n)}),se(this,"off",(i,n)=>{this.events.off(i,n)}),se(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),se(this,"start",async()=>{await this.onConnect()}),se(this,"stop",async()=>{await this.onDisconnect()}),se(this,"restart",async()=>{await this.restore(),await this.onRestart()}),se(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const i=[];this.pending.forEach(n=>{i.push(n)}),await this.batchSubscribe(i)}),se(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Qr.pulse,async()=>{await this.checkPending()}),this.events.on(rt.created,async i=>{const n=rt.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:i}),await this.persist()}),this.events.on(rt.deleted,async i=>{const n=rt.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:i}),await this.persist()})}),this.relayer=e,this.logger=at(r,this.name),this.clientId=""}get context(){return Xe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async n=>await this.unsubscribeById(e,n,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const n=ls(i);await this.restartToComplete({topic:e,id:r,relay:n}),await this.rpcUnsubscribe(e,r,n);const s=ce("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(e,r,i){var n,s;const o=await this.getSubscriptionId(e);if((n=i?.internal)!=null&&n.skipSubscribe)return o;(!i||i?.transportType===ae.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const a={method:ui(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(s=i?.internal)==null?void 0:s.throwOnFailedPublish;try{if(i?.transportType===ae.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(h=>this.logger.warn(h))},M.toMiliseconds(M.ONE_SECOND)),o;const l=new Promise(async h=>{const f=p=>{p.topic===e&&(this.events.removeListener(rt.created,f),h(p.id))};this.events.on(rt.created,f);try{const p=await kt(new Promise((d,y)=>{this.relayer.request(a).catch(m=>{this.logger.warn(m,m?.message),y(m)}).then(d)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(rt.created,f),h(p)}catch{}}),u=await kt(l,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return u?o:null}catch(l){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(he.connection_stalled),c)throw l}return null}async rpcBatchSubscribe(e){if(!e.length)return!0;const r=e[0].relay,i={method:ui(r.protocol).batchSubscribe,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{return await kt(new Promise((n,s)=>{this.relayer.request(i).then(n).catch(o=>{this.logger.warn(o),s(o)})}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again"),!0}catch{return this.relayer.events.emit(he.connection_stalled),!1}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,i={method:ui(r.protocol).batchFetchMessages,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let n;try{n=await await kt(new Promise((s,o)=>{this.relayer.request(i).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(he.connection_stalled)}return n}rpcUnsubscribe(e,r,i){const n={method:ui(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.request(n)}onSubscribe(e,r){this.setSubscription(e,Ro(Ni({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,Ni({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,Ni({},r)),this.topicMap.set(r.topic,e),this.events.emit(rt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(rt.deleted,Ro(Ni({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(rt.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<r;i++){const n=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(rt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(r=>{var i;return r.topic===((i=this.subscriptions.get(r.id))==null?void 0:i.topic)})){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(e.length){if(!await this.rpcBatchSubscribe(e)){this.logger.warn(`Batch subscribe failed for ${e.length} topics, adding to pending for retry`),e.forEach(r=>{this.pending.set(r.topic,r)});return}this.onBatchSubscribe(await Promise.all(e.map(async r=>Ro(Ni({},r),{id:await this.getSubscriptionId(r.topic)}))))}}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await f2(M.toMiliseconds(M.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return dt(e+await this.getClientId())}}var P$=Object.defineProperty,xh=Object.getOwnPropertySymbols,C$=Object.prototype.hasOwnProperty,B$=Object.prototype.propertyIsEnumerable,ja=(t,e,r)=>e in t?P$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_h=(t,e)=>{for(var r in e||(e={}))C$.call(e,r)&&ja(t,r,e[r]);if(xh)for(var r of xh(e))B$.call(e,r)&&ja(t,r,e[r]);return t},X=(t,e,r)=>ja(t,typeof e!="symbol"?e+"":e,r);class T$ extends ZI{constructor(e){var r;super(e),X(this,"protocol","wc"),X(this,"version",2),X(this,"core"),X(this,"logger"),X(this,"events",new ot.EventEmitter),X(this,"provider"),X(this,"messages"),X(this,"subscriber"),X(this,"publisher"),X(this,"name",l8),X(this,"transportExplicitlyClosed",!1),X(this,"initialized",!1),X(this,"connectionAttemptInProgress",!1),X(this,"relayUrl"),X(this,"projectId"),X(this,"packageName"),X(this,"bundleId"),X(this,"hasExperiencedNetworkDisruption",!1),X(this,"pingTimeout"),X(this,"heartBeatTimeout",M.toMiliseconds(M.THIRTY_SECONDS+M.FIVE_SECONDS)),X(this,"reconnectTimeout"),X(this,"connectPromise"),X(this,"reconnectInProgress",!1),X(this,"requestsInFlight",[]),X(this,"connectTimeout",M.toMiliseconds(M.ONE_SECOND*15)),X(this,"stalledRestartInProgress",!1),X(this,"stalledRestartTimeout"),X(this,"stalledRestartBackoff",0),X(this,"stalledRestartBaseInterval",M.toMiliseconds(M.ONE_SECOND*2)),X(this,"stalledRestartMaxInterval",M.toMiliseconds(M.THIRTY_SECONDS)),X(this,"request",async i=>{var n,s;this.logger.debug("Publishing Request Payload");const o=i.id||xr().toString();await this.toEstablishConnection();try{this.logger.trace({id:o,method:i.method,topic:(n=i.params)==null?void 0:n.topic},"relayer.request - publishing...");const a=`${o}:${((s=i.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(a);const c=await this.provider.request(i);return this.requestsInFlight=this.requestsInFlight.filter(l=>l!==a),c}catch(a){throw this.logger.debug(`Failed to Publish Request: ${o}`),a}}),X(this,"resetPingTimeout",()=>{is()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var i,n,s,o;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(o=(s=(n=(i=this.provider)==null?void 0:i.connection)==null?void 0:n.socket)==null?void 0:s.terminate)==null||o.call(s)}catch(a){this.logger.warn(a,a?.message)}},this.heartBeatTimeout))}),X(this,"onPayloadHandler",i=>{this.onProviderPayload(i),this.resetPingTimeout()}),X(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(he.connect)}),X(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),X(this,"onProviderErrorHandler",i=>{this.logger.fatal(`Fatal socket error: ${i.message}`),this.events.emit(he.error,i),this.logger.fatal("Fatal socket error received, closing transport"),this.transportExplicitlyClosed=!0,clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0,this.reconnectInProgress=!1,this.transportClose().catch(n=>this.logger.warn(n))}),X(this,"registerProviderListeners",()=>{this.provider.on(lt.payload,this.onPayloadHandler),this.provider.on(lt.connect,this.onConnectHandler),this.provider.on(lt.disconnect,this.onDisconnectHandler),this.provider.on(lt.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=_c({logger:(r=e.logger)!=null?r:c8,name:this.name}),this.messages=new p$(this.logger,e.core),this.subscriber=new A$(this,this.logger),this.publisher=new v$(this,this.logger),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||sg,ZE()?this.packageName=iu():JE()&&(this.bundleId=iu()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))}get context(){return Xe(this.logger)}get connected(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===1||!1}get connecting(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:ae.relay},Hn.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,r){var i,n,s;this.isInitialized(),(!(r!=null&&r.transportType)||r?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((i=r?.internal)==null?void 0:i.throwOnFailedPublish)>"u"?!0:(n=r?.internal)==null?void 0:n.throwOnFailedPublish;let a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"",c;const l=u=>{u.topic===e&&(this.subscriber.off(rt.created,l),c())};return await Promise.all([new Promise(u=>{c=u,this.subscriber.on(rt.created,l)}),new Promise(async(u,h)=>{a=await this.subscriber.subscribe(e,_h({internal:{throwOnFailedPublish:o}},r)).catch(f=>{o&&h(f)})||a,u()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await kt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,clearTimeout(this.stalledRestartTimeout),this.stalledRestartInProgress=!1,this.stalledRestartBackoff=0,await this.resetTransport()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,i)=>{await this.connect(e).then(r).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.resetTransport(),await this.transportOpen())}async resetTransport(){this.reconnectInProgress=!0,clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0,await this.transportDisconnect(),await this.subscriber.stop(),this.reconnectInProgress=!1}async confirmOnlineStateOrThrow(){if(!await Yu())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((i,n)=>i.publishedAt-n.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const i of r)try{await this.onMessageEvent(i)}catch(n){this.logger.warn(n,"Error while processing batch message event: "+n?.message)}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:i}=e;if(!r.sessionExists){const n=pe(M.FIVE_MINUTES),s={topic:i,expiry:n,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,s)}this.events.emit(he.message,e),await this.recordMessageEvent(e,Hn.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(i,n)=>{const s=()=>{n(new Error("Connection interrupted while trying to connect"))};this.provider.once(lt.disconnect,s),await kt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{n(o)}).finally(()=>{this.provider.off(lt.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{n(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(lt.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(lt.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){await this.subscriber.stop();const n=i;this.logger.warn({},n.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(i=>setTimeout(i,M.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,i,n,s;if(is())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((s=(n=(i=this.provider)==null?void 0:i.connection)==null?void 0:n.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Oc(new ZS(r2({sdkVersion:Ca,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:i,message:n}=e;await this.messages.set(i,n,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;if(!i||i.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const n=this.messages.has(r,i);return n&&this.logger.warn(`Ignoring duplicate message: ${i}`),n}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Sc(e)){if(!e.method.endsWith(u8))return;const r=e.params,{topic:i,message:n,publishedAt:s,attestation:o}=r.data,a={topic:i,message:n,publishedAt:s,transportType:ae.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(_h({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Rs(e)&&this.events.emit(he.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Hn.inbound),this.events.emit(he.message,e))}async acknowledgePayload(e){const r=rn(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(lt.payload,this.onPayloadHandler),this.provider.off(lt.connect,this.onConnectHandler),this.provider.off(lt.disconnect,this.onDisconnectHandler),this.provider.off(lt.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Yu();X3(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(i=>this.logger.error(i,i?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Qr.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&tI())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r?.message)}}),this.events.on(he.connection_stalled,()=>{if(this.transportExplicitlyClosed||this.stalledRestartInProgress)return;this.stalledRestartInProgress=!0;const r=this.stalledRestartBackoff===0?0:Math.min(Math.pow(2,this.stalledRestartBackoff-1)*this.stalledRestartBaseInterval,this.stalledRestartMaxInterval);this.stalledRestartBackoff++,this.logger.warn(`Connection stalled, restarting transport${r?` in ${r}ms`:""}...`),this.stalledRestartTimeout=setTimeout(async()=>{try{if(this.transportExplicitlyClosed)return;await this.restartTransport()}catch(i){this.logger.error(i,i?.message)}finally{this.stalledRestartInProgress=!1}},r)})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(he.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},M.toMiliseconds(h8)))))}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function R$(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function Ih(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Sh(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const N$="[object RegExp]",U$="[object String]",j$="[object Number]",k$="[object Boolean]",Oh="[object Arguments]",L$="[object Symbol]",F$="[object Date]",M$="[object Map]",q$="[object Set]",z$="[object Array]",V$="[object Function]",K$="[object ArrayBuffer]",No="[object Object]",H$="[object Error]",W$="[object DataView]",G$="[object Uint8Array]",Y$="[object Uint8ClampedArray]",Z$="[object Uint16Array]",J$="[object Uint32Array]",X$="[object BigUint64Array]",Q$="[object Int8Array]",eD="[object Int16Array]",tD="[object Int32Array]",rD="[object BigInt64Array]",iD="[object Float32Array]",nD="[object Float64Array]";function $h(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function sD(t,e,r){return Mi(t,e,void 0,void 0,void 0,void 0,r)}function Mi(t,e,r,i,n,s,o){const a=o(t,e,r,i,n,s);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Wi(t,e,s,o)}return Wi(t,e,s,o)}function Wi(t,e,r,i){if(Object.is(t,e))return!0;let n=Sh(t),s=Sh(e);if(n===Oh&&(n=No),s===Oh&&(s=No),n!==s)return!1;switch(n){case U$:return t.toString()===e.toString();case j$:{const c=t.valueOf(),l=e.valueOf();return R$(c,l)}case k$:case F$:case L$:return Object.is(t.valueOf(),e.valueOf());case N$:return t.source===e.source&&t.flags===e.flags;case V$:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(n){case M$:{if(t.size!==e.size)return!1;for(const[c,l]of t.entries())if(!e.has(c)||!Mi(l,e.get(c),c,t,e,r,i))return!1;return!0}case q$:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),l=Array.from(e.values());for(let u=0;u<c.length;u++){const h=c[u],f=l.findIndex(p=>Mi(h,p,void 0,t,e,r,i));if(f===-1)return!1;l.splice(f,1)}return!0}case z$:case G$:case Y$:case Z$:case J$:case X$:case Q$:case eD:case tD:case rD:case iD:case nD:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Mi(t[c],e[c],c,t,e,r,i))return!1;return!0}case K$:return t.byteLength!==e.byteLength?!1:Wi(new Uint8Array(t),new Uint8Array(e),r,i);case W$:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Wi(new Uint8Array(t),new Uint8Array(e),r,i);case H$:return t.name===e.name&&t.message===e.message;case No:{if(!(Wi(t.constructor,e.constructor,r,i)||$h(t)&&$h(e)))return!1;const c=[...Object.keys(t),...Ih(t)],l=[...Object.keys(e),...Ih(e)];if(c.length!==l.length)return!1;for(let u=0;u<c.length;u++){const h=c[u],f=t[h];if(!Object.hasOwn(e,h))return!1;const p=e[h];if(!Mi(f,p,h,t,e,r,i))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function oD(){}function aD(t,e){return sD(t,e,oD)}var cD=Object.defineProperty,Dh=Object.getOwnPropertySymbols,lD=Object.prototype.hasOwnProperty,uD=Object.prototype.propertyIsEnumerable,ka=(t,e,r)=>e in t?cD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ah=(t,e)=>{for(var r in e||(e={}))lD.call(e,r)&&ka(t,r,e[r]);if(Dh)for(var r of Dh(e))uD.call(e,r)&&ka(t,r,e[r]);return t},ze=(t,e,r)=>ka(t,typeof e!="symbol"?e+"":e,r);class ei extends JI{constructor(e,r,i,n=Mt,s=void 0){super(e,r,i,n),this.core=e,this.logger=r,this.name=i,ze(this,"map",new Map),ze(this,"version",f8),ze(this,"cached",[]),ze(this,"initialized",!1),ze(this,"getKey"),ze(this,"storagePrefix",Mt),ze(this,"recentlyDeleted",[]),ze(this,"recentlyDeletedLimit",200),ze(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Ie(o)?this.map.set(this.getKey(o),o):A3(o)?this.map.set(o.id,o):P3(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),ze(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),ze(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),ze(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>aD(a[c],o[c]))):this.values)),ze(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=Ah(Ah({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),ze(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=at(r,this.name),this.storagePrefix=n,this.getKey=s}get context(){return Xe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:n}=z("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var hD=Object.defineProperty,fD=(t,e,r)=>e in t?hD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Q=(t,e,r)=>fD(t,typeof e!="symbol"?e+"":e,r);class dD{constructor(e,r){this.core=e,this.logger=r,Q(this,"name",y8),Q(this,"version",w8),Q(this,"events",new Wa),Q(this,"pairings"),Q(this,"initialized",!1),Q(this,"storagePrefix",Mt),Q(this,"ignoredPayloadTypes",[nr]),Q(this,"registeredMethods",[]),Q(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),Q(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),Q(this,"create",async i=>{this.isInitialized();const n=Ia(),s=await this.core.crypto.setSymKey(n),o=pe(M.FIVE_MINUTES),a={protocol:ng},c={topic:s,expiry:o,relay:a,active:!1,methods:i?.methods},l=Fu({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:n,relay:a,expiryTimestamp:o,methods:i?.methods});return this.events.emit(Lr.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:i?.transportType,internal:i?.internal}),{topic:s,uri:l}}),Q(this,"pair",async i=>{this.isInitialized();const n=this.core.eventClient.createEvent({properties:{topic:i?.uri,trace:[Bt.pairing_started]}});this.isValidPair(i,n);const{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:l}=Lu(i.uri);n.props.properties.topic=s,n.addTrace(Bt.pairing_uri_validation_success),n.addTrace(Bt.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(s)){if(u=this.pairings.get(s),n.addTrace(Bt.existing_pairing),u.active)throw n.setError(Zt.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);n.addTrace(Bt.pairing_not_expired)}const h=c||pe(M.FIVE_MINUTES),f={topic:s,relay:a,expiry:h,active:!1,methods:l};this.core.expirer.set(s,h),await this.pairings.set(s,f),n.addTrace(Bt.store_new_pairing),i.activatePairing&&await this.activate({topic:s}),this.events.emit(Lr.create,f),n.addTrace(Bt.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),n.addTrace(Bt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{n.setError(Zt.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(p){throw n.setError(Zt.subscribe_pairing_topic_failure),p}return n.addTrace(Bt.subscribe_pairing_topic_success),f}),Q(this,"activate",async({topic:i})=>{this.isInitialized();const n=pe(M.FIVE_MINUTES);this.core.expirer.set(i,n),await this.pairings.update(i,{active:!0,expiry:n})}),Q(this,"ping",async i=>{this.isInitialized(),await this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:n}=i;if(this.pairings.keys.includes(n)){const s=await this.sendRequest(n,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Ur();this.events.once(ie("pairing_ping",s),({error:l})=>{l?c(l):a()}),await o()}}),Q(this,"updateExpiry",async({topic:i,expiry:n})=>{this.isInitialized(),await this.pairings.update(i,{expiry:n})}),Q(this,"updateMetadata",async({topic:i,metadata:n})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:n})}),Q(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),Q(this,"disconnect",async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;this.pairings.keys.includes(n)&&(await this.sendRequest(n,"wc_pairingDelete",ce("USER_DISCONNECTED")),await this.deletePairing(n))}),Q(this,"formatUriFromPairing",i=>{this.isInitialized();const{topic:n,relay:s,expiry:o,methods:a}=i,c=this.core.crypto.keychain.get(n);return Fu({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),Q(this,"sendRequest",async(i,n,s)=>{const o=It(n,s),a=await this.core.crypto.encode(i,o),c=Ti[n].req;return this.core.history.set(i,o),this.core.relayer.publish(i,a,c),o.id}),Q(this,"sendResult",async(i,n,s)=>{const o=rn(i,s),a=await this.core.crypto.encode(n,o),c=(await this.core.history.get(n,i)).request.method,l=Ti[c].res;await this.core.relayer.publish(n,a,l),await this.core.history.resolve(o)}),Q(this,"sendError",async(i,n,s)=>{const o=Ts(i,s),a=await this.core.crypto.encode(n,o),c=(await this.core.history.get(n,i)).request.method,l=Ti[c]?Ti[c].res:Ti.unregistered_method.res;await this.core.relayer.publish(n,a,l),await this.core.history.resolve(o)}),Q(this,"deletePairing",async(i,n)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,ce("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),n?Promise.resolve():this.core.expirer.del(i)])}),Q(this,"cleanup",async()=>{const i=this.pairings.getAll().filter(n=>Ut(n.expiry));await Promise.all(i.map(n=>this.deletePairing(n.topic)))}),Q(this,"onRelayEventRequest",async i=>{const{topic:n,payload:s}=i;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(n,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(n,s);default:return await this.onUnknownRpcMethodRequest(n,s)}}),Q(this,"onRelayEventResponse",async i=>{const{topic:n,payload:s}=i,o=(await this.core.history.get(n,s.id)).request.method;return o==="wc_pairingPing"?this.onPairingPingResponse(n,s):this.onUnknownRpcMethodResponse(o)}),Q(this,"onPairingPingRequest",async(i,n)=>{const{id:s}=n;try{this.isValidPing({topic:i}),await this.sendResult(s,i,!0),this.events.emit(Lr.ping,{id:s,topic:i})}catch(o){await this.sendError(s,i,o),this.logger.error(o)}}),Q(this,"onPairingPingResponse",(i,n)=>{const{id:s}=n;setTimeout(()=>{Rt(n)?this.events.emit(ie("pairing_ping",s),{}):pt(n)&&this.events.emit(ie("pairing_ping",s),{error:n.error})},500)}),Q(this,"onPairingDeleteRequest",async(i,n)=>{const{id:s}=n;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(Lr.delete,{id:s,topic:i})}catch(o){await this.sendError(s,i,o),this.logger.error(o)}}),Q(this,"onUnknownRpcMethodRequest",async(i,n)=>{const{id:s,method:o}=n;try{if(this.registeredMethods.includes(o))return;const a=ce("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,i,a),this.logger.error(a)}catch(a){await this.sendError(s,i,a),this.logger.error(a)}}),Q(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(ce("WC_METHOD_UNSUPPORTED",i))}),Q(this,"isValidPair",(i,n)=>{var s;if(!Ke(i)){const{message:a}=z("MISSING_OR_INVALID",`pair() params: ${i}`);throw n.setError(Zt.malformed_pairing_uri),new Error(a)}if(!D3(i.uri)){const{message:a}=z("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw n.setError(Zt.malformed_pairing_uri),new Error(a)}const o=Lu(i?.uri);if(!((s=o?.relay)!=null&&s.protocol)){const{message:a}=z("MISSING_OR_INVALID","pair() uri#relay-protocol");throw n.setError(Zt.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=z("MISSING_OR_INVALID","pair() uri#symKey");throw n.setError(Zt.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&M.toMiliseconds(o?.expiryTimestamp)<Date.now()){n.setError(Zt.pairing_expired);const{message:a}=z("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),Q(this,"isValidPing",async i=>{if(!Ke(i)){const{message:s}=z("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)}),Q(this,"isValidDisconnect",async i=>{if(!Ke(i)){const{message:s}=z("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)}),Q(this,"isValidPairingTopic",async i=>{if(!ge(i,!1)){const{message:n}=z("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(n)}if(!this.pairings.keys.includes(i)){const{message:n}=z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(n)}if(Ut(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:n}=z("EXPIRED",`pairing topic: ${i}`);throw new Error(n)}}),this.core=e,this.logger=at(r,this.name),this.pairings=new ei(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Xe(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(he.message,async e=>{const{topic:r,message:i,transportType:n}=e;if(this.pairings.keys.includes(r)&&n!==ae.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))try{const s=await this.core.crypto.decode(r,i);Sc(s)?(this.core.history.set(r,s),await this.onRelayEventRequest({topic:r,payload:s})):Rs(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.core.history.delete(r,s.id)),await this.core.relayer.messages.ack(r,i)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(ht.expired,async e=>{const{topic:r}=Wd(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Lr.expire,{topic:r}))})}}var pD=Object.defineProperty,gD=(t,e,r)=>e in t?pD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$e=(t,e,r)=>gD(t,typeof e!="symbol"?e+"":e,r);class yD extends WI{constructor(e,r){super(e,r),this.core=e,this.logger=r,$e(this,"records",new Map),$e(this,"events",new ot.EventEmitter),$e(this,"name",m8),$e(this,"version",b8),$e(this,"cached",[]),$e(this,"initialized",!1),$e(this,"storagePrefix",Mt),$e(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),$e(this,"set",(i,n,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:n,chainId:s}),this.records.has(n.id))return;const o={id:n.id,topic:i,request:{method:n.method,params:n.params||null},chainId:s,expiry:pe(M.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(bt.created,o)}),$e(this,"resolve",async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const n=await this.getRecord(i.id);typeof n.response>"u"&&(n.response=pt(i)?{error:i.error}:{result:i.result},this.records.set(n.id,n),this.persist(),this.events.emit(bt.updated,n))}),$e(this,"get",async(i,n)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:n}),await this.getRecord(n))),$e(this,"delete",(i,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(s=>{if(s.topic===i){if(typeof n<"u"&&s.id!==n)return;this.records.delete(s.id),this.events.emit(bt.deleted,s)}}),this.persist()}),$e(this,"exists",async(i,n)=>(this.isInitialized(),this.records.has(n)?(await this.getRecord(n)).topic===i:!1)),$e(this,"on",(i,n)=>{this.events.on(i,n)}),$e(this,"once",(i,n)=>{this.events.once(i,n)}),$e(this,"off",(i,n)=>{this.events.off(i,n)}),$e(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),this.logger=at(r,this.name)}get context(){return Xe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:It(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(bt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(bt.created,e=>{const r=bt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(bt.updated,e=>{const r=bt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(bt.deleted,e=>{const r=bt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(Qr.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{M.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(bt.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var wD=Object.defineProperty,mD=(t,e,r)=>e in t?wD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ue=(t,e,r)=>mD(t,typeof e!="symbol"?e+"":e,r);class bD extends QI{constructor(e,r){super(e,r),this.core=e,this.logger=r,Ue(this,"expirations",new Map),Ue(this,"events",new ot.EventEmitter),Ue(this,"name",v8),Ue(this,"version",E8),Ue(this,"cached",[]),Ue(this,"initialized",!1),Ue(this,"storagePrefix",Mt),Ue(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Ue(this,"has",i=>{try{const n=this.formatTarget(i);return typeof this.getExpiration(n)<"u"}catch{return!1}}),Ue(this,"set",(i,n)=>{this.isInitialized();const s=this.formatTarget(i),o={target:s,expiry:n};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(ht.created,{target:s,expiration:o})}),Ue(this,"get",i=>{this.isInitialized();const n=this.formatTarget(i);return this.getExpiration(n)}),Ue(this,"del",i=>{if(this.isInitialized(),this.has(i)){const n=this.formatTarget(i),s=this.getExpiration(n);this.expirations.delete(n),this.events.emit(ht.deleted,{target:n,expiration:s})}}),Ue(this,"on",(i,n)=>{this.events.on(i,n)}),Ue(this,"once",(i,n)=>{this.events.once(i,n)}),Ue(this,"off",(i,n)=>{this.events.off(i,n)}),Ue(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),this.logger=at(r,this.name)}get context(){return Xe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return i2(e);if(typeof e=="number")return n2(e);const{message:r}=z("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(ht.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;M.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(ht.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Qr.pulse,()=>this.checkExpirations()),this.events.on(ht.created,e=>{const r=ht.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ht.expired,e=>{const r=ht.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ht.deleted,e=>{const r=ht.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var vD=Object.defineProperty,ED=(t,e,r)=>e in t?vD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,de=(t,e,r)=>ED(t,typeof e!="symbol"?e+"":e,r);class xD extends eS{constructor(e,r,i){super(e,r,i),this.core=e,this.logger=r,this.store=i,de(this,"name",x8),de(this,"abortController"),de(this,"isDevEnv"),de(this,"verifyUrlV3",I8),de(this,"storagePrefix",Mt),de(this,"version",ig),de(this,"publicKey"),de(this,"fetchPromise"),de(this,"init",async()=>{var n;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&M.toMiliseconds((n=this.publicKey)==null?void 0:n.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),de(this,"register",async n=>{if(!xi()||this.isDevEnv)return;const s=window.location.origin,{id:o,decryptedId:a}=n,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{const l=sr.getDocument(),u=this.startAbortTimer(M.ONE_SECOND*5),h=await new Promise((f,p)=>{const d=()=>{window.removeEventListener("message",m),l.body.removeChild(y),p("attestation aborted")};this.abortController.signal.addEventListener("abort",d);const y=l.createElement("iframe");y.src=c,y.style.display="none",y.addEventListener("error",d,{signal:this.abortController.signal});const m=x=>{if(x.data&&typeof x.data=="string")try{const O=JSON.parse(x.data);if(O.type==="verify_attestation"){if(ca(O.attestation).payload.id!==o)return;clearInterval(u),l.body.removeChild(y),this.abortController.signal.removeEventListener("abort",d),window.removeEventListener("message",m),f(O.attestation===null?"":O.attestation)}}catch(O){this.logger.warn(O)}};l.body.appendChild(y),window.addEventListener("message",m,{signal:this.abortController.signal})});return this.logger.debug(h,"jwt attestation"),h}catch(l){this.logger.warn(l)}return""}),de(this,"resolve",async n=>{if(this.isDevEnv)return"";const{attestationId:s,hash:o,encryptedId:a}=n;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(ca(s).payload.id!==a)return;const l=await this.isValidJwtAttestation(s);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;const c=this.getVerifyUrl(n?.verifyUrl);return this.fetchAttestation(o,c)}),de(this,"fetchAttestation",async(n,s)=>{this.logger.debug(`resolving attestation: ${n} from url: ${s}`);const o=this.startAbortTimer(M.ONE_SECOND*5),a=await fetch(`${s}/attestation/${n}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),de(this,"getVerifyUrl",n=>{let s=n||Hi;return S8.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${Hi}`),s=Hi),s}),de(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const n=this.startAbortTimer(M.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(n),await s.json()}catch(n){this.logger.warn(n)}}),de(this,"persistPublicKey",async n=>{this.logger.debug(n,"persisting public key to local storage"),await this.store.setItem(this.storeKey,n),this.publicKey=n}),de(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),de(this,"isValidJwtAttestation",async n=>{const s=await this.getPublicKey();try{if(s)return this.validateAttestation(n,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(n,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),de(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),de(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});const n=await this.fetchPromise;return this.fetchPromise=void 0,n}),de(this,"validateAttestation",(n,s)=>{const o=e3(n,s.publicKey),a={hasExpired:M.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=at(r,this.name),this.abortController=new AbortController,this.isDevEnv=fc(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Xe(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),M.toMiliseconds(e))}}var _D=Object.defineProperty,ID=(t,e,r)=>e in t?_D(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ph=(t,e,r)=>ID(t,typeof e!="symbol"?e+"":e,r);class SD extends tS{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,Ph(this,"context",O8),Ph(this,"registerDeviceToken",async i=>{const{clientId:n,token:s,notificationType:o,enableEncrypted:a=!1}=i,c=`${$8}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:n,type:o,token:s,always_raw:a})})}),this.logger=at(r,this.context)}}var OD=Object.defineProperty,Ch=Object.getOwnPropertySymbols,$D=Object.prototype.hasOwnProperty,DD=Object.prototype.propertyIsEnumerable,La=(t,e,r)=>e in t?OD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ui=(t,e)=>{for(var r in e||(e={}))$D.call(e,r)&&La(t,r,e[r]);if(Ch)for(var r of Ch(e))DD.call(e,r)&&La(t,r,e[r]);return t},Ee=(t,e,r)=>La(t,typeof e!="symbol"?e+"":e,r);class AD extends rS{constructor(e,r,i=!0){super(e,r,i),this.core=e,this.logger=r,Ee(this,"context",A8),Ee(this,"storagePrefix",Mt),Ee(this,"storageVersion",D8),Ee(this,"events",new Map),Ee(this,"shouldPersist",!1),Ee(this,"init",async()=>{if(!fc())try{const n={eventId:su(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Kd(this.core.relayer.protocol,this.core.relayer.version,Ca)}}};await this.sendEvent([n])}catch(n){this.logger.warn(n)}}),Ee(this,"createEvent",n=>{const{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=n,l=su(),u=this.core.projectId||"",h=Date.now(),f=Ui({eventId:l,timestamp:h,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,f),this.shouldPersist=!0),f}),Ee(this,"getEvent",n=>{const{eventId:s,topic:o}=n;if(s)return this.events.get(s);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Ui(Ui({},a),this.setMethods(a.eventId))}),Ee(this,"deleteEvent",n=>{const{eventId:s}=n;this.events.delete(s),this.shouldPersist=!0}),Ee(this,"setEventListeners",()=>{this.core.heartbeat.on(Qr.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(n=>{M.fromMiliseconds(Date.now())-M.fromMiliseconds(n.timestamp)>P8&&(this.events.delete(n.eventId),this.shouldPersist=!0)})})}),Ee(this,"setMethods",n=>({addTrace:s=>this.addTrace(n,s),setError:s=>this.setError(n,s)})),Ee(this,"addTrace",(n,s)=>{const o=this.events.get(n);o&&(o.props.properties.trace.push(s),this.events.set(n,o),this.shouldPersist=!0)}),Ee(this,"setError",(n,s)=>{const o=this.events.get(n);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(n,o),this.shouldPersist=!0)}),Ee(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Ee(this,"restore",async()=>{try{const n=await this.core.storage.getItem(this.storageKey)||[];if(!n.length)return;n.forEach(s=>{this.events.set(s.eventId,Ui(Ui({},s),this.setMethods(s.eventId)))})}catch(n){this.logger.warn(n)}}),Ee(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const n=[];for(const[s,o]of this.events)o.props.type&&n.push(o);if(n.length!==0)try{if((await this.sendEvent(n)).ok)for(const s of n)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),Ee(this,"sendEvent",async n=>{const s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${C8}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Ca}${s}`,{method:"POST",body:JSON.stringify(n)})}),Ee(this,"getAppDomain",()=>Vd().url),this.logger=at(r,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var PD=Object.defineProperty,Bh=Object.getOwnPropertySymbols,CD=Object.prototype.hasOwnProperty,BD=Object.prototype.propertyIsEnumerable,Fa=(t,e,r)=>e in t?PD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Th=(t,e)=>{for(var r in e||(e={}))CD.call(e,r)&&Fa(t,r,e[r]);if(Bh)for(var r of Bh(e))BD.call(e,r)&&Fa(t,r,e[r]);return t},oe=(t,e,r)=>Fa(t,typeof e!="symbol"?e+"":e,r);let TD=class mg extends zI{constructor(e){var r;super(e),oe(this,"protocol",rg),oe(this,"version",ig),oe(this,"name",Pa),oe(this,"relayUrl"),oe(this,"projectId"),oe(this,"customStoragePrefix"),oe(this,"events",new ot.EventEmitter),oe(this,"logger"),oe(this,"heartbeat"),oe(this,"relayer"),oe(this,"crypto"),oe(this,"storage"),oe(this,"history"),oe(this,"expirer"),oe(this,"pairing"),oe(this,"verify"),oe(this,"echoClient"),oe(this,"linkModeSupportedApps"),oe(this,"eventClient"),oe(this,"initialized",!1),oe(this,"logChunkController"),oe(this,"on",(a,c)=>this.events.on(a,c)),oe(this,"once",(a,c)=>this.events.once(a,c)),oe(this,"off",(a,c)=>this.events.off(a,c)),oe(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),oe(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;const u={topic:a,message:c,publishedAt:Date.now(),transportType:ae.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:l})});const i=this.getGlobalCore(e?.customStoragePrefix);if(i)try{return this.customStoragePrefix=i.customStoragePrefix,this.logger=i.logger,this.heartbeat=i.heartbeat,this.crypto=i.crypto,this.history=i.history,this.expirer=i.expirer,this.storage=i.storage,this.relayer=i.relayer,this.pairing=i.pairing,this.verify=i.verify,this.echoClient=i.echoClient,this.linkModeSupportedApps=i.linkModeSupportedApps,this.eventClient=i.eventClient,this.initialized=i.initialized,this.logChunkController=i.logChunkController,i}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||sg,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const n=NE({level:typeof e?.logger=="string"&&e.logger?e.logger:XS.logger,name:Pa}),{logger:s,chunkLoggerController:o}=qd({opts:n,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=at(s,this.name),this.heartbeat=new hI,this.crypto=new o$(this,this.logger,e?.keychain),this.history=new yD(this,this.logger),this.expirer=new bD(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new FI(Th(Th({},QS),e?.storageOptions)),this.relayer=new T$({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new dD(this,this.logger),this.verify=new xD(this,this.logger,this.storage),this.echoClient=new SD(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new AD(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const r=new mg(e);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem(d8,i),r}get context(){return Xe(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(hh,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(hh)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(e,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${e}`,i=`${r}_count`;return globalThis[i]=(globalThis[i]||0)+1,globalThis[i]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[i]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;const i=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[i]=e}catch(i){console.warn("Failed to set global WalletConnect core",i)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&JS.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const RD=TD,bg="wc",vg=2,Eg="client",$c=`${bg}@${vg}:${Eg}:`,Uo={name:Eg,logger:"error"},Rh="WALLETCONNECT_DEEPLINK_CHOICE",ND="proposal",Nh="Proposal expired",UD="session",ai=M.SEVEN_DAYS,jD="engine",De={wc_sessionPropose:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1104},res:{ttl:M.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1106},res:{ttl:M.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1112},res:{ttl:M.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1114},res:{ttl:M.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:M.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:M.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1119}}},jo={min:M.FIVE_MINUTES,max:M.SEVEN_DAYS},Ct={idle:"IDLE",active:"ACTIVE"},kD={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},LD="request",FD=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],MD="wc",qD="auth",zD="authKeys",VD="pairingTopics",KD="requests",Us=`${MD}@${1.5}:${qD}:`,Wn=`${Us}:PUB_KEY`;var HD=Object.defineProperty,WD=Object.defineProperties,GD=Object.getOwnPropertyDescriptors,Uh=Object.getOwnPropertySymbols,YD=Object.prototype.hasOwnProperty,ZD=Object.prototype.propertyIsEnumerable,Ma=(t,e,r)=>e in t?HD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,re=(t,e)=>{for(var r in e||(e={}))YD.call(e,r)&&Ma(t,r,e[r]);if(Uh)for(var r of Uh(e))ZD.call(e,r)&&Ma(t,r,e[r]);return t},Ae=(t,e)=>WD(t,GD(e)),L=(t,e,r)=>Ma(t,typeof e!="symbol"?e+"":e,r);class JD extends oS{constructor(e){super(e),L(this,"name",jD),L(this,"events",new Wa),L(this,"initialized",!1),L(this,"requestQueue",{state:Ct.idle,queue:[]}),L(this,"sessionRequestQueue",{state:Ct.idle,queue:[]}),L(this,"emittedSessionRequests",new d2({limit:500})),L(this,"requestQueueDelay",M.ONE_SECOND),L(this,"expectedPairingMethodMap",new Map),L(this,"recentlyDeletedMap",new Map),L(this,"recentlyDeletedLimit",200),L(this,"relayMessageCache",[]),L(this,"pendingSessions",new Map),L(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(De)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},M.toMiliseconds(this.requestQueueDelay)))}),L(this,"connect",async r=>{var i;this.isInitialized(),await this.confirmOnlineStateOrThrow();const n=Ae(re({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(n),n.optionalNamespaces=_3(n.requiredNamespaces,n.optionalNamespaces),n.requiredNamespaces={};const{pairingTopic:s,requiredNamespaces:o,optionalNamespaces:a,sessionProperties:c,scopedProperties:l,relays:u,authentication:h,walletPay:f}=n,p=((i=h?.[0])==null?void 0:i.ttl)||De.wc_sessionPropose.req.ttl||M.FIVE_MINUTES;this.validateRequestExpiry(p);let d=s,y,m=!1;try{if(d){const A=this.client.core.pairing.pairings.get(d);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),m=A.active}}catch(A){throw this.client.logger.error(`connect() -> pairing.get(${d}) failed`),A}if(!d||!m){const{topic:A,uri:N}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});d=A,y=N}if(!d){const{message:A}=z("NO_MATCHING_KEY",`connect() pairing topic: ${d}`);throw new Error(A)}const x=await this.client.core.crypto.generateKeyPair(),O=pe(p),v=re(Ae(re(re({requiredNamespaces:o,optionalNamespaces:a,relays:u??[{protocol:ng}],proposer:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:O,pairingTopic:d},c&&{sessionProperties:c}),l&&{scopedProperties:l}),{id:Tt()}),(h||f)&&{requests:{authentication:h?.map(A=>{const{domain:N,chains:j,nonce:R,uri:D,exp:T,nbf:g,type:w,statement:I,requestId:P,resources:S,signatureTypes:$}=A;return{domain:N,chains:j,nonce:R,type:w??"caip122",aud:D,version:"1",iat:new Date().toISOString(),exp:T,nbf:g,statement:I,requestId:P,resources:S,signatureTypes:$}}),walletPay:f}}),b=ie("session_connect",v.id),{reject:E,resolve:_,done:C}=Ur(p,Nh),B=({id:A})=>{A===v.id&&(this.client.events.off("proposal_expire",B),this.pendingSessions.delete(v.id),this.events.emit(b,{error:{message:Nh,code:0}}))};return this.client.events.on("proposal_expire",B),this.events.once(b,({error:A,session:N})=>{this.client.events.off("proposal_expire",B),A?E(A):N&&_(N)}),await this.setProposal(v.id,v),await this.sendProposeSession({proposal:v,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:v.id}}}).catch(A=>{throw this.deleteProposal(v.id),A}),{uri:y,approval:C}}),L(this,"pair",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(i){throw this.client.logger.error("pair() failed"),i}}),L(this,"approve",async r=>{var i,n,s;const o=this.client.core.eventClient.createEvent({properties:{topic:(i=r?.id)==null?void 0:i.toString(),trace:[vt.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(N){throw o.setError(Tr.no_internet_connection),N}try{await this.isValidProposalId(r?.id)}catch(N){throw this.client.logger.error(`approve() -> proposal.get(${r?.id}) failed`),o.setError(Tr.proposal_not_found),N}try{await this.isValidApprove(r)}catch(N){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Tr.session_approve_namespace_validation_failure),N}const{id:a,relayProtocol:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:f,proposalRequestsResponses:p}=r,d=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:y,proposer:m,requiredNamespaces:x,optionalNamespaces:O}=d;let v=(n=this.client.core.eventClient)==null?void 0:n.getEvent({topic:y});v||(v=(s=this.client.core.eventClient)==null?void 0:s.createEvent({type:vt.session_approve_started,properties:{topic:y,trace:[vt.session_approve_started,vt.session_namespaces_validation_success]}}));const b=await this.client.core.crypto.generateKeyPair(),E=m.publicKey,_=await this.client.core.crypto.generateSharedKey(b,E),C=Ae(re(re(re({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:b,metadata:this.client.metadata},expiry:pe(ai)},u&&{sessionProperties:u}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),{proposalRequestsResponses:p}),B=ae.relay;v.addTrace(vt.subscribing_session_topic);try{await this.client.core.relayer.subscribe(_,{transportType:B,internal:{skipSubscribe:!0}})}catch(N){throw v.setError(Tr.subscribe_session_topic_failure),N}v.addTrace(vt.subscribe_session_topic_success);const A=Ae(re({},C),{topic:_,requiredNamespaces:x,optionalNamespaces:O,pairingTopic:y,acknowledged:!1,self:C.controller,peer:{publicKey:m.publicKey,metadata:m.metadata},controller:b,transportType:ae.relay,authentication:p?.authentication,walletPayResult:p?.walletPay});await this.client.session.set(_,A),v.addTrace(vt.store_session);try{await this.sendApproveSession({sessionTopic:_,proposal:d,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:b},sessionSettleRequest:C,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:re({correlationId:a},this.getTVFApproveParams(A))}}),v.addTrace(vt.session_approve_publish_success)}catch(N){throw this.client.logger.error(N),this.client.session.delete(_,ce("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(_),N}return this.client.core.eventClient.deleteEvent({eventId:v.eventId}),await this.client.core.pairing.updateMetadata({topic:y,metadata:m.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:y}),await this.setExpiry(_,pe(ai)),{topic:_,acknowledged:()=>Promise.resolve(this.client.session.get(_))}}),L(this,"reject",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:i,reason:n}=r;let s;try{s=this.client.proposal.get(i).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${i}) failed`),o}s&&await this.sendError({id:i,topic:s,error:n,rpcOpts:De.wc_sessionPropose.reject}),await this.deleteProposal(i)}),L(this,"update",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:i,namespaces:n}=r,{done:s,resolve:o,reject:a}=Ur(M.FIVE_MINUTES,"Session update request expired without receiving any acknowledgement"),c=Tt(),l=xr().toString(),u=this.client.session.get(i).namespaces;return this.events.once(ie("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(i,{namespaces:n}),await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:n},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(h=>{this.client.logger.error(h),this.client.session.update(i,{namespaces:u}),a(h)}),{acknowledged:s}}),L(this,"extend",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:i}=r,n=Tt(),{done:s,resolve:o,reject:a}=Ur(M.FIVE_MINUTES,"Session extend request expired without receiving any acknowledgement");return this.events.once(ie("session_extend",n),({error:c})=>{c?a(c):o()}),await this.setExpiry(i,pe(ai)),this.sendRequest({topic:i,method:"wc_sessionExtend",params:{},clientRpcId:n,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:s}}),L(this,"request",async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch(m){throw this.client.logger.error("request() -> isValidRequest() failed"),m}const{chainId:i,request:n,topic:s,expiry:o=De.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(s);a?.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const c=Tt(),l=xr().toString(),{done:u,resolve:h,reject:f}=Ur(o,"Request expired. Please try again.");this.events.once(ie("session_request",c),({error:m,result:x})=>{m?f(m):h(x)});const p="wc_sessionRequest",d=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(d)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:s,method:p,params:{request:Ae(re({},n),{expiryTimestamp:pe(o)}),chainId:i},expiry:o,throwOnFailedPublish:!0,appLink:d}).catch(m=>f(m)),this.client.events.emit("session_request_sent",{topic:s,request:n,chainId:i,id:c}),await u();const y={request:Ae(re({},n),{expiryTimestamp:pe(o)}),chainId:i};return await Promise.all([new Promise(async m=>{await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:s,method:p,params:y,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,y)}).catch(x=>f(x)),this.client.events.emit("session_request_sent",{topic:s,request:n,chainId:i,id:c}),m()}),new Promise(async m=>{var x;if(!((x=a.sessionConfig)!=null&&x.disableDeepLink)){const O=await c2(this.client.core.storage,Rh);await s2({id:c,topic:s,wcDeepLink:O})}m()}),u()]).then(m=>m[2])}),L(this,"respond",async r=>{var i,n;this.isInitialized();const s=this.client.core.eventClient.createEvent({properties:{topic:r?.topic||((n=(i=r?.response)==null?void 0:i.id)==null?void 0:n.toString()),trace:[vt.session_request_response_started]}});try{await this.isValidRespond(r)}catch(h){throw s.addTrace(h?.message),s.setError(Tr.session_request_response_validation_failure),h}s.addTrace(vt.session_request_response_validation_success);const{topic:o,response:a}=r,{id:c}=a,l=this.client.session.get(o);l.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const u=this.getAppLinkIfEnabled(l.peer.metadata,l.transportType);try{s.addTrace(vt.session_request_response_publish_started),Rt(a)?await this.sendResult({id:c,topic:o,result:a.result,throwOnFailedPublish:!0,appLink:u}):pt(a)&&await this.sendError({id:c,topic:o,error:a.error,appLink:u}),this.cleanupAfterResponse(r)}catch(h){throw s.addTrace(h?.message),s.setError(Tr.session_request_response_publish_failure),h}}),L(this,"ping",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(n){throw this.client.logger.error("ping() -> isValidPing() failed"),n}const{topic:i}=r;if(this.client.session.keys.includes(i)){const n=Tt(),s=xr().toString(),{done:o,resolve:a,reject:c}=Ur(M.FIVE_MINUTES,"Ping request expired without receiving any acknowledgement");this.events.once(ie("session_ping",n),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:i,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:n,relayRpcId:s}),o()])}else this.client.core.pairing.pairings.keys.includes(i)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:i}))}),L(this,"emit",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);const{topic:i,event:n,chainId:s}=r,o=xr().toString(),a=Tt();await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:n,chainId:s},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),L(this,"disconnect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);const{topic:i}=r;if(this.client.session.keys.includes(i))await this.sendRequest({topic:i,method:"wc_sessionDelete",params:ce("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))await this.client.core.pairing.disconnect({topic:i});else{const{message:n}=z("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(n)}}),L(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(i=>O3(i,r)))),L(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),L(this,"authenticate",async(r,i)=>{var n;this.isInitialized(),this.isValidAuthenticate(r);const s=i&&this.client.core.linkModeSupportedApps.includes(i)&&((n=this.client.metadata.redirect)==null?void 0:n.linkMode),o=s?ae.link_mode:ae.relay;o===ae.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:l,domain:u,nonce:h,type:f,exp:p,nbf:d,methods:y=[],expiry:m}=r,x=[...r.resources||[]],{topic:O,uri:v}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:O,uri:v}});const b=await this.client.core.crypto.generateKeyPair(),E=zn(b);if(await Promise.all([this.client.auth.authKeys.set(Wn,{responseTopic:E,publicKey:b}),this.client.auth.pairingTopics.set(E,{topic:E,pairingTopic:O})]),await this.client.core.relayer.subscribe(E,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${O}`),y.length>0){const{namespace:S}=ir(a[0]);let $=Ox(S,"request",y);qn(x)&&($=Dx($,x.pop())),x.push($)}const _=m&&m>De.wc_sessionAuthenticate.req.ttl?m:De.wc_sessionAuthenticate.req.ttl,C={authPayload:{type:f??"caip122",chains:a,statement:c,aud:l,domain:u,version:"1",nonce:h,iat:new Date().toISOString(),exp:p,nbf:d,resources:x},requester:{publicKey:b,metadata:this.client.metadata},expiryTimestamp:pe(_)},B={eip155:{chains:a,methods:[...new Set(["personal_sign",...y])],events:["chainChanged","accountsChanged"]}},A={requiredNamespaces:{},optionalNamespaces:B,relays:[{protocol:"irn"}],pairingTopic:O,proposer:{publicKey:b,metadata:this.client.metadata},expiryTimestamp:pe(De.wc_sessionPropose.req.ttl),id:Tt()},{done:N,resolve:j,reject:R}=Ur(_,"Request expired"),D=Tt(),T=ie("session_connect",A.id),g=ie("session_request",D),w=async({error:S,session:$})=>{this.events.off(g,I),S?R(S):$&&j({session:$})},I=async S=>{var $,U,k;if(await this.deletePendingAuthRequest(D,{message:"fulfilled",code:0}),S.error){const W=ce("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return S.error.code===W.code?void 0:(this.events.off(T,w),R(S.error.message))}await this.deleteProposal(A.id),this.events.off(T,w);const{cacaos:V,responder:F}=S.result,q=[],H=[];for(const W of V){await yu({cacao:W,projectId:this.client.core.projectId})||(this.client.logger.error(W,"Signature verification failed"),R(ce("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:J}=W,ue=qn(J.resources),ye=[pa(J.iss)],be=ss(J.iss);if(ue){const ke=wu(ue),$t=mu(ue);q.push(...ke),ye.push(...$t)}for(const ke of ye)H.push(`${ke}:${be}`)}const G=await this.client.core.crypto.generateSharedKey(b,F.publicKey);let Z;q.length>0&&(Z={topic:G,acknowledged:!0,self:{publicKey:b,metadata:this.client.metadata},peer:F,controller:F.publicKey,expiry:pe(ai),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:O,namespaces:Vu([...new Set(q)],[...new Set(H)]),transportType:o},await this.client.core.relayer.subscribe(G,{transportType:o}),await this.client.session.set(G,Z),O&&await this.client.core.pairing.updateMetadata({topic:O,metadata:F.metadata}),Z=this.client.session.get(G)),($=this.client.metadata.redirect)!=null&&$.linkMode&&(U=F.metadata.redirect)!=null&&U.linkMode&&(k=F.metadata.redirect)!=null&&k.universal&&i&&(this.client.core.addLinkModeSupportedApp(F.metadata.redirect.universal),this.client.session.update(G,{transportType:ae.link_mode})),j({auths:V,session:Z})};this.events.once(T,w),this.events.once(g,I);let P;try{if(s){const S=It("wc_sessionAuthenticate",C,D);this.client.core.history.set(O,S);const $=await this.client.core.crypto.encode("",S,{type:gn,encoding:vr});P=Bn(i,O,$)}else await Promise.all([this.sendRequest({topic:O,method:"wc_sessionAuthenticate",params:C,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:D}),this.sendRequest({topic:O,method:"wc_sessionPropose",params:A,expiry:De.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:A.id})])}catch(S){throw this.events.off(T,w),this.events.off(g,I),S}return await this.setProposal(A.id,A),await this.setAuthRequest(D,{request:Ae(re({},C),{verifyContext:{}}),pairingTopic:O,transportType:o}),{uri:P??v,response:N}}),L(this,"approveSessionAuthenticate",async r=>{const{id:i,auths:n}=r,s=this.client.core.eventClient.createEvent({properties:{topic:i.toString(),trace:[Rr.authenticated_session_approve_started]}});try{this.isInitialized()}catch(m){throw s.setError(Ri.no_internet_connection),m}const o=this.getPendingAuthRequest(i);if(!o)throw s.setError(Ri.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${i}`);const a=o.transportType||ae.relay;a===ae.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),u=zn(c),h={type:nr,receiverPublicKey:c,senderPublicKey:l},f=[],p=[];for(const m of n){if(!await yu({cacao:m,projectId:this.client.core.projectId})){s.setError(Ri.invalid_cacao);const E=ce("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:i,topic:u,error:E,encodeOpts:h}),new Error(E.message)}s.addTrace(Rr.cacaos_verified);const{p:x}=m,O=qn(x.resources),v=[pa(x.iss)],b=ss(x.iss);if(O){const E=wu(O),_=mu(O);f.push(...E),v.push(..._)}for(const E of v)p.push(`${E}:${b}`)}const d=await this.client.core.crypto.generateSharedKey(l,c);s.addTrace(Rr.create_authenticated_session_topic);let y;if(f?.length>0){y={topic:d,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:pe(ai),authentication:n,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:Vu([...new Set(f)],[...new Set(p)]),transportType:a},s.addTrace(Rr.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(d,{transportType:a})}catch(m){throw s.setError(Ri.subscribe_authenticated_session_topic_failure),m}s.addTrace(Rr.subscribe_authenticated_session_topic_success),await this.client.session.set(d,y),s.addTrace(Rr.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}s.addTrace(Rr.publishing_authenticated_session_approve);try{await this.sendResult({topic:u,id:i,result:{cacaos:n,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(m){throw s.setError(Ri.authenticated_session_approve_publish_failure),m}return await this.client.auth.requests.delete(i,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:s.eventId}),{session:y}}),L(this,"rejectSessionAuthenticate",async r=>{this.isInitialized();const{id:i,reason:n}=r,s=this.getPendingAuthRequest(i);if(!s)throw new Error(`Could not find pending auth request with id ${i}`);s.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const o=s.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=zn(o),l={type:nr,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:i,topic:c,error:n,encodeOpts:l,rpcOpts:De.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(s.requester.metadata,s.transportType)}),await this.client.auth.requests.delete(i,{message:"rejected",code:0}),await this.deleteProposal(i)}),L(this,"formatAuthMessage",r=>{this.isInitialized();const{request:i,iss:n}=r;return up(i,n)}),L(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)}),L(this,"cleanupDuplicatePairings",async r=>{if(r.pairingTopic)try{const i=this.client.core.pairing.pairings.get(r.pairingTopic),n=this.client.core.pairing.pairings.getAll().filter(s=>{var o,a;return((o=s.peerMetadata)==null?void 0:o.url)&&((a=s.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&s.topic&&s.topic!==i.topic});if(n.length===0)return;this.client.logger.info(`Cleaning up ${n.length} duplicate pairing(s)`),await Promise.all(n.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}}),L(this,"deleteSession",async r=>{var i;const{topic:n,expirerHasDeleted:s=!1,emitEvent:o=!0,id:a=0}=r,{self:c}=this.client.session.get(n);await this.client.core.relayer.unsubscribe(n),await this.client.session.delete(n,ce("USER_DISCONNECTED")),this.addToRecentlyDeleted(n,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(n)&&await this.client.core.crypto.deleteSymKey(n),s||this.client.core.expirer.del(n),this.client.core.storage.removeItem(Rh).catch(l=>this.client.logger.warn(l)),n===((i=this.sessionRequestQueue.queue[0])==null?void 0:i.topic)&&(this.sessionRequestQueue.state=Ct.idle),await Promise.all(this.getPendingSessionRequests().filter(l=>l.topic===n).map(l=>this.deletePendingSessionRequest(l.id,ce("USER_DISCONNECTED")))),o&&this.client.events.emit("session_delete",{id:a,topic:n})}),L(this,"deleteProposal",async(r,i)=>{if(i)try{const n=this.client.proposal.get(r);this.client.core.eventClient.getEvent({topic:n.pairingTopic})?.setError(Tr.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,ce("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")}),L(this,"deletePendingSessionRequest",async(r,i,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),n?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==r),n&&(this.sessionRequestQueue.state=Ct.idle,this.client.events.emit("session_request_expire",{id:r}))}),L(this,"deletePendingAuthRequest",async(r,i,n=!1)=>{await Promise.all([this.client.auth.requests.delete(r,i),n?Promise.resolve():this.client.core.expirer.del(r)])}),L(this,"setExpiry",async(r,i)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,i),await this.client.session.update(r,{expiry:i}))}),L(this,"setProposal",async(r,i)=>{this.client.core.expirer.set(r,pe(De.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,i)}),L(this,"setAuthRequest",async(r,i)=>{const{request:n,pairingTopic:s,transportType:o=ae.relay}=i;this.client.core.expirer.set(r,n.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:n.authPayload,requester:n.requester,expiryTimestamp:n.expiryTimestamp,id:r,pairingTopic:s,verifyContext:n.verifyContext,transportType:o})}),L(this,"setPendingSessionRequest",async r=>{const{id:i,topic:n,params:s,verifyContext:o}=r,a=s.request.expiryTimestamp||pe(De.wc_sessionRequest.req.ttl);this.client.core.expirer.set(i,a),await this.client.pendingRequest.set(i,{id:i,topic:n,params:s,verifyContext:o})}),L(this,"sendRequest",async r=>{const{topic:i,method:n,params:s,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:u,tvf:h,publishOpts:f={}}=r,p=It(n,s,c);let d;const y=!!u;try{const O=y?vr:Ge;d=await this.client.core.crypto.encode(i,p,{encoding:O})}catch(O){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${i} failed`),O}let m;if(FD.includes(n)){const O=dt(JSON.stringify(p)),v=dt(d);m=await this.client.core.verify.register({id:v,decryptedId:O})}const x=re(re({},De[n].req),f);if(x.attestation=m,o&&(x.ttl=o),a&&(x.id=a),this.client.core.history.set(i,p),y){const O=Bn(u,i,d);await global.Linking.openURL(O,this.client.name)}else x.tvf=Ae(re({},h),{correlationId:p.id}),l?(x.internal=Ae(re({},x.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,d,x)):this.client.core.relayer.publish(i,d,x).catch(O=>this.client.logger.error(O));return p.id}),L(this,"sendProposeSession",async r=>{const{proposal:i,publishOpts:n}=r,s=It("wc_sessionPropose",i,i.id);this.client.core.history.set(i.pairingTopic,s);const o=await this.client.core.crypto.encode(i.pairingTopic,s,{encoding:Ge}),a=dt(JSON.stringify(s)),c=dt(o),l=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:i.pairingTopic,sessionProposal:o},opts:Ae(re({},n),{publishMethod:"wc_proposeSession",attestation:l})})}),L(this,"sendApproveSession",async r=>{const{sessionTopic:i,pairingProposalResponse:n,proposal:s,sessionSettleRequest:o,publishOpts:a}=r,c=rn(s.id,n),l=await this.client.core.crypto.encode(s.pairingTopic,c,{encoding:Ge}),u=It("wc_sessionSettle",o,a?.id),h=await this.client.core.crypto.encode(i,u,{encoding:Ge});this.client.core.history.set(i,u),await this.client.core.relayer.publishCustom({payload:{sessionTopic:i,pairingTopic:s.pairingTopic,sessionProposalResponse:l,sessionSettlementRequest:h},opts:Ae(re({},a),{publishMethod:"wc_approveSession"})})}),L(this,"sendResult",async r=>{const{id:i,topic:n,result:s,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=r,l=rn(i,s);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const d=h?vr:Ge;u=await this.client.core.crypto.encode(n,l,Ae(re({},a||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${n} failed`),d}let f,p;try{f=await this.client.core.history.get(n,i);const d=f.request;try{p=this.getTVFParams(i,d.params,s)}catch(y){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${y?.message}`)}}catch(d){throw this.client.logger.error(`sendResult() -> history.get(${n}, ${i}) failed`),d}if(h){const d=Bn(c,n,u);await global.Linking.openURL(d,this.client.name)}else{const d=f.request.method,y=De[d].res;y.tvf=Ae(re({},p),{correlationId:i}),o?(y.internal=Ae(re({},y.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,u,y)):this.client.core.relayer.publish(n,u,y).catch(m=>this.client.logger.error(m))}await this.client.core.history.resolve(l)}),L(this,"sendError",async r=>{const{id:i,topic:n,error:s,encodeOpts:o,rpcOpts:a,appLink:c}=r,l=Ts(i,s);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const p=h?vr:Ge;u=await this.client.core.crypto.encode(n,l,Ae(re({},o||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${n} failed`),p}let f;try{f=await this.client.core.history.get(n,i)}catch(p){throw this.client.logger.error(`sendError() -> history.get(${n}, ${i}) failed`),p}if(h){const p=Bn(c,n,u);await global.Linking.openURL(p,this.client.name)}else{const p=f.request.method,d=a||De[p].res;this.client.core.relayer.publish(n,u,d)}await this.client.core.history.resolve(l)}),L(this,"cleanup",async()=>{const r=[],i=[];this.client.session.getAll().forEach(n=>{let s=!1;Ut(n.expiry)&&(s=!0),this.client.core.crypto.keychain.has(n.topic)||(s=!0),s&&r.push(n.topic)}),this.client.proposal.getAll().forEach(n=>{Ut(n.expiryTimestamp)&&i.push(n.id)}),await Promise.all([...r.map(n=>this.deleteSession({topic:n})),...i.map(n=>this.deleteProposal(n))])}),L(this,"onProviderMessageEvent",async r=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(r):await this.onRelayMessage(r)}),L(this,"onRelayEventRequest",async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()}),L(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===Ct.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Ct.active;const r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=Ct.idle}),L(this,"processRequest",async r=>{const{topic:i,payload:n,attestation:s,transportType:o,encryptedId:a}=r,c=n.method;if(!this.shouldIgnorePairingRequest({topic:i,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:i,payload:n,attestation:s,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(i,n);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(i,n);case"wc_sessionExtend":return await this.onSessionExtendRequest(i,n);case"wc_sessionPing":return await this.onSessionPingRequest(i,n);case"wc_sessionDelete":return await this.onSessionDeleteRequest(i,n);case"wc_sessionRequest":return await this.onSessionRequest({topic:i,payload:n,attestation:s,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(i,n);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:i,payload:n,attestation:s,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),L(this,"onRelayEventResponse",async r=>{const{topic:i,payload:n,transportType:s}=r,o=(await this.client.core.history.get(i,n.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(i,n,s);case"wc_sessionSettle":return this.onSessionSettleResponse(i,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,n);case"wc_sessionExtend":return this.onSessionExtendResponse(i,n);case"wc_sessionPing":return this.onSessionPingResponse(i,n);case"wc_sessionRequest":return this.onSessionRequestResponse(i,n);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(i,n);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),L(this,"onRelayEventUnknownPayload",r=>{const{topic:i}=r,{message:n}=z("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(n)}),L(this,"shouldIgnorePairingRequest",r=>{const{topic:i,requestMethod:n}=r,s=this.expectedPairingMethodMap.get(i);return!s||s.includes(n)?!1:!!(s.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),L(this,"onSessionProposeRequest",async r=>{const{topic:i,payload:n,attestation:s,encryptedId:o}=r,{params:a,id:c}=n;try{const l=this.client.core.eventClient.getEvent({topic:i});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l?.setError(Zt.proposal_listener_not_found)),this.isValidConnect(re({},n.params));const u=a.expiryTimestamp||pe(De.wc_sessionPropose.req.ttl),h=re({id:c,pairingTopic:i,expiryTimestamp:u,attestation:s,encryptedId:o},a);await this.setProposal(c,h);const f=await this.getVerifyContext({attestationId:s,hash:dt(JSON.stringify(n)),encryptedId:o,metadata:h.proposer.metadata});l?.addTrace(Bt.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:f})}catch(l){await this.sendError({id:c,topic:i,error:l,rpcOpts:De.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),L(this,"onSessionProposeResponse",async(r,i,n)=>{const{id:s}=i;if(Rt(i)){const{result:o}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const u=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(s,{sessionTopic:u,pairingTopic:r,proposalId:s,publicKey:c});const h=await this.client.core.relayer.subscribe(u,{transportType:n});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:r})}else if(pt(i)){await this.deleteProposal(s);const o=ie("session_connect",s);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:i.error})}}),L(this,"onSessionSettleRequest",async(r,i)=>{const{id:n,params:s}=i;try{this.isValidSessionSettleRequest(s);const{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:f,proposalRequestsResponses:p}=i.params,d=[...this.pendingSessions.values()].find(x=>x.sessionTopic===r);if(!d)return this.client.logger.error(`Pending session not found for topic ${r}`);const y=this.client.proposal.get(d.proposalId),m=Ae(re(re(re({topic:r,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:d.pairingTopic,requiredNamespaces:y.requiredNamespaces,optionalNamespaces:y.optionalNamespaces,controller:a.publicKey,self:{publicKey:d.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},u&&{sessionProperties:u}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),{transportType:ae.relay,authentication:p?.authentication,walletPayResult:p?.walletPay});await this.client.session.set(m.topic,m),await this.setExpiry(m.topic,m.expiry),await this.client.core.pairing.updateMetadata({topic:d.pairingTopic,metadata:m.peer.metadata}),this.pendingSessions.delete(d.proposalId),this.deleteProposal(d.proposalId,!1),this.cleanupDuplicatePairings(m),await this.sendResult({id:i.id,topic:r,throwOnFailedPublish:!0,result:!0}),this.client.events.emit("session_connect",{session:m}),this.events.emit(ie("session_connect",d.proposalId),{session:m})}catch(o){await this.sendError({id:n,topic:r,error:o}),this.client.logger.error(o)}}),L(this,"onSessionSettleResponse",async(r,i)=>{const{id:n}=i;Rt(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(ie("session_approve",n),{})):pt(i)&&(await this.client.session.delete(r,ce("USER_DISCONNECTED")),this.events.emit(ie("session_approve",n),{error:i.error}))}),L(this,"onSessionUpdateRequest",async(r,i)=>{const{params:n,id:s}=i;try{const o=`${r}_session_update`,a=Bi.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.warn(`Discarding out of sync request - ${s}`),this.sendError({id:s,topic:r,error:ce("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(re({topic:r},n));try{Bi.set(o,s),await this.client.session.update(r,{namespaces:n.namespaces}),await this.sendResult({id:s,topic:r,result:!0})}catch(c){throw Bi.delete(o),c}this.client.events.emit("session_update",{id:s,topic:r,params:n})}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),L(this,"isRequestOutOfSync",(r,i)=>i.toString().slice(0,-3)<r.toString().slice(0,-3)),L(this,"onSessionUpdateResponse",(r,i)=>{const{id:n}=i,s=ie("session_update",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Rt(i)?this.events.emit(ie("session_update",n),{}):pt(i)&&this.events.emit(ie("session_update",n),{error:i.error})}),L(this,"onSessionExtendRequest",async(r,i)=>{const{id:n}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,pe(ai)),await this.sendResult({id:n,topic:r,result:!0}),this.client.events.emit("session_extend",{id:n,topic:r})}catch(s){await this.sendError({id:n,topic:r,error:s}),this.client.logger.error(s)}}),L(this,"onSessionExtendResponse",(r,i)=>{const{id:n}=i,s=ie("session_extend",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Rt(i)?this.events.emit(ie("session_extend",n),{}):pt(i)&&this.events.emit(ie("session_extend",n),{error:i.error})}),L(this,"onSessionPingRequest",async(r,i)=>{const{id:n}=i;try{this.isValidPing({topic:r}),await this.sendResult({id:n,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:n,topic:r})}catch(s){await this.sendError({id:n,topic:r,error:s}),this.client.logger.error(s)}}),L(this,"onSessionPingResponse",(r,i)=>{const{id:n}=i,s=ie("session_ping",n);setTimeout(()=>{if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners 2176`);Rt(i)?this.events.emit(ie("session_ping",n),{}):pt(i)&&this.events.emit(ie("session_ping",n),{error:i.error})},500)}),L(this,"onSessionDeleteRequest",async(r,i)=>{const{id:n}=i;try{await this.isValidDisconnect({topic:r,reason:i.params}),this.cleanupPendingSentRequestsForTopic({topic:r,error:ce("USER_DISCONNECTED")}),await this.deleteSession({topic:r,id:n})}catch(s){this.client.logger.error(s)}}),L(this,"onSessionRequest",async r=>{var i,n,s;const{topic:o,payload:a,attestation:c,encryptedId:l,transportType:u}=r,{id:h,params:f}=a;try{await this.isValidRequest(re({topic:o},f));const p=this.client.session.get(o),d=await this.getVerifyContext({attestationId:c,hash:dt(JSON.stringify(It("wc_sessionRequest",f,h))),encryptedId:l,metadata:p.peer.metadata,transportType:u}),y={id:h,topic:o,params:f,verifyContext:d};await this.setPendingSessionRequest(y),u===ae.link_mode&&(i=p.peer.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp((n=p.peer.metadata.redirect)==null?void 0:n.universal),(s=this.client.signConfig)!=null&&s.disableRequestQueue?this.emitSessionRequest(y):(this.addSessionRequestToSessionRequestQueue(y),this.processSessionRequestQueue())}catch(p){await this.sendError({id:h,topic:o,error:p}),this.client.logger.error(p)}}),L(this,"onSessionRequestResponse",(r,i)=>{const{id:n}=i,s=ie("session_request",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Rt(i)?this.events.emit(ie("session_request",n),{result:i.result}):pt(i)&&this.events.emit(ie("session_request",n),{error:i.error})}),L(this,"onSessionEventRequest",async(r,i)=>{const{id:n,params:s}=i;try{const o=`${r}_session_event_${s.event.name}`,a=Bi.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.info(`Discarding out of sync request - ${n}`);return}this.isValidEmit(re({topic:r},s)),this.client.events.emit("session_event",{id:n,topic:r,params:s}),Bi.set(o,n)}catch(o){await this.sendError({id:n,topic:r,error:o}),this.client.logger.error(o)}}),L(this,"onSessionAuthenticateResponse",(r,i)=>{const{id:n}=i;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:i}),Rt(i)?this.events.emit(ie("session_request",n),{result:i.result}):pt(i)&&this.events.emit(ie("session_request",n),{error:i.error})}),L(this,"onSessionAuthenticateRequest",async r=>{var i;const{topic:n,payload:s,attestation:o,encryptedId:a,transportType:c}=r;try{const{requester:l,authPayload:u,expiryTimestamp:h}=s.params,f=await this.getVerifyContext({attestationId:o,hash:dt(JSON.stringify(s)),encryptedId:a,metadata:l.metadata,transportType:c}),p={requester:l,pairingTopic:n,id:s.id,authPayload:u,verifyContext:f,expiryTimestamp:h};await this.setAuthRequest(s.id,{request:p,pairingTopic:n,transportType:c}),c===ae.link_mode&&(i=l.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:n,params:s.params,id:s.id,verifyContext:f})}catch(l){this.client.logger.error(l);const u=s.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),f=this.getAppLinkIfEnabled(s.params.requester.metadata,c),p={type:nr,receiverPublicKey:u,senderPublicKey:h};await this.sendError({id:s.id,topic:n,error:l,encodeOpts:p,rpcOpts:De.wc_sessionAuthenticate.autoReject,appLink:f})}}),L(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),L(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Ct.idle,this.processSessionRequestQueue()},M.toMiliseconds(this.requestQueueDelay))}),L(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:i})=>{const n=this.client.core.history.pending;n.length>0&&n.filter(s=>s.topic===r&&s.request.method==="wc_sessionRequest").forEach(s=>{this.events.emit(ie("session_request",s.request.id),{error:i})})}),L(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===Ct.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(r)}catch(i){this.client.logger.error(i)}}),L(this,"emitSessionRequest",r=>{if(this.emittedSessionRequests.has(r.id)){this.client.logger.warn({id:r.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${r.id}`);return}this.sessionRequestQueue.state=Ct.active,this.emittedSessionRequests.add(r.id),this.client.events.emit("session_request",r)}),L(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const i=this.client.proposal.getAll().find(n=>n.pairingTopic===r.topic);i&&this.onSessionProposeRequest({topic:r.topic,payload:It("wc_sessionPropose",Ae(re({},i),{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties,scopedProperties:i.scopedProperties}),i.id),attestation:i.attestation,encryptedId:i.encryptedId})}),L(this,"isValidConnect",async r=>{if(!Ke(r)){const{message:l}=z("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(l)}const{pairingTopic:i,requiredNamespaces:n,optionalNamespaces:s,sessionProperties:o,scopedProperties:a,relays:c}=r;if(Ie(i)||await this.isValidPairingTopic(i),!k3(c)){const{message:l}=z("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(n&&!Ie(n)&&Ft(n)!==0){const l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(n,"requiredNamespaces")}if(s&&!Ie(s)&&Ft(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),o&&!Ie(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Ie(a)){this.validateSessionProps(a,"scopedProperties");const l=Object.keys(n||{}).concat(Object.keys(s||{}));if(!Object.keys(a).every(u=>l.includes(u.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),L(this,"validateNamespaces",(r,i)=>{const n=j3(r,"connect()",i);if(n)throw new Error(n.message)}),L(this,"isValidApprove",async r=>{if(!Ke(r))throw new Error(z("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:n,relayProtocol:s,sessionProperties:o,scopedProperties:a}=r;this.checkRecentlyDeleted(i),await this.isValidProposalId(i);const c=this.client.proposal.get(i),l=Ao(n,"approve()");if(l)throw new Error(l.message);const u=Wu(c.requiredNamespaces,n,"approve()");if(u)throw new Error(u.message);if(!ge(s,!0)){const{message:h}=z("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(h)}if(o&&!Ie(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Ie(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(n));if(!Object.keys(a).every(f=>h.has(f.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),L(this,"isValidReject",async r=>{if(!Ke(r)){const{message:s}=z("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(s)}const{id:i,reason:n}=r;if(this.checkRecentlyDeleted(i),await this.isValidProposalId(i),!F3(n)){const{message:s}=z("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(s)}}),L(this,"isValidSessionSettleRequest",r=>{if(!Ke(r)){const{message:l}=z("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(l)}const{relay:i,controller:n,namespaces:s,expiry:o}=r;if(!Gp(i)){const{message:l}=z("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const a=C3(n,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=Ao(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(Ut(o)){const{message:l}=z("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),L(this,"isValidUpdate",async r=>{if(!Ke(r)){const{message:c}=z("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}const{topic:i,namespaces:n}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const s=this.client.session.get(i),o=Ao(n,"update()");if(o)throw new Error(o.message);const a=Wu(s.requiredNamespaces,n,"update()");if(a)throw new Error(a.message)}),L(this,"isValidExtend",async r=>{if(!Ke(r)){const{message:n}=z("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(n)}const{topic:i}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i)}),L(this,"isValidRequest",async r=>{if(!Ke(r)){const{message:c}=z("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}const{topic:i,request:n,chainId:s,expiry:o}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const{namespaces:a}=this.client.session.get(i);if(!Hu(a,s)){const{message:c}=z("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(c)}if(!M3(n)){const{message:c}=z("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(c)}if(!V3(a,s,n.method)){const{message:c}=z("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(c)}this.validateRequestExpiry(o)}),L(this,"isValidRespond",async r=>{var i;if(!Ke(r)){const{message:a}=z("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(a)}const{topic:n,response:s}=r;try{await this.isValidSessionTopic(n)}catch(a){throw(i=r?.response)!=null&&i.id&&this.cleanupAfterResponse(r),a}if(!q3(s)){const{message:a}=z("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(a)}const o=this.client.pendingRequest.get(s.id);if(o.topic!==n){const{message:a}=z("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${s.id}, expected topic: ${o.topic}, received topic: ${n}`);throw new Error(a)}}),L(this,"isValidPing",async r=>{if(!Ke(r)){const{message:n}=z("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),L(this,"isValidEmit",async r=>{if(!Ke(r)){const{message:a}=z("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}const{topic:i,event:n,chainId:s}=r;await this.isValidSessionTopic(i);const{namespaces:o}=this.client.session.get(i);if(!Hu(o,s)){const{message:a}=z("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(a)}if(!z3(n)){const{message:a}=z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(a)}if(!K3(o,s,n.name)){const{message:a}=z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(a)}}),L(this,"isValidDisconnect",async r=>{if(!Ke(r)){const{message:n}=z("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),L(this,"isValidAuthenticate",r=>{const{chains:i,uri:n,domain:s,nonce:o}=r;if(!Array.isArray(i)||i.length===0)throw new Error("chains is required and must be a non-empty array");if(!ge(n,!1))throw new Error("uri is required parameter");if(!ge(s,!1))throw new Error("domain is required parameter");if(!ge(o,!1))throw new Error("nonce is required parameter");if([...new Set(i.map(c=>ir(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=ir(i[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),L(this,"getVerifyContext",async r=>{const{attestationId:i,hash:n,encryptedId:s,metadata:o,transportType:a}=r,c={verified:{verifyUrl:o.verifyUrl||Hi,validation:"UNKNOWN",origin:o.url||""}};try{if(a===ae.link_mode){const u=this.getAppLinkIfEnabled(o,a);return c.verified.validation=u&&new URL(u).origin===new URL(o.url).origin?"VALID":"INVALID",c}const l=await this.client.core.verify.resolve({attestationId:i,hash:n,encryptedId:s,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),L(this,"validateSessionProps",(r,i)=>{Object.values(r).forEach((n,s)=>{if(n==null){const{message:o}=z("MISSING_OR_INVALID",`${i} must contain an existing value for each key. Received: ${n} for key ${Object.keys(r)[s]}`);throw new Error(o)}})}),L(this,"getPendingAuthRequest",r=>{const i=this.client.auth.requests.get(r);return typeof i=="object"?i:void 0}),L(this,"addToRecentlyDeleted",(r,i)=>{if(this.recentlyDeletedMap.set(r,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let n=0;const s=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(n++>=s)break;this.recentlyDeletedMap.delete(o)}}}),L(this,"checkRecentlyDeleted",r=>{const i=this.recentlyDeletedMap.get(r);if(i){const{message:n}=z("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${r}`);throw new Error(n)}}),L(this,"isLinkModeEnabled",(r,i)=>{var n,s,o,a,c,l,u,h,f;return!r||i!==ae.link_mode?!1:((s=(n=this.client.metadata)==null?void 0:n.redirect)==null?void 0:s.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((u=r?.redirect)==null?void 0:u.universal)!==void 0&&((h=r?.redirect)==null?void 0:h.universal)!==""&&((f=r?.redirect)==null?void 0:f.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),L(this,"getAppLinkIfEnabled",(r,i)=>{var n;return this.isLinkModeEnabled(r,i)?(n=r?.redirect)==null?void 0:n.universal:void 0}),L(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;const i=nu(r,"topic")||"",n=decodeURIComponent(nu(r,"wc_ev")||""),s=this.client.session.keys.includes(i);s&&this.client.session.update(i,{transportType:ae.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:n,sessionExists:s})}),L(this,"registerLinkModeListeners",async()=>{var r;if(fc()||Dr()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){const i=global==null?void 0:global.Linking;if(typeof i<"u"){i.addEventListener("url",this.handleLinkModeMessage,this.client.name);const n=await i.getInitialURL();n&&setTimeout(()=>{this.handleLinkModeMessage({url:n})},50)}}}),L(this,"getTVFApproveParams",r=>{try{const i=Hp(r.namespaces),n=m3(r.namespaces),s=b3(r.namespaces),o=r.sessionProperties,a=r.scopedProperties;return{approvedChains:i,approvedMethods:n,approvedEvents:s,sessionProperties:o,scopedProperties:a}}catch(i){return this.client.logger.warn(i,"Error getting TVF approve params"),{}}}),L(this,"getTVFParams",(r,i,n)=>{var s,o,a;if(!((s=i.request)!=null&&s.method))return{};const c={correlationId:r,rpcMethods:[i.request.method],chainId:i.chainId};try{const l=this.extractTxHashesFromResult(i.request,n);c.txHashes=l,c.contractAddresses=this.isValidContractData(i.request.params)?[(a=(o=i.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(l){this.client.logger.warn(l,"Error getting TVF params")}return c}),L(this,"isValidContractData",r=>{var i;if(!r)return!1;try{const n=r?.data||((i=r?.[0])==null?void 0:i.data);if(!n.startsWith("0x"))return!1;const s=n.slice(2);return/^[0-9a-fA-F]*$/.test(s)?s.length%2===0:!1}catch{}return!1}),L(this,"extractTxHashesFromResult",(r,i)=>{var n;try{if(!i)return[];const s=r.method,o=kD[s];if(s==="sui_signTransaction")return[ax(i.transactionBytes)];if(s==="near_signTransaction")return[fu(i)];if(s==="near_signTransactions")return i.map(c=>fu(c));if(s==="xrpl_signTransactionFor"||s==="xrpl_signTransaction")return[(n=i.tx_json)==null?void 0:n.hash];if(s==="polkadot_signTransaction")return[lI({transaction:r.params.transactionPayload,signature:i.signature})];if(s==="algo_signTxn")return yt(i)?i.map(c=>du(c)):[du(i)];if(s==="cosmos_signDirect")return[lx(i)];if(s==="wallet_sendCalls")return ux(i);if(typeof i=="string")return[i];const a=i[o.key];if(yt(a))return s==="solana_signAllTransactions"?a.map(c=>ox(c)):a;if(typeof a=="string")return[a]}catch(s){this.client.logger.warn(s,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,r=this.client.core.relayer.messages.getWithoutAck(e);for(const[i,n]of Object.entries(r))for(const s of n)try{await this.onProviderMessageEvent({topic:i,message:s,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${i}, message: ${s}`)}}catch(e){this.client.logger.warn(e,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(he.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:r,message:i,attestation:n,transportType:s}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Wn)?this.client.auth.authKeys.get(Wn):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(r,i,{receiverPublicKey:o,encoding:s===ae.link_mode?vr:Ge});Sc(a)?(this.client.core.history.set(r,a),await this.onRelayEventRequest({topic:r,payload:a,attestation:n,transportType:s,encryptedId:dt(i)})):Rs(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a,transportType:s}),this.client.core.history.delete(r,a.id)):(this.client.logger.error(`onRelayMessage() -> unknown payload: ${JSON.stringify(a)}`),await this.onRelayEventUnknownPayload({topic:r,payload:a,transportType:s})),await this.client.core.relayer.messages.ack(r,i)}catch(a){this.client.logger.error(`onRelayMessage() -> failed to process an inbound message: ${i}`),this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(ht.expired,async e=>{const{topic:r,id:i}=Wd(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,z("EXPIRED"),!0);if(i&&this.client.auth.requests.keys.includes(i))return await this.deletePendingAuthRequest(i,z("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(Lr.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Lr.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!ge(e,!1)){const{message:r}=z("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Ut(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=z("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!ge(e,!1)){const{message:r}=z("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:r}=z("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Ut(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:r}=z("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){const{message:r}=z("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(ge(e,!1)){const{message:r}=z("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=z("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!L3(e)){const{message:r}=z("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=z("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Ut(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:r}=z("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}validateRequestExpiry(e){if(e&&!G3(e,jo)){const{message:r}=z("MISSING_OR_INVALID",`request() expiry: ${e}. Expiry must be a number (in seconds) between ${jo.min} and ${jo.max}`);throw new Error(r)}}}class XD extends ei{constructor(e,r){super(e,r,ND,$c),this.core=e,this.logger=r}}let QD=class extends ei{constructor(e,r){super(e,r,UD,$c),this.core=e,this.logger=r}};class eA extends ei{constructor(e,r){super(e,r,LD,$c,i=>i.id),this.core=e,this.logger=r}}class tA extends ei{constructor(e,r){super(e,r,zD,Us,()=>Wn),this.core=e,this.logger=r}}class rA extends ei{constructor(e,r){super(e,r,VD,Us),this.core=e,this.logger=r}}class iA extends ei{constructor(e,r){super(e,r,KD,Us,i=>i.id),this.core=e,this.logger=r}}var nA=Object.defineProperty,sA=(t,e,r)=>e in t?nA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ko=(t,e,r)=>sA(t,typeof e!="symbol"?e+"":e,r);class oA{constructor(e,r){this.core=e,this.logger=r,ko(this,"authKeys"),ko(this,"pairingTopics"),ko(this,"requests"),this.authKeys=new tA(this.core,this.logger),this.pairingTopics=new rA(this.core,this.logger),this.requests=new iA(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var aA=Object.defineProperty,cA=(t,e,r)=>e in t?aA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ee=(t,e,r)=>cA(t,typeof e!="symbol"?e+"":e,r);class Dc extends sS{constructor(e){super(e),ee(this,"protocol",bg),ee(this,"version",vg),ee(this,"name",Uo.name),ee(this,"metadata"),ee(this,"core"),ee(this,"logger"),ee(this,"events",new ot.EventEmitter),ee(this,"engine"),ee(this,"session"),ee(this,"proposal"),ee(this,"pendingRequest"),ee(this,"auth"),ee(this,"signConfig"),ee(this,"on",(i,n)=>this.events.on(i,n)),ee(this,"once",(i,n)=>this.events.once(i,n)),ee(this,"off",(i,n)=>this.events.off(i,n)),ee(this,"removeListener",(i,n)=>this.events.removeListener(i,n)),ee(this,"removeAllListeners",i=>this.events.removeAllListeners(i)),ee(this,"connect",async i=>{try{return await this.engine.connect(i)}catch(n){throw this.logger.error(n.message),n}}),ee(this,"pair",async i=>{try{return await this.engine.pair(i)}catch(n){throw this.logger.error(n.message),n}}),ee(this,"approve",async i=>{try{return await this.engine.approve(i)}catch(n){throw this.logger.error(n.message),n}}),ee(this,"reject",async i=>{try{return await this.engine.reject(i)}catch(n){throw this.logger.error(n.message),n}}),ee(this,"update",async i=>{try{return await this.engine.update(i)}catch(n){throw this.logger.error(n.message),n}}),ee(this,"extend",async i=>{try{return await this.engine.extend(i)}catch(n){throw this.logger.error(n.message),n}}),ee(this,"request",async i=>{try{return await this.engine.request(i)}catch(n){throw this.logger.error(n.message),n}}),ee(this,"respond",async i=>{try{return await this.engine.respond(i)}catch(n){throw this.logger.error(n.message),n}}),ee(this,"ping",async i=>{try{return await this.engine.ping(i)}catch(n){throw this.logger.error(n.message),n}}),ee(this,"emit",async i=>{try{return await this.engine.emit(i)}catch(n){throw this.logger.error(n.message),n}}),ee(this,"disconnect",async i=>{try{return await this.engine.disconnect(i)}catch(n){throw this.logger.error(n.message),n}}),ee(this,"find",i=>{try{return this.engine.find(i)}catch(n){throw this.logger.error(n.message),n}}),ee(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}}),ee(this,"authenticate",async(i,n)=>{try{return await this.engine.authenticate(i,n)}catch(s){throw this.logger.error(s.message),s}}),ee(this,"formatAuthMessage",i=>{try{return this.engine.formatAuthMessage(i)}catch(n){throw this.logger.error(n.message),n}}),ee(this,"approveSessionAuthenticate",async i=>{try{return await this.engine.approveSessionAuthenticate(i)}catch(n){throw this.logger.error(n.message),n}}),ee(this,"rejectSessionAuthenticate",async i=>{try{return await this.engine.rejectSessionAuthenticate(i)}catch(n){throw this.logger.error(n.message),n}}),this.name=e?.name||Uo.name,this.metadata=QE(e?.metadata),this.signConfig=e?.signConfig;const r=_c({logger:e?.logger||Uo.logger,name:this.name});this.logger=r,this.core=e?.core||new RD(e),this.session=new QD(this.core,this.logger),this.proposal=new XD(this.core,this.logger),this.pendingRequest=new eA(this.core,this.logger),this.engine=new JD(this),this.auth=new oA(this.core,this.logger)}static async init(e){const r=new Dc(e);return await r.initialize(),r}get context(){return Xe(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const lA=Dc;var Nn={exports:{}},jh;function uA(){return jh||(jh=1,(function(t,e){var r=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof Nt<"u"&&Nt,i=(function(){function s(){this.fetch=!1,this.DOMException=r.DOMException}return s.prototype=r,new s})();(function(s){(function(o){var a=typeof s<"u"&&s||typeof self<"u"&&self||typeof Nt<"u"&&Nt||{},c={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&(function(){try{return new Blob,!0}catch{return!1}})(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};function l(g){return g&&DataView.prototype.isPrototypeOf(g)}if(c.arrayBuffer)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],h=ArrayBuffer.isView||function(g){return g&&u.indexOf(Object.prototype.toString.call(g))>-1};function f(g){if(typeof g!="string"&&(g=String(g)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(g)||g==="")throw new TypeError('Invalid character in header field name: "'+g+'"');return g.toLowerCase()}function p(g){return typeof g!="string"&&(g=String(g)),g}function d(g){var w={next:function(){var I=g.shift();return{done:I===void 0,value:I}}};return c.iterable&&(w[Symbol.iterator]=function(){return w}),w}function y(g){this.map={},g instanceof y?g.forEach(function(w,I){this.append(I,w)},this):Array.isArray(g)?g.forEach(function(w){if(w.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+w.length);this.append(w[0],w[1])},this):g&&Object.getOwnPropertyNames(g).forEach(function(w){this.append(w,g[w])},this)}y.prototype.append=function(g,w){g=f(g),w=p(w);var I=this.map[g];this.map[g]=I?I+", "+w:w},y.prototype.delete=function(g){delete this.map[f(g)]},y.prototype.get=function(g){return g=f(g),this.has(g)?this.map[g]:null},y.prototype.has=function(g){return this.map.hasOwnProperty(f(g))},y.prototype.set=function(g,w){this.map[f(g)]=p(w)},y.prototype.forEach=function(g,w){for(var I in this.map)this.map.hasOwnProperty(I)&&g.call(w,this.map[I],I,this)},y.prototype.keys=function(){var g=[];return this.forEach(function(w,I){g.push(I)}),d(g)},y.prototype.values=function(){var g=[];return this.forEach(function(w){g.push(w)}),d(g)},y.prototype.entries=function(){var g=[];return this.forEach(function(w,I){g.push([I,w])}),d(g)},c.iterable&&(y.prototype[Symbol.iterator]=y.prototype.entries);function m(g){if(!g._noBody){if(g.bodyUsed)return Promise.reject(new TypeError("Already read"));g.bodyUsed=!0}}function x(g){return new Promise(function(w,I){g.onload=function(){w(g.result)},g.onerror=function(){I(g.error)}})}function O(g){var w=new FileReader,I=x(w);return w.readAsArrayBuffer(g),I}function v(g){var w=new FileReader,I=x(w),P=/charset=([A-Za-z0-9_-]+)/.exec(g.type),S=P?P[1]:"utf-8";return w.readAsText(g,S),I}function b(g){for(var w=new Uint8Array(g),I=new Array(w.length),P=0;P<w.length;P++)I[P]=String.fromCharCode(w[P]);return I.join("")}function E(g){if(g.slice)return g.slice(0);var w=new Uint8Array(g.byteLength);return w.set(new Uint8Array(g)),w.buffer}function _(){return this.bodyUsed=!1,this._initBody=function(g){this.bodyUsed=this.bodyUsed,this._bodyInit=g,g?typeof g=="string"?this._bodyText=g:c.blob&&Blob.prototype.isPrototypeOf(g)?this._bodyBlob=g:c.formData&&FormData.prototype.isPrototypeOf(g)?this._bodyFormData=g:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(g)?this._bodyText=g.toString():c.arrayBuffer&&c.blob&&l(g)?(this._bodyArrayBuffer=E(g.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(g)||h(g))?this._bodyArrayBuffer=E(g):this._bodyText=g=Object.prototype.toString.call(g):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof g=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(g)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var g=m(this);if(g)return g;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var g=m(this);return g||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(c.blob)return this.blob().then(O);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var g=m(this);if(g)return g;if(this._bodyBlob)return v(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(b(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(N)}),this.json=function(){return this.text().then(JSON.parse)},this}var C=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function B(g){var w=g.toUpperCase();return C.indexOf(w)>-1?w:g}function A(g,w){if(!(this instanceof A))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');w=w||{};var I=w.body;if(g instanceof A){if(g.bodyUsed)throw new TypeError("Already read");this.url=g.url,this.credentials=g.credentials,w.headers||(this.headers=new y(g.headers)),this.method=g.method,this.mode=g.mode,this.signal=g.signal,!I&&g._bodyInit!=null&&(I=g._bodyInit,g.bodyUsed=!0)}else this.url=String(g);if(this.credentials=w.credentials||this.credentials||"same-origin",(w.headers||!this.headers)&&(this.headers=new y(w.headers)),this.method=B(w.method||this.method||"GET"),this.mode=w.mode||this.mode||null,this.signal=w.signal||this.signal||(function(){if("AbortController"in a){var $=new AbortController;return $.signal}})(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&I)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(I),(this.method==="GET"||this.method==="HEAD")&&(w.cache==="no-store"||w.cache==="no-cache")){var P=/([?&])_=[^&]*/;if(P.test(this.url))this.url=this.url.replace(P,"$1_="+new Date().getTime());else{var S=/\?/;this.url+=(S.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}A.prototype.clone=function(){return new A(this,{body:this._bodyInit})};function N(g){var w=new FormData;return g.trim().split("&").forEach(function(I){if(I){var P=I.split("="),S=P.shift().replace(/\+/g," "),$=P.join("=").replace(/\+/g," ");w.append(decodeURIComponent(S),decodeURIComponent($))}}),w}function j(g){var w=new y,I=g.replace(/\r?\n[\t ]+/g," ");return I.split("\r").map(function(P){return P.indexOf(`
`)===0?P.substr(1,P.length):P}).forEach(function(P){var S=P.split(":"),$=S.shift().trim();if($){var U=S.join(":").trim();try{w.append($,U)}catch(k){console.warn("Response "+k.message)}}}),w}_.call(A.prototype);function R(g,w){if(!(this instanceof R))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(w||(w={}),this.type="default",this.status=w.status===void 0?200:w.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=w.statusText===void 0?"":""+w.statusText,this.headers=new y(w.headers),this.url=w.url||"",this._initBody(g)}_.call(R.prototype),R.prototype.clone=function(){return new R(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new y(this.headers),url:this.url})},R.error=function(){var g=new R(null,{status:200,statusText:""});return g.ok=!1,g.status=0,g.type="error",g};var D=[301,302,303,307,308];R.redirect=function(g,w){if(D.indexOf(w)===-1)throw new RangeError("Invalid status code");return new R(null,{status:w,headers:{location:g}})},o.DOMException=a.DOMException;try{new o.DOMException}catch{o.DOMException=function(w,I){this.message=w,this.name=I;var P=Error(w);this.stack=P.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function T(g,w){return new Promise(function(I,P){var S=new A(g,w);if(S.signal&&S.signal.aborted)return P(new o.DOMException("Aborted","AbortError"));var $=new XMLHttpRequest;function U(){$.abort()}$.onload=function(){var F={statusText:$.statusText,headers:j($.getAllResponseHeaders()||"")};S.url.indexOf("file://")===0&&($.status<200||$.status>599)?F.status=200:F.status=$.status,F.url="responseURL"in $?$.responseURL:F.headers.get("X-Request-URL");var q="response"in $?$.response:$.responseText;setTimeout(function(){I(new R(q,F))},0)},$.onerror=function(){setTimeout(function(){P(new TypeError("Network request failed"))},0)},$.ontimeout=function(){setTimeout(function(){P(new TypeError("Network request timed out"))},0)},$.onabort=function(){setTimeout(function(){P(new o.DOMException("Aborted","AbortError"))},0)};function k(F){try{return F===""&&a.location.href?a.location.href:F}catch{return F}}if($.open(S.method,k(S.url),!0),S.credentials==="include"?$.withCredentials=!0:S.credentials==="omit"&&($.withCredentials=!1),"responseType"in $&&(c.blob?$.responseType="blob":c.arrayBuffer&&($.responseType="arraybuffer")),w&&typeof w.headers=="object"&&!(w.headers instanceof y||a.Headers&&w.headers instanceof a.Headers)){var V=[];Object.getOwnPropertyNames(w.headers).forEach(function(F){V.push(f(F)),$.setRequestHeader(F,p(w.headers[F]))}),S.headers.forEach(function(F,q){V.indexOf(q)===-1&&$.setRequestHeader(q,F)})}else S.headers.forEach(function(F,q){$.setRequestHeader(q,F)});S.signal&&(S.signal.addEventListener("abort",U),$.onreadystatechange=function(){$.readyState===4&&S.signal.removeEventListener("abort",U)}),$.send(typeof S._bodyInit>"u"?null:S._bodyInit)})}return T.polyfill=!0,a.fetch||(a.fetch=T,a.Headers=y,a.Request=A,a.Response=R),o.Headers=y,o.Request=A,o.Response=R,o.fetch=T,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(i),i.fetch.ponyfill=!0,delete i.fetch.polyfill;var n=r.fetch?r:i;e=n.fetch,e.default=n.fetch,e.fetch=n.fetch,e.Headers=n.Headers,e.Request=n.Request,e.Response=n.Response,t.exports=e})(Nn,Nn.exports)),Nn.exports}var hA=uA();const kh=df(hA);var fA=Object.defineProperty,dA=Object.defineProperties,pA=Object.getOwnPropertyDescriptors,Lh=Object.getOwnPropertySymbols,gA=Object.prototype.hasOwnProperty,yA=Object.prototype.propertyIsEnumerable,Fh=(t,e,r)=>e in t?fA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Mh=(t,e)=>{for(var r in e||(e={}))gA.call(e,r)&&Fh(t,r,e[r]);if(Lh)for(var r of Lh(e))yA.call(e,r)&&Fh(t,r,e[r]);return t},qh=(t,e)=>dA(t,pA(e));const wA={Accept:"application/json","Content-Type":"application/json"},mA="POST",zh={headers:wA,method:mA},Vh=10;let xg=class{constructor(e,r=!1){if(this.url=e,this.disableProviderPing=r,this.events=new ot.EventEmitter,this.isAvailable=!1,this.registering=!1,!oh(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const r=Wr(e),i=await(await kh(this.url,qh(Mh({},zh),{body:r}))).json();this.onPayload({data:i})}catch(r){this.onError(e.id,r)}}async register(e=this.url){if(!oh(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,n)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),n(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return n(new Error("HTTP connection is missing or invalid"));i()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const r=Wr({id:1,jsonrpc:"2.0",method:"test",params:[]});await kh(e,qh(Mh({},zh),{body:r}))}this.onOpen()}catch(r){const i=this.parseError(r);throw this.events.emit("register_error",i),this.onClose(),i}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Hr(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),n=i.message||i.toString(),s=Ts(e,n);this.events.emit("payload",s)}parseError(e,r=this.url){return Xp(e,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Vh&&this.events.setMaxListeners(Vh)}};function bA(t){return Number.isSafeInteger(t)&&t>=0}function vA(t){return t!=null&&typeof t!="function"&&bA(t.length)}function EA(t){return t==="__proto__"}function Ac(t){return t==null||typeof t!="object"&&typeof t!="function"}function _g(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Pc(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const xA="[object RegExp]",Ig="[object String]",Sg="[object Number]",Og="[object Boolean]",$g="[object Arguments]",_A="[object Symbol]",IA="[object Date]",SA="[object Map]",OA="[object Set]",$A="[object Array]",DA="[object ArrayBuffer]",Dg="[object Object]",AA="[object DataView]",PA="[object Uint8Array]",CA="[object Uint8ClampedArray]",BA="[object Uint16Array]",TA="[object Uint32Array]",RA="[object Int8Array]",NA="[object Int16Array]",UA="[object Int32Array]",jA="[object Float32Array]",kA="[object Float64Array]";function Cc(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function LA(t,e){return fi(t,void 0,t,new Map,e)}function fi(t,e,r,i=new Map,n=void 0){const s=n?.(t,e,r,i);if(s!==void 0)return s;if(Ac(t))return t;if(i.has(t))return i.get(t);if(Array.isArray(t)){const o=new Array(t.length);i.set(t,o);for(let a=0;a<t.length;a++)o[a]=fi(t[a],a,r,i,n);return Object.hasOwn(t,"index")&&(o.index=t.index),Object.hasOwn(t,"input")&&(o.input=t.input),o}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){const o=new RegExp(t.source,t.flags);return o.lastIndex=t.lastIndex,o}if(t instanceof Map){const o=new Map;i.set(t,o);for(const[a,c]of t)o.set(a,fi(c,a,r,i,n));return o}if(t instanceof Set){const o=new Set;i.set(t,o);for(const a of t)o.add(fi(a,void 0,r,i,n));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(t))return t.subarray();if(Cc(t)){const o=new(Object.getPrototypeOf(t)).constructor(t.length);i.set(t,o);for(let a=0;a<t.length;a++)o[a]=fi(t[a],a,r,i,n);return o}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){const o=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return i.set(t,o),_t(o,t,r,i,n),o}if(typeof File<"u"&&t instanceof File){const o=new File([t],t.name,{type:t.type});return i.set(t,o),_t(o,t,r,i,n),o}if(typeof Blob<"u"&&t instanceof Blob){const o=new Blob([t],{type:t.type});return i.set(t,o),_t(o,t,r,i,n),o}if(t instanceof Error){const o=new t.constructor;return i.set(t,o),o.message=t.message,o.name=t.name,o.stack=t.stack,o.cause=t.cause,_t(o,t,r,i,n),o}if(t instanceof Boolean){const o=new Boolean(t.valueOf());return i.set(t,o),_t(o,t,r,i,n),o}if(t instanceof Number){const o=new Number(t.valueOf());return i.set(t,o),_t(o,t,r,i,n),o}if(t instanceof String){const o=new String(t.valueOf());return i.set(t,o),_t(o,t,r,i,n),o}if(typeof t=="object"&&FA(t)){const o=Object.create(Object.getPrototypeOf(t));return i.set(t,o),_t(o,t,r,i,n),o}return t}function _t(t,e,r=t,i,n){const s=[...Object.keys(e),..._g(e)];for(let o=0;o<s.length;o++){const a=s[o],c=Object.getOwnPropertyDescriptor(t,a);(c==null||c.writable)&&(t[a]=fi(e[a],a,r,i,n))}}function FA(t){switch(Pc(t)){case $g:case $A:case DA:case AA:case Og:case IA:case jA:case kA:case RA:case NA:case UA:case SA:case Sg:case Dg:case xA:case OA:case Ig:case _A:case PA:case CA:case BA:case TA:return!0;default:return!1}}function MA(t,e){return LA(t,(r,i,n,s)=>{if(typeof t=="object"){if(Pc(t)===Dg&&typeof t.constructor!="function"){const o={};return s.set(t,o),_t(o,t,n,s),o}switch(Object.prototype.toString.call(t)){case Sg:case Ig:case Og:{const o=new t.constructor(t?.valueOf());return _t(o,t),o}case $g:{const o={};return _t(o,t),o.length=t.length,o[Symbol.iterator]=t[Symbol.iterator],o}default:return}}})}function Kh(t){return MA(t)}function Hh(t){return t!==null&&typeof t=="object"&&Pc(t)==="[object Arguments]"}function qa(t){return typeof t=="object"&&t!==null}function qA(t){return qa(t)&&vA(t)}function zA(){}function Lo(t){return Cc(t)}function Fo(t){if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){const r=t[Symbol.toStringTag];return r==null||!Object.getOwnPropertyDescriptor(t,Symbol.toStringTag)?.writable?!1:t.toString()===`[object ${r}]`}let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function VA(t){if(Ac(t))return t;if(Array.isArray(t)||Cc(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);const e=Object.getPrototypeOf(t);if(e==null)return Object.assign(Object.create(e),t);const r=e.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new r(t);if(t instanceof RegExp){const i=new r(t);return i.lastIndex=t.lastIndex,i}if(t instanceof DataView)return new r(t.buffer.slice(0));if(t instanceof Error){let i;return t instanceof AggregateError?i=new r(t.errors,t.message,{cause:t.cause}):i=new r(t.message,{cause:t.cause}),i.stack=t.stack,Object.assign(i,t),i}if(typeof File<"u"&&t instanceof File)return new r([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){const i=Object.create(e);return Object.assign(i,t)}return t}function KA(t,...e){const r=e.slice(0,-1),i=e[e.length-1];let n=t;for(let s=0;s<r.length;s++){const o=r[s];n=za(n,o,i,new Map)}return n}function za(t,e,r,i){if(Ac(t)&&(t=Object(t)),e==null||typeof e!="object")return t;if(i.has(e))return VA(i.get(e));if(i.set(e,t),Array.isArray(e)){e=e.slice();for(let s=0;s<e.length;s++)e[s]=e[s]??void 0}const n=[...Object.keys(e),..._g(e)];for(let s=0;s<n.length;s++){const o=n[s];if(EA(o))continue;let a=e[o],c=t[o];if(Hh(a)&&(a={...a}),Hh(c)&&(c={...c}),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=Kh(a)),Array.isArray(a))if(Array.isArray(c)){const u=[],h=Reflect.ownKeys(c);for(let f=0;f<h.length;f++){const p=h[f];u[p]=c[p]}c=u}else if(qA(c)){const u=[];for(let h=0;h<c.length;h++)u[h]=c[h];c=u}else c=[];const l=r(c,a,o,t,e,i);l!==void 0?t[o]=l:Array.isArray(a)||qa(c)&&qa(a)&&(Fo(c)||Fo(a)||Lo(c)||Lo(a))?t[o]=za(c,a,r,i):c==null&&Fo(a)?t[o]=za({},a,r,i):c==null&&Lo(a)?t[o]=Kh(a):(c===void 0||a!==void 0)&&(t[o]=a)}return t}function HA(t,...e){return KA(t,...e,zA)}const Wh="error",WA="wss://relay.walletconnect.org",GA="wc",Ag="universal_provider",Un=`${GA}@2:${Ag}:`,Pg="https://rpc.walletconnect.org/v1/",Cg="generic",YA=`${Pg}bundler`,wi="call_status",ZA=86400,Bc={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var JA=Object.defineProperty,XA=Object.defineProperties,QA=Object.getOwnPropertyDescriptors,Gh=Object.getOwnPropertySymbols,eP=Object.prototype.hasOwnProperty,tP=Object.prototype.propertyIsEnumerable,Yh=(t,e,r)=>e in t?JA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,jn=(t,e)=>{for(var r in e||(e={}))eP.call(e,r)&&Yh(t,r,e[r]);if(Gh)for(var r of Gh(e))tP.call(e,r)&&Yh(t,r,e[r]);return t},rP=(t,e)=>XA(t,QA(e));function Bg(t,e,r){var i;const n=ir(t);return((i=e.rpcMap)==null?void 0:i[n.reference])||`${Pg}?chainId=${n.namespace}:${n.reference}&projectId=${r}`}function iP(t){return t.includes(":")?t.split(":")[1]:t}function Tg(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function nP(t,e){const r=Object.keys(e.namespaces).filter(n=>n.includes(t));if(!r.length)return[];const i=[];return r.forEach(n=>{const s=e.namespaces[n].accounts;i.push(...s)}),i}function Zh(t){return Object.fromEntries(Object.entries(t).filter(([e,r])=>{var i,n;return((i=r?.chains)==null?void 0:i.length)&&((n=r?.chains)==null?void 0:n.length)>0}))}function kn(t={},e={}){const r=Zh(Jh(t)),i=Zh(Jh(e));return HA(r,i)}function Jh(t){var e,r,i,n,s;const o={};if(!Ft(t))return o;for(const[a,c]of Object.entries(t)){const l=Bs(a)?[a]:c.chains,u=c.methods||[],h=c.events||[],f=c.rpcMap||{},p=hi(a);o[p]=rP(jn(jn({},o[p]),c),{chains:Lt(l,(e=o[p])==null?void 0:e.chains),methods:Lt(u,(r=o[p])==null?void 0:r.methods),events:Lt(h,(i=o[p])==null?void 0:i.events)}),(Ft(f)||Ft(((n=o[p])==null?void 0:n.rpcMap)||{}))&&(o[p].rpcMap=jn(jn({},f),(s=o[p])==null?void 0:s.rpcMap))}return o}function Xh(t){return t.includes(":")?t.split(":")[2]:t}function Qh(t){const e={};for(const[r,i]of Object.entries(t)){const n=i.methods||[],s=i.events||[],o=i.accounts||[],a=Bs(r)?[r]:i.chains?i.chains:Tg(i.accounts);e[r]={chains:a,methods:n,events:s,accounts:o}}return e}function Mo(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}function sP(t){try{const e=JSON.parse(t);return typeof e=="object"&&e!==null&&!Array.isArray(e)}catch{return!1}}const Rg={},mi=t=>Rg[t],qo=(t,e)=>{Rg[t]=e};var oP=Object.defineProperty,ef=Object.getOwnPropertySymbols,aP=Object.prototype.hasOwnProperty,cP=Object.prototype.propertyIsEnumerable,tf=(t,e,r)=>e in t?oP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,rf=(t,e)=>{for(var r in e||(e={}))aP.call(e,r)&&tf(t,r,e[r]);if(ef)for(var r of ef(e))cP.call(e,r)&&tf(t,r,e[r]);return t};const nf="eip155",lP=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],uP=t=>t&&t.startsWith("0x")?BigInt(t).toString(10):t,zo=t=>t&&t.startsWith("0x")?t:`0x${BigInt(t).toString(16)}`,sf=t=>Object.keys(t).filter(e=>lP.includes(e)).reduce((e,r)=>(e[r]=hP(t[r]),e),{}),hP=t=>typeof t=="string"&&sP(t)?JSON.parse(t):t,fP=(t,e,r)=>{const{sessionProperties:i={},scopedProperties:n={}}=t,s={};if(!Ft(n)&&!Ft(i))return;const o=sf(i);for(const a of r){const c=uP(a);if(!c)continue;s[zo(c)]=o;const l=n?.[`${nf}:${c}`];if(l){const u=l?.[`${nf}:${c}:${e}`];s[zo(c)]=rf(rf({},s[zo(c)]),sf(u||l))}}for(const[a,c]of Object.entries(s))Object.keys(c).length===0&&delete s[a];return Object.keys(s).length>0?s:void 0};var dP=Object.defineProperty,pP=(t,e,r)=>e in t?dP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,gP=(t,e,r)=>pP(t,e+"",r);let Vo,yP=class Ng{constructor(e){gP(this,"storage"),this.storage=e}async getItem(e){return await this.storage.getItem(e)}async setItem(e,r){return await this.storage.setItem(e,r)}async removeItem(e){return await this.storage.removeItem(e)}static getStorage(e){return Vo||(Vo=new Ng(e)),Vo}};var wP=Object.defineProperty,mP=Object.defineProperties,bP=Object.getOwnPropertyDescriptors,of=Object.getOwnPropertySymbols,vP=Object.prototype.hasOwnProperty,EP=Object.prototype.propertyIsEnumerable,af=(t,e,r)=>e in t?wP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,xP=(t,e)=>{for(var r in e||(e={}))vP.call(e,r)&&af(t,r,e[r]);if(of)for(var r of of(e))EP.call(e,r)&&af(t,r,e[r]);return t},_P=(t,e)=>mP(t,bP(e));async function IP(t,e){const r=ir(t.result.capabilities.caip345.caip2),i=t.result.capabilities.caip345.transactionHashes,n=await Promise.allSettled(i.map(h=>SP(r.reference,h,e))),s=n.filter(h=>h.status==="fulfilled").map(h=>h.value).filter(h=>h);n.filter(h=>h.status==="rejected").forEach(h=>console.warn("Failed to fetch transaction receipt:",h.reason));const o=!s.length||s.some(h=>!h),a=s.every(h=>h?.status==="0x1"),c=s.every(h=>h?.status==="0x0"),l=s.some(h=>h?.status==="0x0");let u;return o?u=100:a?u=200:c?u=500:l&&(u=600),{id:t.result.id,version:t.request.version,atomic:t.request.atomicRequired,chainId:t.request.chainId,capabilities:t.result.capabilities,receipts:s,status:u}}async function SP(t,e,r){return await r(parseInt(t)).request(It("eth_getTransactionReceipt",[e]))}async function OP({sendCalls:t,storage:e}){const r=await e.getItem(wi);await e.setItem(wi,_P(xP({},r),{[t.result.id]:{request:t.request,result:t.result,expiry:pe(ZA)}}))}async function $P({resultId:t,storage:e}){const r=await e.getItem(wi);if(r){delete r[t],await e.setItem(wi,r);for(const i in r)Ut(r[i].expiry)&&delete r[i];await e.setItem(wi,r)}}async function DP({resultId:t,storage:e}){const r=await e.getItem(wi),i=r?.[t];if(i&&!Ut(i.expiry))return i;await $P({resultId:t,storage:e})}var AP=Object.defineProperty,PP=Object.defineProperties,CP=Object.getOwnPropertyDescriptors,cf=Object.getOwnPropertySymbols,BP=Object.prototype.hasOwnProperty,TP=Object.prototype.propertyIsEnumerable,Va=(t,e,r)=>e in t?AP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ko=(t,e)=>{for(var r in e||(e={}))BP.call(e,r)&&Va(t,r,e[r]);if(cf)for(var r of cf(e))TP.call(e,r)&&Va(t,r,e[r]);return t},Ho=(t,e)=>PP(t,CP(e)),Nr=(t,e,r)=>Va(t,typeof e!="symbol"?e+"":e,r);class RP{constructor(e){Nr(this,"name","eip155"),Nr(this,"client"),Nr(this,"chainId"),Nr(this,"namespace"),Nr(this,"httpProviders"),Nr(this,"events"),Nr(this,"storage"),this.namespace=e.namespace,this.events=mi("events"),this.client=mi("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=yP.getStorage(this.client.core.storage)}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e);case"wallet_sendCalls":return await this.sendCalls(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(parseInt(e),r);const i=this.chainId;this.chainId=parseInt(e),this.events.emit(Bc.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${i}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,r){const i=r||Bg(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Oc(new xg(i,mi("disableProviderPing")))}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const n=parseInt(iP(r));e[n]=this.createHttpProvider(n,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(e){const r=e||this.chainId;return this.httpProviders[r]||(this.httpProviders=Ho(Ko({},this.httpProviders),{[r]:this.createHttpProvider(r)}),this.httpProviders[r])}async handleSwitchChain(e){var r,i;let n=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";n=n.startsWith("0x")?n:`0x${n}`;const s=parseInt(n,16);if(this.isChainApproved(s))this.setDefaultChain(`${s}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:n}]},chainId:(i=this.namespace.chains)==null?void 0:i[0]}),this.setDefaultChain(`${s}`);else throw new Error(`Failed to switch to chain 'eip155:${s}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var r,i,n,s,o;const a=(i=(r=e.request)==null?void 0:r.params)==null?void 0:i[0],c=((s=(n=e.request)==null?void 0:n.params)==null?void 0:s[1])||[];if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const l=this.client.session.get(e.topic),u=((o=l?.sessionProperties)==null?void 0:o.capabilities)||{},h=c.length>0?c.join(","):`0x${this.chainId.toString(16)}`,f=`${a}${h}`,p=u?.[f];if(p)return p;let d;try{d=fP(l,a,c)}catch(m){console.warn("Failed to extract capabilities from session",m)}if(d)return d;const y=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:Ho(Ko({},l.sessionProperties||{}),{capabilities:Ho(Ko({},u||{}),{[f]:y})})})}catch(m){console.warn("Failed to update session with capabilities",m)}return y}async getCallStatus(e){var r,i,n;const s=this.client.session.get(e.topic),o=(r=s.sessionProperties)==null?void 0:r.bundler_name;if(o){const l=this.getBundlerUrl(e.chainId,o);try{return await this.getUserOperationReceipt(l,e)}catch(u){console.warn("Failed to fetch call status from bundler",u,l)}}const a=(i=s.sessionProperties)==null?void 0:i.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(l){console.warn("Failed to fetch call status from custom bundler",l,a)}const c=await DP({resultId:(n=e.request.params)==null?void 0:n[0],storage:this.storage});if(c)try{return await IP(c,this.getHttpProvider.bind(this))}catch(l){console.warn("Failed to fetch call status from stored send calls",l,c)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,r){var i;const n=new URL(e),s=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(It("eth_getUserOperationReceipt",[(i=r.request.params)==null?void 0:i[0]]))});if(!s.ok)throw new Error(`Failed to fetch user operation receipt - ${s.status}`);return await s.json()}getBundlerUrl(e,r){return`${YA}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${r}`}async sendCalls(e){var r,i,n;const s=await this.client.request(e),o=(r=e.request.params)==null?void 0:r[0],a=s?.id,c=s?.capabilities||{},l=(i=c?.caip345)==null?void 0:i.caip2,u=(n=c?.caip345)==null?void 0:n.transactionHashes;return!a||!l||!(u!=null&&u.length)||await OP({sendCalls:{request:o,result:s},storage:this.storage}),s}}var NP=Object.defineProperty,UP=(t,e,r)=>e in t?NP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ci=(t,e,r)=>UP(t,typeof e!="symbol"?e+"":e,r);class jP{constructor(e){ci(this,"name",Cg),ci(this,"client"),ci(this,"httpProviders"),ci(this,"events"),ci(this,"namespace"),ci(this,"chainId"),this.namespace=e.namespace,this.events=mi("events"),this.client=mi("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r);const i=this.chainId;this.chainId=e,this.events.emit(Bc.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${i}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getNamespaceName(){const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return ir(e).namespace}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){var e,r;const i={};return(r=(e=this.namespace)==null?void 0:e.accounts)==null||r.forEach(n=>{var s,o;const a=ir(n),c=(o=(s=this.namespace)==null?void 0:s.rpcMap)==null?void 0:o[`${a.namespace}:${a.reference}`];i[a.reference]=this.createHttpProvider(n,c)}),i}getHttpProvider(e){const r=ir(e).reference,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Bg(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Oc(new xg(i,mi("disableProviderPing")))}}var kP=Object.defineProperty,LP=Object.defineProperties,FP=Object.getOwnPropertyDescriptors,lf=Object.getOwnPropertySymbols,MP=Object.prototype.hasOwnProperty,qP=Object.prototype.propertyIsEnumerable,Ka=(t,e,r)=>e in t?kP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ji=(t,e)=>{for(var r in e||(e={}))MP.call(e,r)&&Ka(t,r,e[r]);if(lf)for(var r of lf(e))qP.call(e,r)&&Ka(t,r,e[r]);return t},Ln=(t,e)=>LP(t,FP(e)),et=(t,e,r)=>Ka(t,typeof e!="symbol"?e+"":e,r);let zP=class Ug{constructor(e){et(this,"client"),et(this,"namespaces"),et(this,"optionalNamespaces"),et(this,"sessionProperties"),et(this,"scopedProperties"),et(this,"events",new Wa),et(this,"rpcProviders",{}),et(this,"session"),et(this,"providerOpts"),et(this,"logger"),et(this,"uri"),et(this,"disableProviderPing",!1),et(this,"connectParams");var r,i;this.providerOpts=e,this.logger=_c({logger:(r=e.logger)!=null?r:Wh,name:(i=this.providerOpts.name)!=null?i:Ag}),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){const r=new Ug(e);return await r.initialize(),r}async request(e,r,i){const[n,s]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:ji({},e),chainId:`${n}:${s}`,topic:this.session.topic,expiry:i})}sendAsync(e,r,i,n){const s=new Date().getTime();this.request(e,i,n).then(o=>r(null,rn(s,o))).catch(o=>r(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:ce("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.connectParams=e,this.setNamespaces(e),this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,r){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:i,response:n}=await this.client.authenticate(e,r);i&&(this.uri=i,this.events.emit("display_uri",i));const s=await n();if(this.session=s.session,this.session){const o=Qh(this.session.namespaces);this.namespaces=kn(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return s}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){var r,i;const{uri:n,approval:s}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties,authentication:(r=this.connectParams)==null?void 0:r.authentication,walletPay:(i=this.connectParams)==null?void 0:i.walletPay});n&&(this.uri=n,this.events.emit("display_uri",n));const o=await s();this.session=o;const a=Qh(o.namespaces);return this.namespaces=kn(this.namespaces,a),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,r){try{if(!this.session)return;const[i,n]=this.validateChain(e),s=this.getProvider(i);s?s.setDefaultChain(n,r):this.session&&this.logger.warn(`Provider for namespace '${i}' not found in setDefaultChain`)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){try{this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(!yt(r))return;for(const i of r)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}catch(r){this.logger.warn(r,"Failed to cleanup pending pairings")}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,r;if(this.client=this.providerOpts.client||await lA.init({core:this.providerOpts.core,logger:this.providerOpts.logger||Wh,relayUrl:this.providerOpts.relayUrl||WA,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(i){throw this.logger.error(i,"Failed to get session"),new Error(`The provided session: ${(r=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:r.topic} doesn't exist in the Sign client`)}else{const i=this.client.session.getAll();this.session=i[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(r=>hi(r)))];qo("client",this.client),qo("events",this.events),qo("disableProviderPing",this.disableProviderPing),e.forEach(r=>{if(!this.session)return;const i=nP(r,this.session);if(i?.length===0)return;const n=Tg(i),s=kn(this.namespaces,this.optionalNamespaces),o=Ln(ji({},s[r]),{accounts:i,chains:n});r==="eip155"?this.rpcProviders[r]=new RP({namespace:o}):this.rpcProviders[r]=new jP({namespace:o})})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var r;const{topic:i}=e;i===((r=this.session)==null?void 0:r.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var r;const{params:i,topic:n}=e;if(n!==((r=this.session)==null?void 0:r.topic))return;const{event:s}=i;if(s.name==="accountsChanged"){const o=s.data;o&&yt(o)&&this.events.emit("accountsChanged",o.map(Xh))}else if(s.name==="chainChanged"){const o=i.chainId,a=i.event.data,c=hi(o),l=Mo(o)!==Mo(a)?`${c}:${Mo(a)}`:o;this.onChainChanged({currentCaipChainId:l})}else this.events.emit(s.name,s.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var i,n;if(e!==((i=this.session)==null?void 0:i.topic))return;const{namespaces:s}=r,o=(n=this.client)==null?void 0:n.session.get(e);this.session=Ln(ji({},o),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",async e=>{var r;e.topic===((r=this.session)==null?void 0:r.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",Ln(ji({},ce("USER_DISCONNECTED")),{data:e.topic})))}),this.on(Bc.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(Ln(ji({},e),{internal:!0}))})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[Cg]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var r;this.getProvider(e).updateNamespace((r=this.session)==null?void 0:r.namespaces[e])})}setNamespaces(e){const{namespaces:r={},optionalNamespaces:i={},sessionProperties:n,scopedProperties:s}=e;this.optionalNamespaces=kn(r,i),this.sessionProperties=n,this.scopedProperties=s}validateChain(e){const[r,i]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,i];if(r&&!Object.keys(this.namespaces||{}).map(o=>hi(o)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&i)return[r,i];const n=hi(Object.keys(this.namespaces)[0]),s=this.rpcProviders[n].getDefaultChain();return[n,s]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged({currentCaipChainId:e,previousCaipChainId:r,internal:i=!1}){if(!this.namespaces)return;const[n,s]=this.validateChain(e);if(s){if(this.updateNamespaceChain(n,s),i)this.events.emit("chainChanged",s),this.emitAccountsChangedOnChainChange({namespace:n,currentCaipChainId:e,previousCaipChainId:r});else{const o=this.getProvider(n);o?o.setDefaultChain(s):this.session&&this.logger.warn(`Provider for namespace '${n}' not found during chain change`)}await this.persist("namespaces",this.namespaces)}}emitAccountsChangedOnChainChange({namespace:e,currentCaipChainId:r,previousCaipChainId:i}){var n,s;try{if(i===r)return;const o=(s=(n=this.session)==null?void 0:n.namespaces[e])==null?void 0:s.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${r}:`)).map(Xh);if(!yt(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn(o,"Failed to emit accountsChanged on chain change")}}updateNamespaceChain(e,r){if(!this.namespaces)return;const i=this.namespaces[e]?e:`${e}:${r}`,n={chains:[],methods:[],events:[],defaultChain:r};this.namespaces[i]?this.namespaces[i]&&(this.namespaces[i].defaultChain=r):this.namespaces[i]=n}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.connectParams=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,r){var i;const n=((i=this.session)==null?void 0:i.topic)||"";await this.client.core.storage.setItem(`${Un}/${e}${n}`,r)}async getFromStore(e){var r;const i=((r=this.session)==null?void 0:r.topic)||"";return await this.client.core.storage.getItem(`${Un}/${e}${i}`)}async deleteFromStore(e){var r;const i=((r=this.session)==null?void 0:r.topic)||"";await this.client.core.storage.removeItem(`${Un}/${e}${i}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const r=await this.client.core.storage.getKeys();for(const i of r)i.startsWith(Un)&&await this.client.core.storage.removeItem(i)}catch(r){this.logger.warn(r,"Failed to cleanup storage")}}};const VP=zP,KP="wc",HP="ethereum_provider",WP=`${KP}@2:${HP}:`,GP="https://rpc.walletconnect.org/v1/",hs=["eth_sendTransaction","personal_sign"],jg=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],fs=["chainChanged","accountsChanged"],kg=["chainChanged","accountsChanged","message","disconnect","connect"],YP=async()=>{const{createAppKit:t}=await Qg(()=>import("./core-Ckl7Ewkx.js").then(e=>e.a5),__vite__mapDeps([0,1,2,3]));return t};var ZP=Object.defineProperty,JP=Object.defineProperties,XP=Object.getOwnPropertyDescriptors,uf=Object.getOwnPropertySymbols,QP=Object.prototype.hasOwnProperty,e6=Object.prototype.propertyIsEnumerable,Ha=(t,e,r)=>e in t?ZP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,jr=(t,e)=>{for(var r in e||(e={}))QP.call(e,r)&&Ha(t,r,e[r]);if(uf)for(var r of uf(e))e6.call(e,r)&&Ha(t,r,e[r]);return t},ki=(t,e)=>JP(t,XP(e)),tt=(t,e,r)=>Ha(t,typeof e!="symbol"?e+"":e,r);function ds(t){return Number(t[0].split(":")[1])}function Fn(t){return`0x${t.toString(16)}`}function t6(t){const{chains:e,optionalChains:r,methods:i,optionalMethods:n,events:s,optionalEvents:o,rpcMap:a}=t;if(!yt(e))throw new Error("Invalid chains");const c={chains:e,methods:i||hs,events:s||fs,rpcMap:jr({},e.length?{[ds(e)]:a[ds(e)]}:{})},l=s?.filter(p=>!fs.includes(p)),u=i?.filter(p=>!hs.includes(p));if(!r&&!o&&!n&&!(l!=null&&l.length)&&!(u!=null&&u.length))return{required:e.length?c:void 0};const h=l?.length&&u?.length||!r,f={chains:[...new Set(h?c.chains.concat(r||[]):r)],methods:[...new Set(c.methods.concat(n!=null&&n.length?n:jg))],events:[...new Set(c.events.concat(o!=null&&o.length?o:kg))],rpcMap:a};return{required:e.length?c:void 0,optional:r.length?f:void 0}}class js{constructor(){tt(this,"events",new ot.EventEmitter),tt(this,"namespace","eip155"),tt(this,"accounts",[]),tt(this,"signer"),tt(this,"chainId",1),tt(this,"modal"),tt(this,"rpc"),tt(this,"STORAGE_KEY",WP),tt(this,"on",(e,r)=>(this.events.on(e,r),this)),tt(this,"once",(e,r)=>(this.events.once(e,r),this)),tt(this,"removeListener",(e,r)=>(this.events.removeListener(e,r),this)),tt(this,"off",(e,r)=>(this.events.off(e,r),this)),tt(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){const r=new js;return await r.initialize(e),r}async request(e,r){return await this.signer.request(e,this.formatChainId(this.chainId),r)}sendAsync(e,r,i){this.signer.sendAsync(e,r,this.formatChainId(this.chainId),i)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){var r;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:i,optional:n}=t6(this.rpc);try{const s=await new Promise(async(a,c)=>{var l,u;this.rpc.showQrModal&&((l=this.modal)==null||l.open(),(u=this.modal)==null||u.subscribeState(f=>{!f.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),c(new Error("Connection request reset. Please try again.")))}));const h=e!=null&&e.scopedProperties?{[this.namespace]:e.scopedProperties}:void 0;await this.signer.connect(ki(jr({namespaces:jr({},i&&{[this.namespace]:i})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:e?.pairingTopic,scopedProperties:h})).then(f=>{a(f)}).catch(f=>{var p;(p=this.modal)==null||p.showErrorMessage("Unable to connect"),c(new Error(f.message))})});if(!s)return;const o=Ql(s.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:Fn(this.chainId)})}catch(s){throw this.signer.logger.error(s),s}finally{(r=this.modal)==null||r.close()}}async authenticate(e,r){var i;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:e?.chains});try{const n=await new Promise(async(o,a)=>{var c,l;this.rpc.showQrModal&&((c=this.modal)==null||c.open(),(l=this.modal)==null||l.subscribeState(u=>{!u.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),a(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(ki(jr({},e),{chains:this.rpc.chains}),r).then(u=>{o(u)}).catch(u=>{var h;(h=this.modal)==null||h.showErrorMessage("Unable to connect"),a(new Error(u.message))})}),s=n.session;if(s){const o=Ql(s.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:Fn(this.chainId)})}return n}catch(n){throw this.signer.logger.error(n),n}finally{(i=this.modal)==null||i.close()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:r}=e,{event:i}=r;i.name==="accountsChanged"?(this.accounts=this.parseAccounts(i.data),this.events.emit("accountsChanged",this.accounts)):i.name==="chainChanged"?this.setChainId(this.formatChainId(i.data)):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.signer.on("accountsChanged",e=>{this.accounts=this.parseAccounts(e),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",e=>{const r=parseInt(e);this.chainId=r,this.events.emit("chainChanged",Fn(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",ki(jr({},ce("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const r=e.filter(i=>this.isCompatibleChainId(i)).map(i=>this.parseChainId(i));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Fn(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const r=this.parseChainId(e);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(e){const[r,i,n]=e.split(":");return{chainId:`${r}:${i}`,address:n}}setAccounts(e){this.accounts=e.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var r,i;const n=(r=e?.chains)!=null?r:[],s=(i=e?.optionalChains)!=null?i:[],o=n.concat(s);if(!o.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const a=n.length?e?.methods||hs:[],c=n.length?e?.events||fs:[],l=e?.optionalMethods||[],u=e?.optionalEvents||[],h=e?.rpcMap||this.buildRpcMap(o,e.projectId),f=e?.qrModalOptions||void 0;return{chains:n?.map(p=>this.formatChainId(p)),optionalChains:s.map(p=>this.formatChainId(p)),methods:a,events:c,optionalMethods:l,optionalEvents:u,rpcMap:h,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:f,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,r){const i={};return e.forEach(n=>{i[n]=this.getRpcUrl(n,r)}),i}async initialize(e){var r;if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?ds(this.rpc.chains):ds(this.rpc.optionalChains),this.signer=await VP.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let i;try{const n=await YP(),{convertWCMToAppKitOptions:s}=await Promise.resolve().then(function(){return f6}),o=s(ki(jr({},this.rpc.qrModalOptions),{chains:[...new Set([...this.rpc.chains,...this.rpc.optionalChains])],metadata:this.rpc.metadata,projectId:this.rpc.projectId}));if(!o.networks.length)throw new Error("No networks found for WalletConnect");i=n(ki(jr({},o),{universalProvider:this.signer,manualWCControl:!0,enableMobileFullScreen:((r=this.rpc.qrModalOptions)==null?void 0:r.enableMobileFullScreen)===!0}))}catch(n){throw console.warn(n),new Error("To use QR modal, please install @reown/appkit package")}if(i)try{this.modal=i}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:r,optionalChains:i,rpcMap:n}=e;r&&yt(r)&&(this.rpc.chains=r.map(s=>this.formatChainId(s)),r.forEach(s=>{this.rpc.rpcMap[s]=n?.[s]||this.getRpcUrl(s)})),i&&yt(i)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=i?.map(s=>this.formatChainId(s)),i.forEach(s=>{this.rpc.rpcMap[s]=n?.[s]||this.getRpcUrl(s)}))}getRpcUrl(e,r){var i;return((i=this.rpc.rpcMap)==null?void 0:i[e])||`${GP}?chainId=eip155:${e}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:r?.accounts),this.setAccounts(r?.accounts)}catch(e){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(e),await this.disconnect().catch(r=>this.signer.logger.warn(r))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(r=>this.parseAccount(r))}}const r6=js;var i6=Object.defineProperty,n6=Object.defineProperties,s6=Object.getOwnPropertyDescriptors,hf=Object.getOwnPropertySymbols,o6=Object.prototype.hasOwnProperty,a6=Object.prototype.propertyIsEnumerable,ff=(t,e,r)=>e in t?i6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Lg=(t,e)=>{for(var r in e||(e={}))o6.call(e,r)&&ff(t,r,e[r]);if(hf)for(var r of hf(e))a6.call(e,r)&&ff(t,r,e[r]);return t},c6=(t,e)=>n6(t,s6(e));function l6(t){if(t)return{"--w3m-font-family":t["--wcm-font-family"],"--w3m-accent":t["--wcm-accent-color"],"--w3m-color-mix":t["--wcm-background-color"],"--w3m-z-index":t["--wcm-z-index"]?Number(t["--wcm-z-index"]):void 0,"--w3m-qr-color":t["--wcm-accent-color"],"--w3m-font-size-master":t["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":t["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}const u6=t=>{const[e,r]=t.split(":");return Fg({id:r,caipNetworkId:t,chainNamespace:e,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function h6(t){var e,r,i,n,s,o,a;const c=(e=t.chains)==null?void 0:e.map(u6).filter(Boolean);if(c.length===0)throw new Error("At least one chain must be specified");const l=c.find(h=>{var f;return h.id===((f=t.defaultChain)==null?void 0:f.id)}),u={projectId:t.projectId,networks:c,themeMode:t.themeMode,themeVariables:l6(t.themeVariables),chainImages:t.chainImages,connectorImages:t.walletImages,defaultNetwork:l,metadata:c6(Lg({},t.metadata),{name:((r=t.metadata)==null?void 0:r.name)||"WalletConnect",description:((i=t.metadata)==null?void 0:i.description)||"Connect to WalletConnect-compatible wallets",url:((n=t.metadata)==null?void 0:n.url)||"https://walletconnect.org",icons:((s=t.metadata)==null?void 0:s.icons)||["https://walletconnect.org/walletconnect-logo.png"]}),showWallets:!0,featuredWalletIds:t.explorerRecommendedWalletIds==="NONE"?[]:Array.isArray(t.explorerRecommendedWalletIds)?t.explorerRecommendedWalletIds:[],excludeWalletIds:t.explorerExcludedWalletIds==="ALL"?[]:Array.isArray(t.explorerExcludedWalletIds)?t.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if((o=t.mobileWallets)!=null&&o.length||(a=t.desktopWallets)!=null&&a.length){const h=[...(t.mobileWallets||[]).map(d=>({id:d.id,name:d.name,links:d.links})),...(t.desktopWallets||[]).map(d=>({id:d.id,name:d.name,links:{native:d.links.native,universal:d.links.universal}}))],f=[...u.featuredWalletIds||[],...u.excludeWalletIds||[]],p=h.filter(d=>!f.includes(d.id));p.length&&(u.customWallets=p)}return u}function Fg(t){return Lg({formatters:void 0,fees:void 0,serializers:void 0},t)}var f6=Object.freeze({__proto__:null,convertWCMToAppKitOptions:h6,defineChain:Fg});const i4=Object.freeze(Object.defineProperty({__proto__:null,EthereumProvider:r6,OPTIONAL_EVENTS:kg,OPTIONAL_METHODS:jg,REQUIRED_EVENTS:fs,REQUIRED_METHODS:hs,default:js},Symbol.toStringTag,{value:"Module"}));export{Rt as A,pt as B,Hv as C,Tt as D,xg as E,Wa as F,NE as G,i4 as H,Xr as I,Ll as P,Bd as Q,at as R,qd as U,M as a,sr as b,tw as c,by as d,zi as e,gt as f,iy as g,Zv as h,ot as i,hI as j,FI as k,Xe as l,It as m,ZS as n,Oc as o,Sc as p,Rs as q,Qr as r,ca as s,Je as t,rn as u,Y1 as v,Wr as w,Hr as x,xr as y,Ts as z};
