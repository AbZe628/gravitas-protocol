name: Gravitas Protocol CI 
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
env:
  FOUNDRY_PROFILE: default
jobs:
  contracts:
    name: Smart Contracts (Foundry)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: recursive
      - name: Install Foundry
        uses: foundry-rs/foundry-toolchain@v1
        with:
          version: nightly 
      - name: Show Forge version
        run: forge --version 
      - name: Build Contracts
        run: forge build --sizes 
      - name: Run Tests
        run: forge test -vv 
      - name: Check Gas Snapshots
        run: forge snapshot --check 
  sdk:
    name: SDK (TypeScript)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: gravitas-sdk/package-lock.json 
      - name: Install Dependencies
        working-directory: ./gravitas-sdk
        run: npm install 
      - name: Build SDK
        working-directory: ./gravitas-sdk
        run: npm run build 
